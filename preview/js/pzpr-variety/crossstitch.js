/*! @license pzpr.js v7d5fe9d4 (c) 2009-2021 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["crossstitch"],{MouseEvent:{use:!0,inputModes:{edit:["number","shade","undef","direc"],play:["line","completion","dot","subcircle","info-line"]},mouseinput_auto:function(){var a=this.puzzle;if(a.playmode){if(this.mousestart||this.mousemove)this.inputslash();else if(this.mouseend&&this.notInputted()){if(this.clickslash())return;if(!this.firstCell.isnull&&this.getcell()!==this.firstCell)return;this.inputqcmp()}}else a.editmode&&(this.mousestart||this.mousemove?this.inputdirec():this.mouseend&&this.notInputted()&&this.inputqnum())},inputLine:function(){this.mousestart||this.mousemove?this.inputslash():this.mouseend&&this.notInputted()&&this.clickslash()},inputShade:function(){this.inputFixedNumber(-3)},toggleslash:function(a){switch(a.qans){case 31:a.setQans("left"===this.btn?0:33);break;case 32:a.setQans("left"===this.btn?33:0);break;case 33:a.setQans("left"===this.btn?32:31);break;default:a.setQans("left"===this.btn?31:32)}},cycleslash:function(a){a.setQans(("left"===this.btn?{0:31,31:32,32:33,33:0}:{0:33,31:0,32:31,33:32})[a.qans])},inputslash:function(){var a=this.getcell();if(!a.isnull){if(this.mouseCell!==a)this.firstPoint.set(this.inputPoint);else if(null!==this.firstPoint.bx){var b=null,c=0,d=this.inputPoint.bx-this.firstPoint.bx,e=this.inputPoint.by-this.firstPoint.by;d*e>0&&Math.abs(d)>=.5&&Math.abs(e)>=.5?(b=31,c=a.parity()?2:1):d*e<0&&Math.abs(d)>=.5&&Math.abs(e)>=.5&&(b=32,c=a.parity()?1:2),null!==this.inputData&&Math.abs(this.inputData)!==c&&(b=null),null!==b&&(null===this.inputData&&(this.inputData=b===a.qans||33===a.qans?-c:c),this.inputData<0?b=b===a.qans?0:33===a.qans?31===b?32:31:null:0!==a.qans&&a.qans!==b&&(b=33),null!==b&&(a.setQans(b),a.draw()),this.firstPoint.reset())}this.mouseCell=a}},clickslash:function(){var a=this.getcell();if(a.isnull||-1!==a.qnum)return!1;var b=this.puzzle.getConfig("use");return 1===b?this.toggleslash(a):2===b&&this.cycleslash(a),a.drawaround(),!0},inputqcmp:function(){var a=this.getcell();a.isnull||-1===a.qnum||-3===a.qnum||(a.setQcmp(+!a.qcmp),a.draw(),this.mousereset())},mouseinput_other:function(){"dot"===this.inputMode&&this.inputdot()},inputdot:function(){var a=this.getpos(.25);if(!this.prevPos.equals(a)){var b=a.getDot();if(this.prevPos=a,null!==b){if(null===this.inputData)if("left"===this.btn)this.inputData={0:1,1:2,2:0}[b.getDot()];else{if("right"!==this.btn)return;this.inputData={0:2,1:0,2:1}[b.getDot()]}b.setDot(this.inputData),b.draw()}}},dispInfoLine:function(){var a=this.getcell();this.mousereset(),a.isnull||0===a.qans||33===a.qans||null===a.path&&null===a.path2||(this.board.cell.setinfo(-1),a.path?a.path.setedgeinfo(101):a.path2.setedgeinfo(102),this.board.hasinfo=!0,this.puzzle.redraw())}},KeyEvent:{enablemake:!0,keyinput:function(a){if(!this.key_inputdirec(a)){if("q"===a){var b=this.cursor.getc();return b.setQnum(-3!==b.qnum?-3:-1),this.prev=b,void b.draw()}this.key_inputqnum(a)}}},Cell:{parity:function(){return 0==(this.bx+this.by&2)},getDirClist:function(){if(0===this.qdir)return null;for(var a=this.getaddr(),b=this.qdir,c=new this.klass.CellList;;){a.movedir(b,2);var d=a.getc();if(-1!==d.qnum||d.isnull)break;c.add(d)}return c},maxnum:function(){return Math.max(4,Math.max(this.board.cols,this.board.rows)>>1)},prehook:{qans:function(a){return a&&-1!==this.qnum},qsub:function(a){return a&&-1!==this.qnum}},posthook:{qnum:function(a){-1!==a&&(this.setQans(0),this.setQsub(0))},qdir:function(a){a!==this.NDIR&&-3===this.qnum&&this.setQnum(-2)}},minnum:0,setinfo:function(a){this.qinfo=this.calcInfo(a,this.qinfo,2)},seterr:function(a){this.board.isenableSetError()&&(this.error=this.calcInfo(a,this.error,1))},calcInfo:function(a,b,c){switch(a){case 31:return b===(8|c)||b===c?c:4|c;case 32:return b===(4|c)||b===c?c:8|c;case 101:case 102:var d=102===a===this.parity()?31:32;return b<=0&&(b=12|c),b&~(31===d?8:4);default:return a}}},Cross:{l2cnt:0,counts:function(){return this.lcnt+this.l2cnt}},Dot:{getDot:function(){return"cross"===this.piece.group&&0===this.piece.counts()?this.piece.qsub:0},setDot:function(a){"cross"===this.piece.group&&(this.puzzle.opemgr.disCombine=!0,this.piece.setQsub(a),this.puzzle.opemgr.disCombine=!1)},getTrial:function(){return this.piece.trial}},Board:{hasdots:2,addExtraInfo:function(){this.line2graph=this.addInfoList(this.klass.Line2Graph)}},BoardExec:{adjustBoardData:function(a,b){if(a&this.TURNFLIP)for(var c=this.board.cell,d=0;d<c.length;d++){var e=c[d];e.qans={0:0,31:32,32:31,33:33}[e.qans]}this.adjustNumberArrow(a,b)}},LineGraph:{enabled:!0,relation:{"cell.qans":"link"},pointgroup:"cross",linkgroup:"cell",parity:!0,rebuild2:function(){for(var a=this.board.cell,b=0;b<a.length;b++)this.setSideObjFromParity(a[b]);this.common.rebuild2.call(this)},isedgevalidbylinkobj:function(a){switch(a.qans){case 31:return a.parity()!==this.parity;case 32:return a.parity()===this.parity;case 33:return!0;default:return!1}},getComponentRefs:function(a){return a.path},setEdgeByLinkObj:function(a){null!==this.getComponentRefs(a)&&(this.setSideObjFromParity(a),this.incdecLineCount(a,!1),this.removeEdgeByLinkObj(a)),this.isedgevalidbylinkobj(a)&&(this.setSideObjFromParity(a),this.incdecLineCount(a,!0),this.addEdgeByLinkObj(a))},setSideObjFromParity:function(a){a.parity()===this.parity?a.sideobj=[a.relcross(-1,1),a.relcross(1,-1)]:a.sideobj=[a.relcross(-1,-1),a.relcross(1,1)]}},"Line2Graph:LineGraph":{parity:!1,countprop:"l2cnt",getComponentRefs:function(a){return a.path2},setComponentRefs:function(a,b){a.path2=b},getObjNodeList:function(a){return a.path2nodes},resetObjNodeList:function(a){a.path2nodes=[]}},Graphic:{irowake:!0,margin:.5,gridcolor_type:"DLIGHT",qcmpcolor:"rgb(127,127,127)",errcolor1:"red",fontsizeratio:.65,paint:function(){this.drawBGCells(),this.drawArrowNumbers(),this.drawCircles(),this.drawMBs(),this.drawSlashes(),this.drawBaseMarks(),this.drawDots(),this.drawTarget()},drawBaseMarks:function(){var a=this.vinc("cross_mark","auto",!0);a.strokeStyle=this.quescolor,a.fillStyle=this.quescolor,a.lineWidth=1;for(var b=this.cw/10,c=this.range.crosses,d=0;d<c.length;d++){var e=c[d];a.vid="x_cm_"+e.id;var f=e.bx*this.bw,g=e.by*this.bh;e.bx+e.by&2?(a.beginPath(),a.moveTo(f-b,g),a.lineTo(f+b,g),a.moveTo(f,g-b),a.lineTo(f,g+b),a.closePath(),a.stroke()):a.fillCircle(f,g,b/2)}},repaintLines:function(a){this.range.cells=a,this.drawSlashes()},getBGCellColor:function(a){return-1!==a.qnum?1===a.error?"rgb(192, 0, 0)":"black":-2===a.error||0===a.qans&&a.error>0?this.errbcolor1:null},getCircleStrokeColor:function(a){return-1===a.qnum||-3===a.qnum||a.qnum>4||a.qdir!==a.NDIR?null:this.getQuesNumberColor(a)},getCircleFillColor:function(a){return null},getQuesNumberColor:function(a){return 1===a.qcmp?this.qcmpcolor:this.fontShadecolor},getDotFillColor:function(a){return 1===a.getDot()?a.getTrial()?this.trialcolor:this.pekecolor:2===a.getDot()?"white":null},getDotOutlineColor:function(a){return 2===a.getDot()?a.getTrial()?this.trialcolor:this.pekecolor:null},getDotRadius:function(a){return.13}},Encode:{decodePzpr:function(a){this.decodeArrowNumber16()},encodePzpr:function(a){this.encodeArrowNumber16()}},FileIO:{decodeData:function(){this.decodeCellDirecQnum(),this.decodeCell(function(a,b){"o"===b[0]&&(b=b.substr(1),a.qsub=1),"c"===b?a.qcmp=1:+b&&(a.qans=+b+30)}),this.decodeCross(function(a,b){a.qsub=+b})},encodeData:function(){this.encodeCellDirecQnum(),this.encodeCell(function(a){var b="";return 1===a.qsub&&(b+="o"),a.qans>30?b+=""+a.qans-30:a.qcmp?b+="c":""===b&&(b+="."),b+" "}),this.encodeCross(function(a){return a.qsub+" "})}},AnsCheck:{checklist:["checkNumberHasArrow","checkBranchLine","checkCrossLine","checkAdjacentCrossing","checkCircledNumber","checkCircledHatena","checkArrowNumber","checkArrowHatena","checkDeadendLine","checkTwoLoops"],checkLineCount:function(a,b){for(var c=this.board,d=0;d<c.cross.length;d++){var e=c.cross[d];if(a===e.counts()){if(this.failcode.add(b),this.checkOnly)break;this.board.cell.setnoerr();for(var f=-1;f<=1;f+=2){var g=c.getc(e.bx+f,e.by+f);31!==g.qans&&33!==g.qans||g.seterr(31);var h=c.getc(e.bx-f,e.by+f);32!==h.qans&&33!==h.qans||h.seterr(32)}}}},checkNumberHasArrow:function(){this.checkAllCell(function(a){return a.qnum>4&&a.qdir===a.NDIR},"anNoArrow")},checkAdjacentCrossing:function(){this.checkSideCell(function(a,b){return 33===a.qans&&33===b.qans},"cxAdjacent"),"cxAdjacent"===this.failcode.lastcode&&this.board.cell.setnoerr()},checkCircledNumber:function(){var a=this.board;this.checkAllCell(function(b){return!(b.qdir!==b.NDIR||b.qnum<0)&&a.crossinside(b.bx-1,b.by-1,b.bx+1,b.by+1).filter(function(a){return a.counts()>0}).length!==b.qnum},"nmCircleNe")},checkCircledHatena:function(){var a=this.board;this.checkAllCell(function(b){return b.qdir===b.NDIR&&-2===b.qnum&&!a.crossinside(b.bx-1,b.by-1,b.bx+1,b.by+1).some(function(a){return a.counts()>0})},"nmHatenaNe")},checkTwoLoops:function(){var a=this.board,b=a.linegraph.components,c=a.line2graph.components;b.length+c.length>2&&(this.failcode.add("lnPlLoop"),a.cell.setnoerr(),b.length>1?b[0].setedgeerr(101):c.length>1&&c[0].setedgeerr(102))},checkArrowNumber:function(){for(var a=this.board,b=0;b<a.cell.length;b++){var c=a.cell[b];if(!(c.qnum<0)){var d=c.getDirClist(),e=this.countCrossing(d);if(!(e<0||c.qnum===e)){if(this.failcode.add("anNumberNe"),this.checkOnly)break;c.seterr(1),d.seterr(-2)}}}},checkArrowHatena:function(){for(var a=this.board,b=0;b<a.cell.length;b++){var c=a.cell[b];if(-2===c.qnum){var d=c.getDirClist();if(0===this.countCrossing(d)){if(this.failcode.add("anHatenaNe"),this.checkOnly)break;c.seterr(1),d.seterr(-2)}}}},countCrossing:function(a){return a?a.filter(function(a){return 33===a.qans}).length:-1}},FailCode:{cxAdjacent:["(please translate) Crossings are adjacent.","Crossings are adjacent."],nmCircleNe:["(please translate) A circled number is not equal to the amount of corners used by a loop.","A circled number is not equal to the amount of corners used by a loop."],nmHatenaNe:["(please translate) A circled question mark does not have any corners used by a loop.","A circled question mark does not have any corners used by a loop."],lnCross:["(please translate) A loop crosses itself.","A loop crosses itself."],lnPlLoop:["(please translate) There are more than two loops.","There are more than two loops."],anNumberNe:["(please translate) The number of crossings is not correct.","The number of crossings is not correct."],anHatenaNe:["(please translate) There are no crossings in the given direction.","There are no crossings in the given direction."]}});
//# sourceMappingURL=crossstitch.js.map