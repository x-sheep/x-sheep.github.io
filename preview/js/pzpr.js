/*! @license pzpr.js v45a596d5 (c) 2009-2021 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(){var a={version:"45a596d5"};"object"==typeof module&&module.exports?module.exports=a:this.pzpr=a,function(){var b=this.document,c={exports:{}},d=c.exports;!function(a,c){var d=void 0!==b?b:void 0,e=2*Math.PI,f=[],g=function(){for(var a=[],b=256;b<512;b++)a[b-256]=b.toString(16).substr(1);return a}(),h={version:"0.8.2",env:{node:"object"==typeof a&&"object"==typeof c&&"function"==typeof require,browser:"object"==typeof b&&"object"==typeof window&&"object"==typeof location},wrapper:{},addWrapper:function(a,b){var c,d=function(){this.initialize&&this.initialize.apply(this,arguments)};for(c in this.wrapperbase)d.prototype[c]=this.wrapperbase[c];for(c in b)d.prototype[c]=b[c];this.wrapper[a]=d.prototype.constructor=d,this.addType(a)},_order:[],enable:{},addType:function(a){this._order.push(a),this.enable[a]=!0,this.current||(this.current=a)},TypeList:function(a){for(var b=0;b<h._order.length;b++)this[h._order[b]]=h._order[b]===a},current:"",select:function(a){return!!this.enable[a]&&(this.current=a,!0)},ME:null,initME:function(){var a=d.createElement("div");a.style.display="inline",a.style.position="absolute",a.style.top="0px",a.style.left="-9000px",a.innerHTML="",d.body.appendChild(a),void 0!==a.offsetHeight?this.ME=a:d.body.removeChild(a)},getoffsetHeight:function(a,b){var c;if(b.match(/(.+\s)?([0-9]+)px (.+)$/))c=+RegExp.$2;else if(this.ME){var d=this.ME;d.style.font=b,d.style.lineHeight="100%",d.innerHTML=a,c=d.offsetHeight}return c},color:f,parse:function(a){if(!f[a])if("rgb("===a.substr(0,4)){var b=a.match(/\d+/g);f[a]=["#",g[b[0]],g[b[1]],g[b[2]]].join("")}else f[a]=a;return f[a]},getRectSize:function(a){return{width:a.offsetWidth||a.clientWidth||0,height:a.offsetHeight||a.clientHeight||0}},_counter:-1,getcanvasid:function(){return"_candle_"+ ++this._counter},start:function(a,b,c){this.ME||"undefined"==typeof window||this.initME();var d;if(a.getContext)d=a.getContext("2d");else{var e=b;if(this.enable[e]||(e=this.current),!e||!this.enable[e])throw"No canvas environment is installed";d=new this.wrapper[e](a)}c&&c(d)}};"object"==typeof a&&"object"==typeof c?a.exports=h:this.Candle=h,function(){function a(){if(this.parentNode){var a=this.parentNode._children,b=a.indexOf(this);return b>=0?a[b+1]:null}}function b(a){a.parentNode&&a.parentNode.removeChild(a),this._children.push(a),a.parentNode=this}function c(a){var b=this._children.indexOf(a);return b>=0&&(this._children.splice(b,1),a.parentNode=null),a}function e(a,b){a.parentNode&&a.parentNode.removeChild(a);var c=-1;b&&(c=this._children.indexOf(b)),-1===c?this.appendChild(a):this._children.splice(c,0,a)}function f(a,b){a=a.replace(/\*/g,"[^/]+"),a=a.replace(/([\w#]+|\*)/g,"[^/]*$1[^/]*"),a=a.replace(/\s+/g,"/([^/]+/)?"),a=new RegExp(a+"[^/]*$");for(var c=this.firstChild?[this.firstChild]:[],d=[];c.length>0;){var e=c.pop();if(j(e,this).match(a)&&(d.push(e),b))break;e.childNodes||console.log(e),e.nextSibling&&c.push(e.nextSibling),e.childNodes.length>0&&c.push(e.firstChild)}return d}function g(a){return f.call(this,a,!1)}function i(a){return f.call(this,a,!0)[0]||null}function j(a,b){for(var c="";a&&a!==b;){var d="";a.createElement||(d=a.tagName+(a._attr.id?"#"+a._attr.id:"")),c=d+(c?"/"+c:""),a=a.parentNode}return c}function k(){return this._children.reduce(function(a,b,c,d){return a+b.outerHTML},"")}function l(){var a=this.tagName,b="",c="";for(var d in this._attr)b+=" "+d+'="'+this._attr[d]+'"';for(var e in this.style)c+=e+":"+this.style[e]+";";return c&&(b+=' style="'+c+'"'),0===this._children.length?"<"+a+b+"/>":"<"+a+b+">"+this.innerHTML+"</"+a+">"}function m(a,b){for(;;){var c=b.match(/^\s*([^:]+?):([^;]+?);?/);if(!c)break;a.style[c[1]]=c[2],b=RegExp["$'"]}}function n(a,b){for(;;){var c=b.match(/^\s*([\w\-\:]+)(\=)?(?:['"](.+?)['"]|([^\s]+))?\s*/);if(!c)break;var d=c[1],e=c[3]||c[4]||"";b=RegExp["$'"],d&&("="===c[2]?"style"!==d?a.setAttribute(d,e):a.style=m(a,e):a.setAttribute(d,!0))}}function o(a,b){var c=[a];return b.split(/(<.+?>)/g).forEach(function(a){var b=c[c.length-1],d=null;if(!a.match(/^<\?xml/))if(a.match(/^<\w/)){var e=a.match(/<(\w+)\s*(.*)\/?>/);d=new p(e[1]),n(d,e[2]),b.appendChild(d),a.match(/\/>$/)||c.push(d)}else if(a.match(/^<\//))c.pop();else{if(a.match(/^[\s\t\r\n]*$/))return;b.appendChild(new q(a))}}),a}var p=function(a){this.tagName=a,this._attr={},this.style={},this._children=[]};p.prototype={tagName:"",style:null,_attr:null,_children:null,parentNode:null,nodeType:1,get nodeName(){return this.tagName},get firstChild(){return this._children[0]},get lastChild(){return this._children[this._children.length-1]},get childNodes(){return this._children},get nextSibling(){return a.call(this)},appendChild:b,removeChild:c,insertBefore:e,setAttribute:function(a,b){this._attr[a]=b},setAttributeNS:function(a,b,c){this._attr[b]=c},getAttribute:function(a){return a in this._attr?this._attr[a]:null},getAttributeNS:function(a,b){return b in this._attr?this._attr[b]:null},removeAttribute:function(a){delete this._attr[a]},get id(){return this._attr.id||""},get innerHTML(){return k.call(this)},get outerHTML(){return l.call(this)},get textContent(){return this.innerHTML.replace(/<.+?>/g,"")},set textContent(a){this._children.forEach(function(a){this.removeChild(a)}.bind(this)),this.appendChild(new q(a))},querySelector:i,querySelectorAll:g};var q=function(a){this.data=a};q.prototype={_attr:{},parentNode:null,nodeType:3,nodeName:"#text",data:"",firstChild:null,chilsNodes:[],get nextSibling(){return a.call(this)},get outerHTML(){return this.data}};var r=h.MockDocument=function(){this._children=[]};r.prototype={_children:null,nodeType:9,nodeName:"#document",createElement:function(a){return new p(a)},createElementNS:function(a,b){return new p(b)},createTextNode:function(a){return new q(a)},get firstChild(){return this._children[0]},get lastChild(){return this._children[this._children.length-1]},get childNodes(){return this._children},appendChild:b,removeChild:c,insertBefore:e,get innerHTML(){return k.call(this)},get outerHTML(){return k.call(this)},querySelector:i,querySelectorAll:g,getElementById:function(a){return this.querySelector("#"+a)}};var s=h.MockXMLSerializer=function(){};s.prototype.serializeToString=function(a){return a.outerHTML};var t=h.MockDOMParser=function(){};t.prototype.parseFromString=function(a,b){return o(new r,a)},d||(d=new r),h.document=d,h.XMLSerializer=s,h.DOMParser=t}(),h.wrapperbase={initialize:function(a){this.fillStyle="black",this.strokeStyle="black",this.lineWidth=1,this.font="14px system",this.textAlign="center",this.textBaseline="middle",this.canvas=a,this.canvasid=h.getcanvasid(),this.child=null,this.enableTextLengthWA=!1,this.initElement(),this.initFunction(),this.initLayer();var b=this;this.canvas.getContext=function(a){return b}},rectcenter:function(a,b,c,d){this.rect(a-c,b-d,2*c,2*d)},fillRectCenter:function(a,b,c,d){this.fillRect(a-c,b-d,2*c,2*d)},strokeRectCenter:function(a,b,c,d){this.strokeRect(a-c,b-d,2*c,2*d)},shapeRectCenter:function(a,b,c,d){this.shapeRect(a-c,b-d,2*c,2*d)},vhide:function(){}},function(){function a(a){return d.createElementNS(f,a)}function b(){var a="undefined"!=typeof navigator?navigator.userAgent||"":"";c=a.match(/Chrome/)?{"candle-top":-.72,top:-.95,hanging:-.72,middle:-.35,alphabetic:0,bottom:.25}:a.match(/AppleWebKit/)?{"candle-top":-.7,top:-.9,hanging:-.9,middle:-.35,alphabetic:0,bottom:.25}:a.match(/Trident/)?{"candle-top":-.74,top:-1.02,hanging:-1.02,middle:-.32,alphabetic:0,bottom:.45}:a.match(/Win/)?{"candle-top":-.7,top:-.85,hanging:-.85,middle:-.34,alphabetic:0,bottom:.15}:{"candle-top":-.76,top:-.9,hanging:-.9,middle:-.38,alphabetic:0,bottom:.08}}if(void 0!==d&&d.createElementNS&&("object"!=typeof window||!window.opera)){var c,f=h.SVGNS="http://www.w3.org/2000/svg",g=h.XLINKNS="http://www.w3.org/1999/xlink",i=function(a){return a.match(/Trident\//)||a.match(/Safari\//)&&a.match(/Edge\//)}(h.env.browser&&navigator.userAgent||""),j={left:"start",center:"middle",right:"end"};h.addWrapper("svg",{initialize:function(a){this.use=new h.TypeList("svg"),c||b(),this.vid="",this.elements={},this._textcache={},this.target=null,this.layers={},this.cpath=[],this.lastpath="",this.freezepath=!1,h.wrapperbase.initialize.call(this,a),this.enableTextLengthWA=i},initElement:function(){h.env.browser&&(this.canvas.style.overflow="hidden");var a=h.getRectSize(this.canvas),b=this.child=d.createElementNS(f,"svg");b.setAttribute("xmlns",f),b.setAttribute("xmlns:xlink",g),b.setAttribute("font-size","10px"),b.setAttribute("font-family","sans-serif"),b.setAttribute("width",a.width),b.setAttribute("height",a.height),b.setAttribute("viewBox",[0,0,a.width,a.height].join(" ")),this.canvas.appendChild&&this.canvas.appendChild(b)},initFunction:function(){function a(a){return h.env.browser?window.btoa(a):Buffer.isBuffer(a)?a.toString("base64"):new Buffer(a.toString(),"binary").toString("base64")}function b(a){return(a.outerHTML||(new h.XMLSerializer).serializeToString(a)).replace(/^<\?xml.+?\?>[\r\n]*/,"")}var c='<?xml version="1.0" encoding="UTF-8"?>\n',d=this.child;this.canvas.toDataURL=function(c,e){return"data:image/svg+xml;base64,"+a(b(d))},this.canvas.toBlob=function(a,e,f){a(new Blob([c+b(d)],{type:"image/svg+xml"}))},this.canvas.toBuffer=function(a,e){return c+b(d)}},initLayer:function(){this.setLayer();var a=h.getRectSize(this.canvas);this.rect(0,0,a.width,a.height),this.addVectorElement(!1,!1)},clear:function(){for(var a=this.child,b=a.firstChild;b;)a.removeChild(b),b=a.firstChild;this.vid="",this.elements={},this.layers={},this.target=this.child,this.setLayer(),this._textcache={}},setLayer:function(b,c){if(c=c||{},this.vid="",b){var d=this.layers[b];d||(d=this.layers[b]=a("g"),this.child.appendChild(d)),this.target=d}else this.target=this.child;c.rendering&&this.setRendering(c.rendering),this.freezepath=!!c&&c.freeze},setRendering:function(a){this.target.setAttribute("shape-rendering",a)},changeSize:function(a,b){h.env.browser&&(this.canvas.style.width=a+"px",this.canvas.style.height=b+"px");var c=this.child;c.setAttribute("width",a),c.setAttribute("height",b);var d=c.getAttribute("viewBox").split(/ /);c.setAttribute("viewBox",[d[0],d[1],a,b].join(" "))},translate:function(a,b){var c=this.child.getAttribute("viewBox").split(/ /);c[0]=-a,c[1]=-b,this.child.setAttribute("viewBox",c.join(" "))},beginPath:function(){this.cpath=[],this.lastpath=""},closePath:function(){this.cpath.push("z"),this.lastpath="z"},moveTo:function(a,b){this.cpath.push("M",a,b),this.lastpath="M"},lineTo:function(a,b){"L"!==this.lastpath&&this.cpath.push("L"),this.cpath.push(a,b),this.lastpath="L"},rect:function(a,b,c,d){this.cpath.push("M",a,b,"L",a+c,b,a+c,b+d,a,b+d,"z"),this.lastpath="z"},arc:function(a,b,c,d,f,g){var h,i,j,k;f-d>=e?(h=a+c,i=b,j=a+c,k=b):(h=a+c*Math.cos(d),i=b+c*Math.sin(d),j=a+c*Math.cos(f),k=b+c*Math.sin(f)),f-d>=e&&(i+=.125);var l=d>f!=Math.abs(f-d)>Math.PI,m=g^l?1:0,n=0===m^l?1:0;this.cpath.push("M",h,i,"A",c,c,0,m,n,j,k),this.lastpath="A"},fill:function(){this.addVectorElement(!0,!1)},stroke:function(){this.addVectorElement(!1,!0)},shape:function(){this.addVectorElement(!0,!0)},fillRect:function(a,b,c,d){var e=this.cpath;this.cpath=[],this.rect(a,b,c,d),this.addVectorElement(!0,!1),this.cpath=e},strokeRect:function(a,b,c,d){var e=this.cpath;this.cpath=[],this.rect(a,b,c,d),this.addVectorElement(!1,!0),this.cpath=e},shapeRect:function(a,b,c,d){var e=this.cpath;this.cpath=[],this.rect(a,b,c,d),this.addVectorElement(!0,!0),this.cpath=e},setLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2),d=[],e=0;e<c;e+=2)d[e>>1]=[a[e],a[e+1]];this.beginPath(),this.setLinePath_com.call(this,d),a[b-1]&&this.cpath.push("z")},setOffsetLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2),d=[],e=0;e<c-2;e+=2)d[e>>1]=[a[e+2]+a[0],a[e+3]+a[1]];this.beginPath(),this.setLinePath_com.call(this,d),a[b-1]&&this.cpath.push("z")},setLinePath_com:function(a){for(var b=0,c=a.length;b<c;b++)this.cpath.push(0===b?"M":"L"),this.cpath.push(a[b][0],a[b][1])},strokeLine:function(a,b,c,d){var e=this.cpath;this.cpath=["M",a,b,"L",c,d],this.addVectorElement(!1,!0),this.cpath=e},strokeDashedLine:function(a,b,c,d,e){var f=this.cpath;this.cpath=["M",a,b,"L",c,d],this.addVectorElement(!1,!0).setAttribute("stroke-dasharray",e.join(" ")),this.cpath=f},strokeCross:function(a,b,c){var d=this.cpath;this.cpath=["M",a-c,b-c,"L",a+c,b+c,"M",a-c,b+c,"L",a+c,b-c],this.addVectorElement(!1,!0),this.cpath=d},fillCircle:function(a,b,c){var d=this.cpath;this.cpath=[],this.arc(a,b,c,0,e,!1),this.cpath.push("z"),this.addVectorElement(!0,!1),this.cpath=d},strokeCircle:function(a,b,c){var d=this.cpath;this.cpath=[],this.arc(a,b,c,0,e,!1),this.cpath.push("z"),this.addVectorElement(!1,!0),this.cpath=d},shapeCircle:function(a,b,c){var d=this.cpath;this.cpath=[],this.arc(a,b,c,0,e,!1),this.cpath.push("z"),this.addVectorElement(!0,!0),this.cpath=d},getDefsElement:function(){var a=this.child.querySelector("defs");return a||(a=d.createElementNS(f,"defs"),this.child.insertBefore(a,this.child.firstChild||null)),a},getImageElement:function(b){for(var c=this.getDefsElement(),d=null,e=c.querySelectorAll("image"),f=0;f<e.length;f++)if(e[f].getAttributeNS(g,"href")===b.src){d=e[f];break}return d||(d=a("image"),d.setAttribute("id",(d.ownerDocument?this.canvasid+"_":"")+"img"+e.length),d.setAttribute("width",b.width),d.setAttribute("height",b.height),d.setAttributeNS(g,"xlink:href",b.src),c.appendChild(d)),d},getImageSymbol:function(a,b,c,e,h){for(var i=this.getDefsElement(),j=[b,c,e,h].join(" "),k=null,l=i.querySelectorAll("symbol"),m=0;m<l.length;m++)if(l[m].getAttribute("viewBox")===j){k=l[m];break}if(!k){k=d.createElementNS(f,"symbol"),k.setAttribute("id",(k.ownerDocument?this.canvasid+"_":"")+"symimg"+l.length),k.setAttribute("viewBox",j);var n=d.createElementNS(f,"use");n.setAttributeNS(g,"xlink:href","#"+this.getImageElement(a).getAttribute("id")),k.appendChild(n),i.appendChild(k)}return k},fillText:function(a,b,c,d){var e=this.vid?this.elements[this.vid]:null;if(a&&this.fillStyle&&"none"!==this.fillStyle){var f=this.fillText_main(e,a,b,c,d||"");!e&&this.vid&&(this.elements[this.vid]=f)}else e&&this.hide(e);this.vid=""},fillText_main:function(b,d,e,f,g){var k=!b,l=this.vid?this._textcache[this.vid]||{}:{};if(k?b=a("text"):this.show(b),b.getAttribute("fill")!==this.fillStyle&&b.setAttribute("fill",this.fillStyle),l.x!==e||l.y!==f||l.ml!==g||l.ta!==this.textAlign||l.tb!==this.textBaseline||l.font!==this.font){var m=f-h.getoffsetHeight(d,this.font)*c[this.textBaseline.toLowerCase()],n=j[this.textAlign.toLowerCase()];b.getAttribute("x")!==e&&b.setAttribute("x",e),b.getAttribute("y")!==m&&b.setAttribute("y",m),b.getAttribute("text-anchor")!==n&&b.setAttribute("text-anchor",n),(b.getAttribute("textLength")||"")!==g&&(g?(b.setAttribute("textLength",g),b.setAttribute("lengthAdjust","spacingAndGlyphs")):(b.removeAttribute("textLength"),b.removeAttribute("lengthAdjust"))),l.x=e,l.y=f,l.ml=g,l.ta=this.textAlign,l.tb=this.textBaseline}if(l.font!==this.font){if(this.font.match(/(.+\s)?([0-9]+)px (.+)$/)){var o=RegExp.$1,p=RegExp.$2,q=RegExp.$3;b.setAttribute("font-size",p),q.match(/^sans\-serif$/i)?b.removeAttribute("font-family"):b.setAttribute("font-family",q),o.match(/(italic|oblique)/)?b.setAttribute("font-style",RegExp.$1):b.removeAttribute("font-style"),o.match(/(bold|bolder|lighter|[1-9]00)/)?b.setAttribute("font-weight",RegExp.$1):b.removeAttribute("font-weight")}else b.setAttribute("font",this.font);l.font=this.font}if(b.textContent!==d&&(b.textContent=d),this.vid&&(this._textcache[this.vid]=l),k&&this.target.appendChild(b),i&&this.enableTextLengthWA&&("center"===l.ta||"right"===l.ta)&&g){b.removeAttribute("textLength");var r=b.getBoundingClientRect();b.setAttribute("x",l.x+(r.width-g)/("center"===l.ta?2:1)),b.setAttribute("textLength",g)}return b},drawImage:function(a,b,c,d,e,f,g,h,i){var j=this.vid?this.elements[this.vid]:null;if(a){void 0===d&&(d=a.width,e=a.height),void 0===f&&(f=b,b=0,g=c,c=0,h=d,i=e);var k=this.drawImage_main(j,a,b,c,d,e,f,g,h,i);!j&&this.vid&&(this.elements[this.vid]=k)}else j&&this.hide(j);this.vid=""},drawImage_main:function(b,c,d,e,f,h,i,j,k,l){var m=!b;m?b=a("use"):this.show(b);var n=this.getImageSymbol(c,d,e,f,h).getAttribute("id");return b.getAttribute("x")!==i&&b.setAttribute("x",i),b.getAttribute("y")!==j&&b.setAttribute("y",j),b.getAttribute("width")!==k&&b.setAttribute("width",k),b.getAttribute("height")!==l&&b.setAttribute("height",l),b.getAttributeNS(g,"xlink:href")!=="#"+n&&b.setAttributeNS(g,"xlink:href","#"+n),m&&this.target.appendChild(b),b},addVectorElement:function(a,b){a=a&&!!this.fillStyle&&"none"!==this.fillStyle,b=b&&!!this.strokeStyle&&"none"!==this.strokeStyle;var c=this.vid?this.elements[this.vid]:null,d=null;return a||b?(d=this.addVectorElement_main(c,a,b),!c&&this.vid&&(this.elements[this.vid]=d)):c&&this.hide(c),this.vid="",d},addVectorElement_main:function(b,c,d){var e=!b;if(e?(b=a("path"),b.setAttribute("fill","none"),b.setAttribute("stroke","none")):this.show(b),!this.freezepath||e){var f=this.cpath.join(" "),g=d?this.lineWidth:null;b.getAttribute("d")!==f&&b.setAttribute("d",f),b.getAttribute("stroke-width")!==g&&b.setAttribute("stroke-width",g)}var h=c?this.fillStyle:"none",i=d?this.strokeStyle:"none";return b.getAttribute("fill")!==h&&b.setAttribute("fill",h),b.getAttribute("stroke")!==i&&b.setAttribute("stroke",i),e&&this.target.appendChild(b),b},vhide:function(a){var b=this.elements[this.vid];b&&this.hide(b)},show:function(a){a.removeAttribute("display")},hide:function(a){a.setAttribute("display","none")}})}}(),function(){function a(){var a="undefined"!=typeof navigator?navigator.userAgent||"":"";b=0,b=a.match(/Chrome/)?-.72:a.match(/AppleWebKit/)?-.7:a.match(/Trident/)?-.74:a.match(/Win/)?-.7:-.76}if(h.env.browser){if(!function(){var a=d.createElement("canvas");return!!a.getContext&&(!a.probablySupportsContext||a.probablySupportsContext("2d"))}())return}else try{h.Canvas=require("canvas")}catch(a){return}var b;h.addWrapper("canvas",{initialize:function(c){this.context=null,this.use=new h.TypeList("canvas"),this.currentLayerId="_empty",this.isedgearray={_empty:!1},this.isedge=!1,b||a(),this.x0=0,this.y0=0,h.wrapperbase.initialize.call(this,c)},setkey:function(a){return this},hidekey:function(a){return this},release:function(a){return this},initElement:function(){var a=this.child=h.env.browser?d.createElement("canvas"):new h.Canvas;h.env.browser&&(this.canvas.style.overflow="hidden");var b=h.getRectSize(this.canvas);a.width=b.width,a.height=b.height,h.env.browser&&(a.style.width=b.width+"px",a.style.height=b.height+"px",this.canvas.appendChild(a)),this.context=a.getContext("2d")},initFunction:function(){function a(a){return h.env.browser?window.atob(a):new Buffer(RegExp.$2,"base64").toString("binary")}var b=this.child;this.canvas.toDataURL=function(a,c){return b.toDataURL(a||void 0,c)},this.canvas.toBlob=function(c,d,e){if("function"==typeof b.toBlob)b.toBlob(c,d,e);else{b.toDataURL(d||void 0,e).match(/data:(.*);base64,(.*)/);for(var f=a(RegExp.$2),g=f.length,h=new Uint8Array(g),i=0;i<g;i++)h[i]=f.charCodeAt(i);c(new Blob([h.buffer],{type:RegExp.$1}))}},this.canvas.toBuffer=function(c,d){var e=b.toDataURL(c||void 0,d).replace(/^data:image\/\w+?;base64,/,"");if(h.env.node)return new Buffer(e,"base64");var f;if("undefined"!=typeof Uint8Array){var g=a(e);f=new Uint8Array(g.length);for(var i=0;i<g.length;i++)f[i]=g.charCodeAt(i)}else f=a(e);return f}},initLayer:function(){this.setLayer()},clear:function(){if(this.setProperties(!0,!0),this.context.setTransform(1,0,0,1,0,0),this.context.translate(this.x0,this.y0),h.env.browser){var a=h.getRectSize(this.canvas);this.context.clearRect(0,0,a.width,a.height)}},setLayer:function(a,b){var c=this.currentLayerId=a||"_empty";this.isedge=this.isedgearray[void 0!==this.isedgearray[c]?c:"_empty"],this.setEdgeStyle(),b=b||{},b.rendering&&this.setRendering(b.rendering)},setEdgeStyle:function(){if(h.env.browser){var a=this.canvas.style;"imageRendering"in a&&(a.imageRendering="",this.isedge&&(a.imageRendering="pixelated",a.imageRendering||(a.imageRendering="-webkit-optimize-contrast"),a.imageRendering||(a.imageRendering="-moz-crisp-edges"),a.imageRendering||(a.imageRendering="-o-crisp-edges")))}},setRendering:function(a){this.isedge=this.isedgearray[this.currentLayerId]="crispEdges"===a,this.setEdgeStyle()},changeSize:function(a,b){if(h.env.browser){var c=this.canvas;c.style.width=a+"px",c.style.height=b+"px"}var d=this.child;if(h.env.browser){var e=parseInt(d.style.left),f=parseInt(d.style.top);a+=e<0?-e:0,b+=f<0?-f:0,d.style.width=a+"px",d.style.height=b+"px"}d.width=a,d.height=b},translate:function(a,b){this.x0=a,this.y0=b,this.context.translate(a,b)},setProperties:function(a,b){a=a&&!!this.fillStyle&&"none"!==this.fillStyle,b=b&&!!this.strokeStyle&&"none"!==this.strokeStyle;var c=this.context;return a&&(c.fillStyle=this.fillStyle),b&&(c.strokeStyle=this.strokeStyle),c.lineWidth=this.lineWidth,c.font=this.font,c.textAlign=this.textAlign,c.textBaseline=this.textBaseline,a||b},beginPath:function(){this.context.beginPath()},closePath:function(){this.context.closePath()},moveTo:function(a,b){this.context.moveTo(a,b)},lineTo:function(a,b){this.context.lineTo(a,b)},rect:function(a,b,c,d){this.context.rect(a,b,c,d)},arc:function(a,b,c,d,e,f){this.context.arc(a,b,c,d,e,f)},fill:function(){this.setProperties(!0,!1)&&this.context.fill()},stroke:function(){this.setProperties(!1,!0)&&this.context.stroke()},shape:function(){if(this.setProperties(!0,!0)){var a=this.context;this.fillStyle&&"none"!==this.fillStyle&&a.fill(),this.strokeStyle&&"none"!==this.strokeStyle&&a.stroke()}},fillRect:function(a,b,c,d){this.setProperties(!0,!1)&&this.context.fillRect(a,b,c,d)},strokeRect:function(a,b,c,d){this.setProperties(!1,!0)&&this.context.strokeRect(a,b,c,d)},shapeRect:function(a,b,c,d){if(this.setProperties(!0,!0)){var e=this.context;this.fillStyle&&"none"!==this.fillStyle&&e.fillRect(a,b,c,d),this.strokeStyle&&"none"!==this.strokeStyle&&e.strokeRect(a,b,c,d)}},setLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2),d=[],e=0;e<c;e+=2)d[e>>1]=[a[e],a[e+1]];this.context.beginPath(),this.setLinePath_com.call(this,d),a[b-1]&&this.context.closePath()},setOffsetLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2)-2,d=[],e=0;e<c;e+=2)d[e>>1]=[a[e+2]+a[0],a[e+3]+a[1]];this.context.beginPath(),this.setLinePath_com.call(this,d),a[b-1]&&this.context.closePath()},setLinePath_com:function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];0===b?this.context.moveTo(d[0],d[1]):this.context.lineTo(d[0],d[1])}},strokeLine:function(a,b,c,d){if(this.setProperties(!1,!0)){var e=this.context;e.beginPath(),e.moveTo(a,b),e.lineTo(c,d),e.stroke()}},strokeDashedLine:function(a,b,c,d,e){this.strokeDashedLine=this.context.setLineDash?function(a,b,c,d,e){var f=this.context;this.setProperties(!1,!0)&&(f.beginPath(),f.moveTo(a,b),f.lineTo(c,d),f.setLineDash(e),f.stroke(),f.setLineDash([]))}:function(a,b,c,d,e){e.length%2==1&&(e=e.concat(e));var f=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)),g=0,h=0,i=null,j=null;if(a!==c&&(i=(d-b)/(c-a),j=i*i+1),this.setProperties(!1,!0)){var k=this.context;for(k.beginPath(),k.moveTo(a,b);g<f;){var l,m;if(null!==i){var n=Math.sqrt(g*g/j);l=a+n,m=b+i*n}else l=a,m=b+g;0==(1&h)?k.moveTo(l,m):k.lineTo(l,m),g+=e[h],++h>=e.length&&(h=0)}k.stroke()}},this.strokeDashedLine(a,b,c,d,e)},strokeCross:function(a,b,c){if(this.setProperties(!1,!0)){var d=this.context;d.beginPath(),d.moveTo(a-c,b-c),d.lineTo(a+c,b+c),d.moveTo(a-c,b+c),d.lineTo(a+c,b-c),d.stroke()}},fillCircle:function(a,b,c){if(this.setProperties(!0,!1)){var d=this.context;d.beginPath(),d.arc(a,b,c,0,e,!1),d.fill()}},strokeCircle:function(a,b,c){if(this.setProperties(!1,!0)){var d=this.context;d.beginPath(),d.arc(a,b,c,0,e,!1),d.stroke()}},shapeCircle:function(a,b,c){if(this.setProperties(!0,!0)){var d=this.context;d.beginPath(),d.arc(a,b,c,0,e,!1),this.fillStyle&&"none"!==this.fillStyle&&d.fill(),this.strokeStyle&&"none"!==this.strokeStyle&&d.stroke()}},fillText:function(a,c,d,e){a&&this.setProperties(!0,!1)&&("candle-top"===this.textBaseline&&(d-=h.getoffsetHeight(a,this.font)*b,this.context.textBaseline="alphabetic"),e?this.context.fillText(a,c,d,e):this.context.fillText(a,c,d))},drawImage:function(){arguments[0]&&this.context.drawImage.apply(this.context,arguments)}})}()}(c,d),a.Candle=c.exports}(),document=this.document||a.Candle.document;var b=this.DOMParser||a.Candle.DOMParser,c=this.XMLSerializer||a.Candle.XMLSerializer;a.env=function(){var b=a.Candle.env.browser,c=b?navigator.userAgent:"",d=c.indexOf("like Mac OS X")>-1,e=c.indexOf("Android")>-1,f={iOS:d,Android:e,mobile:d||e},g=function(){if(c.match(/Firefox\/(\w+(\.\w+)?)/)){var a=RegExp.$1;return c.match(/rv\:(\d+(\.\d+)?)/)&&RegExp.$1+0<=2.1?RegExp.$1+0:a}return null}(),h=function(){return c.match(/Safari\/([\w\.]+)/)&&c.match(/Chrome\/(\w+(\.\w+)?)/)?RegExp.$1:null}(),i=function(){return null===h&&c.match(/Safari\/([\w\.]+)/)&&c.match(/Version\/(\w+(\.\w+)?)/)?RegExp.$1:null}();return{bz:{AndroidBrowser:f.Android&&i,Presto:"object"==typeof window&&!!window.opera},OS:f,API:{touchevent:b&&(!!window.ontouchstart||!!document.createTouch),pointerevent:b&&!!window.PointerEvent,mspointerevent:b&&!!window.MSPointerEvent,maxWidth:b&&(h||1e3)>=18&&(i||1e3)>=6,svgTextLength:!b||(g||1e3)>=25,anchor_download:b&&void 0!==document.createElement("a").download},browser:b,node:a.Candle.env.node}}(),a.lang=function(){var b=a.env.node?process.env.LANG:navigator.browserLanguage||navigator.language||navigator.userLanguage;return b&&"ja"!==b.substr(0,2)?"en":"ja"}(),function(){function b(a){if(e){e=!1;for(var b=0;b<f.length;b++)f[b]();f=[]}}function c(a){g&&g.key&&g.key.e_keydown(a)}function d(a){g&&g.key&&g.key.e_keyup(a)}var e=!0,f=[];a.on=function(a,b){"load"===a&&(e?f.push(b):b())},a.env.browser&&("complete"===document.readyState?setTimeout(b,10):(document.addEventListener("DOMContentLoaded",b,!1),window.addEventListener("load",b,!1)));var g=null;a.on("load",function(){a.util.addEvent(document,"keydown",a,c),a.util.addEvent(document,"keyup",a,d)}),a.connectKeyEvents=function(a){g=a}}(),a.common={},a.custom={"":{}},a.classmgr={makeCommon:function(a){this.createCommon(a)},createCommon:function(b){for(var c in b){var d=this.searchName(c),e=a.common[d.real];e||(e=this.createClass(a.common[d.base]),e.prototype.common=e.prototype,e.prototype.pid=""),this.extendPrototype(e.prototype,b[c]),a.common[d.real]=a.custom[""][d.real]=e}},makeCustom:function(b,c){for(var d=0;d<b.length;d++){var e=b[d];a.custom[e]=this.createCustom(e,c)}},getExtension:function(a,b){var c={};for(var d in b){var e=b[d],f=d,g=[],h=!1,f=d.match("#")?d.substr(0,d.indexOf("#")):d;if(f.match("@")){g=f.substr(f.indexOf("@")+1).split(/,/),f=f.substr(0,f.indexOf("@"));for(var i=0;i<g.length;i++)if(g[i]===a){h=!0;break}if(!h)continue}c[f]||(c[f]={});for(var j in e)c[f][j]=e[j]}return c},createCustom:function(b,c){var d={},e=this.getExtension(b,c);for(var f in e){var g=this.searchName(f),h=d[g.real];h||(h=this.createClass(d[g.base]||a.common[g.base]),h.prototype.pid=b),this.extendPrototype(h.prototype,e[f]),d[g.real]=h}for(var i in a.common)d[i]||(d[i]=this.createClass(a.common[i]),d[i].prototype.pid=b);return d},searchName:function(a){a=a.replace(/\s+/g,"");var b=a.indexOf(":"),c="",d=a;return b>=0&&(c=a.substr(b+1),d=a.substr(0,b)),{base:c||d,real:d}},createClass:function(a){function b(){}return a&&this.extendPrototype(b.prototype,a.prototype),b},extendPrototype:function(a,b){b=b||{};for(var c in b)null!==b[c]&&"object"==typeof b[c]&&b[c].constructor===Object?(a[c]||(a[c]={}),this.extendPrototype(a[c],b[c])):a[c]=b[c]},includeCustomFile:function(b){var c=a.variety(b).script;if(!this.includedFile[c]){this.includedFile[c]=!0;var d=a.util.getpath()+"./pzpr-variety/"+c+".js";if(a.env.browser&&!a.env.node){var e=document.createElement("script");e.type="text/javascript",e.src=d+"?"+a.version,document.getElementsByTagName("head")[0].appendChild(e)}else{var f=require(d);this.makeCustom(f[0],f[1])}}},includedFile:{},setPuzzleClass:function(b,c,d){if(!a.variety(c).valid)throw b.emit("fail-open"),"Invalid Puzzle Variety Selected";if(b.pid!==c){if(!a.custom[c]&&(this.includeCustomFile(c),!a.custom[c]))return void setTimeout(function(){a.classmgr.setPuzzleClass(b,c,d)},10);this.setClasses(b,c)}d()},setClasses:function(b,c){b.klass={};var d=a.custom[c];for(var e in d){var f=b.klass[e]=function(){var a=Array.prototype.slice.apply(arguments);this.initialize&&this.initialize.apply(this,a)},g=d[e].prototype;for(var h in g)f.prototype[h]=g[h]}this.setPrototypeRef(b,"puzzle",b),this.setPrototypeRef(b,"klass",b.klass),b.pid=c,b.info=a.variety(c)},setPrototypeRef:function(a,b,c){for(var d in a.klass)a.klass[d].prototype[b]=c}},function(){function b(a){if(c[a])return a;for(var b in c)if(c[b].alias)for(var d in c[b].alias)if(c[b].alias[d]===a)return b;return""}var c={},d=[],e=a.variety=a.genre=function(a){return c[b(a)]||{valid:!1}};e.extend=function(a){for(var b in a)this[b]=a[b]},e.extend({info:c,toPID:b,exists:function(a){return e(a).valid},each:function(a){for(var b in c)a(b)},getList:function(){return d.slice()}}),delete e.extend,function(a,b){for(var d in b){c[d]=new a(d,b[d]);try{Object.freeze(c[d]),Object.freeze(c[d].exists),Object.freeze(c[d].alias)}catch(a){}}}(function(a,b){this.valid=!0,this.pid=a,this.script=b[4]?b[4]:a,this.ja=b[2],this.en=b[3],this.exists={pzprapp:!!b[0],kanpen:!!b[1],pencilbox:!!b[1]},this.exists.pencilbox=this.exists.pencilbox&&"nanro"!==a&&"ayeheya"!==a&&"kurochute"!==a,this.alias=b[5]?b[5]:{},this.urlid=this.alias.pzprurl||a,this.kanpenid=b[1]?this.alias.kanpen||a:"",d.push(a)},{aho:[0,0,"アホになり切れ","Aho-ni-Narikire","shikaku"],amibo:[0,0,"あみぼー","Amibo","amibo"],angleloop:[0,0,"鋭直鈍ループ","Angle Loop","kouchoku"],aqre:[0,0,"Aqre","Aqre","aqre"],aquarium:[0,0,"アクアプレース","Aquarium","aquarium"],araf:[0,0,"相ダ部屋","Araf","araf"],armyants:[0,0,"ぐんたいあり","Army Ants","kaero"],arukone:[0,0,"アルコネ","Arukone","numlin"],ayeheya:[0,1,"∀人∃ＨＥＹＡ","ekawayeh","heyawake"],balance:[0,0,"Balance Loop","Balance Loop"],cave:[1,0,"バッグ","Cave","kurodoko",{alias:"bag",alias2:"corral",alias3:"correl"}],crossstitch:[0,0,"Crossstitch","Crossstitch"],barns:[1,0,"バーンズ","Barns"],bdblock:[1,0,"ボーダーブロック","Border Block"],bonsan:[1,0,"ぼんさん","Bonsan","bonsan"],bosanowa:[1,0,"ボサノワ","Bosanowa","",{alias:"bossanova"}],box:[0,0,"ボックス","Box"],skyscrapers:[0,0,"ビルディングパズル","Skyscrapers","",{alias:"building",alias2:"skyscraper"}],castle:[0,0,"Castle Wall","Castle Wall"],cbblock:[0,0,"コンビブロック","Combi Block"],chocona:[0,0,"チョコナ","Chocona","shimaguni"],cojun:[0,0,"コージュン","Cojun","ripple"],compass:[0,0,"Compass","Compass","compass"],country:[1,0,"カントリーロード","Country Road"],creek:[1,0,"クリーク","Creek"],curvedata:[0,0,"カーブデータ","Curve Data"],"curvedata-aux":[0,0,"図形の編集","Edit shape"],dbchoco:[0,0,"ダブルチョコ","Double Choco","cbblock"],detour:[0,0,"Detour","Detour","country"],doppelblock:[0,0,"Doppelblock","Doppelblock","doppelblock"],dosufuwa:[0,0,"ドッスンフワリ","Dosun-Fuwari"],doubleback:[0,0,"Double Back","Double Back","country"],easyasabc:[0,0,"ABCプレース","Easy as ABC"],factors:[0,0,"因子の部屋","Rooms of Factors"],fillmat:[1,0,"フィルマット","Fillmat","fillmat"],fillomino:[0,1,"フィルオミノ","Fillomino","",{kanpen2:"fillomino01"}],firefly:[1,0,"ホタルビーム","Hotaru Beam"],fivecells:[0,0,"ファイブセルズ","FiveCells","nawabari"],fourcells:[0,0,"フォーセルズ","FourCells","nawabari"],geradeweg:[0,0,"グラーデヴェグ","Geradeweg"],goishi:[0,1,"碁石ひろい","Goishi"],gokigen:[1,0,"ごきげんななめ","Slant","gokigen"],haisu:[0,0,"Haisu","Haisu"],hakoiri:[1,0,"はこいり○△□","Hakoiri-masashi"],hanare:[0,0,"はなれ組","Hanare-gumi","hanare"],hashikake:[0,1,"橋をかけろ","Hashiwokakero","",{pzprurl:"hashi",kanpen:"hashi",alias:"bridges"}],hebi:[1,0,"へびいちご","Hebi-Ichigo","",{old:"snakes"}],herugolf:[0,0,"ヘルゴルフ","Herugolf"],heteromino:[0,0,"ヘテロミノ","Heteromino","nawabari"],heyabon:[1,0,"へやぼん","Heya-Bon","bonsan"],heyawake:[0,1,"へやわけ","Heyawake","heyawake",{alias:"heyawacky"}],hitori:[0,1,"ひとりにしてくれ","Hitori"],
icebarn:[1,0,"アイスバーン","Icebarn","icebarn"],icelom:[0,0,"アイスローム","Icelom","icebarn"],icelom2:[0,0,"アイスローム２","Icelom 2","icebarn"],ichimaga:[0,0,"イチマガ","Ichimaga","ichimaga"],ichimagam:[0,0,"磁石イチマガ","Magnetic Ichimaga","ichimaga"],ichimagax:[0,0,"一回曲がって交差もするの","Crossing Ichimaga","ichimaga"],interbd:[0,0,"International Borders","International Borders"],juosan:[0,0,"縦横さん","Juosan"],kaero:[1,0,"お家に帰ろう","Return Home"],kakuro:[0,1,"カックロ","Kakuro"],kakuru:[0,0,"カックル","Kakuru"],kazunori:[0,0,"かずのりのへや","Kazunori Room"],kinkonkan:[1,0,"キンコンカン","Kin-Kon-Kan"],kouchoku:[0,0,"交差は直角に限る","Kouchoku"],kramma:[0,0,"快刀乱麻","KaitoRamma","kramma"],kramman:[0,0,"新・快刀乱麻","New KaitoRamma","kramma"],kropki:[0,0,"Kropki","Kropki","minarism"],kurochute:[0,1,"クロシュート","Kurochute"],kurodoko:[0,1,"黒どこ(黒マスはどこだ)","Kurodoko"],kurotto:[0,0,"クロット","Kurotto"],kusabi:[0,0,"クサビリンク","Kusabi"],lightup:[0,1,"美術館","Akari","",{pzprurl:"akari",kanpen:"bijutsukan"}],lits:[1,1,"ＬＩＴＳ","LITS","lits"],lookair:[0,0,"るっくえあ","Look-Air"],loopsp:[1,0,"環状線スペシャル","Loop Special","pipelink"],loute:[0,0,"エルート","L-route"],makaro:[0,0,"マカロ","Makaro"],mashu:[0,1,"ましゅ","Masyu","",{kanpen:"masyu",alias:"pearl"}],maxi:[0,0,"Maxi Loop","Maxi Loop","country"],meander:[0,0,"にょろにょろナンバー","Meandering Numbers","ripple"],mejilink:[0,0,"メジリンク","Mejilink"],minarism:[1,0,"マイナリズム","Minarism"],mines:[0,0,"マインスイーパ","Minesweeper","kurotto"],midloop:[0,0,"ミッドループ","Mid-loop"],mochikoro:[1,0,"モチコロ","Mochikoro","nurikabe"],mochinyoro:[1,0,"モチにょろ","Mochinyoro","nurikabe"],moonsun:[0,0,"月か太陽","Moon or Sun","country"],nagare:[0,0,"流れるループ","Nagareru-Loop"],nagenawa:[0,0,"なげなわ","Nagenawa","nagenawa"],nanro:[0,1,"ナンロー","Nanro"],nawabari:[1,0,"なわばり","Territory","nawabari"],nikoji:[0,0,"NIKOJI","NIKOJI","cbblock"],nondango:[0,0,"ノンダンゴ","Nondango"],nonogram:[0,0,"ののぐらむ","Nonogram"],norinori:[0,1,"のりのり","Norinori","lits"],numlin:[0,1,"ナンバーリンク","Numberlink","",{kanpen:"numberlink"}],nuribou:[1,0,"ぬりぼう","Nuribou","nurikabe"],nurikabe:[0,1,"ぬりかべ","Nurikabe","nurikabe"],nurimaze:[0,0,"ぬりめいず","Nuri-Maze","nurimaze"],nurimisaki:[0,0,"ぬりみさき","Nurimisaki","kurodoko"],onsen:[0,0,"温泉めぐり","Onsen-meguri","country"],paintarea:[1,0,"ペイントエリア","Paintarea"],pencils:[0,0,"ペンシルズ","Pencils"],pipelink:[1,0,"パイプリンク","Pipelink","pipelink"],pipelinkr:[1,0,"帰ってきたパイプリンク","Pipelink Returns","pipelink"],putteria:[0,0,"プッテリア","Putteria","hanare"],rectslider:[0,0,"四角スライダー","Rectangle-Slider","bonsan"],reflect:[1,0,"リフレクトリンク","Reflect Link"],renban:[0,0,"連番窓口","Renban-Madoguchi"],ringring:[0,0,"リングリング","Ring-ring","nagenawa"],ripple:[0,1,"波及効果","Ripple Effect","ripple",{kanpen:"hakyukoka"}],roma:[0,0,"ろーま","Roma","",{alias:"rome"}],sashigane:[0,0,"さしがね","Sashigane","loute"],satogaeri:[0,1,"さとがえり","Satogaeri","bonsan",{alias:"sato",kanpen:"satogaeri"}],scrin:[0,0,"スクリン","Scrin"],shakashaka:[0,1,"シャカシャカ","Shakashaka"],shikaku:[0,1,"四角に切れ","Shikaku","shikaku"],shimaguni:[1,0,"島国","Islands","shimaguni"],shugaku:[1,0,"修学旅行の夜","School Trip"],shwolf:[0,0,"ヤギとオオカミ","Goats and Wolves","kramma"],simpleloop:[0,0,"Simple Loop","Simple Loop","country"],slalom:[1,1,"スラローム","Slalom","",{alias:"suraromu"}],slither:[0,1,"スリザーリンク","Slitherlink","",{kanpen:"slitherlink"}],snake:[0,0,"Snake","Snake"],starbattle:[0,0,"スターバトル","Star Battle"],stostone:[0,0,"ストストーン","Stostone","shimaguni"],sudoku:[0,1,"数独","Sudoku"],sukoro:[1,0,"数コロ","Sukoro","sukoro"],sukororoom:[0,0,"数コロ部屋","Sukoro-room","sukoro"],symmarea:[0,0,"シンメトリーエリア","Symmetry Area","fillomino"],tapa:[0,0,"Tapa","Tapa"],tapaloop:[0,0,"Tapa-Like Loop","Tapa-Like Loop"],tasquare:[0,0,"たすくえあ","Tasquare"],tatamibari:[1,0,"タタミバリ","Tatamibari"],tateyoko:[1,0,"タテボーヨコボー","Tatebo-Yokobo"],tawa:[0,0,"たわむれんが","Tawamurenga"],tentaisho:[0,0,"天体ショー","Tentaisho"],tents:[0,0,"Tents","Tents","tents"],tilepaint:[1,0,"タイルペイント","Tilepaint"],toichika:[0,0,"遠い誓い","Toichika"],toichika2:[0,0,"遠い誓い２","Toichika 2","toichika"],triplace:[0,0,"トリプレイス","Tri-place"],usotatami:[0,0,"ウソタタミ","Uso-tatami","fillmat"],usoone:[0,0,"ウソワン","Uso-one"],view:[1,0,"ヴィウ","View","sukoro"],wagiri:[0,0,"ごきげんななめ・輪切","Wagiri","gokigen"],walllogic:[0,0,"ウォールロジック","Wall Logic"],wblink:[0,0,"シロクロリンク","Shirokuro-link"],yajikazu:[1,0,"やじさんかずさん","Yajisan-Kazusan"],yajilin:[0,1,"ヤジリン","Yajilin","",{pzprurl:"yajilin",kanpen:"yajilin",alias:"yajirin"}],"yajilin-regions":[0,0,"ヘヤジリン","Regional Yajilin","yajilin",{alias:"yajirin-regions"}],yajitatami:[0,0,"ヤジタタミ","Yajitatami"],yinyang:[0,0,"しろまるくろまる","Yin-Yang"],yosenabe:[0,0,"よせなべ","Yosenabe"]})}(),function(){var d,e,f;f=a.parser=function(a,b){return f.parse(a,b)},f.extend=function(a){for(var b in a)this[b]=a[b]},f.extend({URL_AUTO:0,URL_PZPRV3:1,URL_PZPRAPP:2,URL_KANPEN:3,URL_KANPENP:4,URL_HEYAAPP:5,URL_PZPRFILE:6,FILE_AUTO:0,FILE_PZPR:1,FILE_PBOX:2,FILE_PBOX_XML:3,parse:function(a,b){return a instanceof d||a instanceof e?a:this.parseFile(a,b)||this.parseURL(a)},parseURL:function(a){return a instanceof d?a:(a=a.replace(/(\r|\n)/g,""),new d(a).parse())},parseFile:function(a,b){return a instanceof e?a:(a.match(/^\<\?xml/)||(a=a.replace(/[\t\r]*\n/g,"\n").replace(/\//g,"\n")),new e(a,b).parse())}}),delete f.extend,d=a.parser.URLData=function(a,b){this.url=a,void 0!==b&&(this.mode=b)},a.parser.URLData.prototype={pid:"",mode:"",type:0,url:"",qdata:"",pflag:null,variant:null,cols:0,rows:0,body:"",isurl:!0,isfile:!1,URL_AUTO:0,URL_PZPRV3:1,URL_PZPRAPP:2,URL_KANPEN:3,URL_KANPENP:4,URL_HEYAAPP:5,URL_PZPRFILE:6,parse:function(){return this.parseURLType(),this.parseURLData(),this.changeProperPid(),this},generate:function(){return this.outputURLType()+this.outputURLData()},parseURLType:function(){var b=this.url;if(delete this.url,b.match(/www\.kanpen\.net/)||b.match(/www\.geocities(\.co)?\.jp\/pencil_applet/))b.match(/([0-9a-z]+)\.html/),this.pid=RegExp.$1,b.indexOf("?heyawake=")>=0?(this.qdata=b.substr(b.indexOf("?heyawake=")+10),this.type=5):b.indexOf("?pzpr=")>=0?(this.qdata=b.substr(b.indexOf("?pzpr=")+6),this.type=4):(this.qdata=b.substr(b.indexOf("?problem=")+9),this.type=3);else if(b.match(/www\.geocities(\.co)?\.jp\/heyawake/))this.pid="heyawake",this.qdata=b.substr(b.indexOf("?problem=")+9),this.type=5;else if(b.match(/indi\.s58\.xrea\.com\/(.+)\/(sa|sc)\//))this.pid=RegExp.$1,this.qdata=b.substr(b.indexOf("?")),this.type=2;else{var c=b.indexOf("/",b.indexOf("?")),d="";if(d=c>-1?b.substring(b.indexOf("?")+1,c):b.substr(b.indexOf("?")+1),d.match(/^pzprv[0-9.]*$/)){b=decodeURIComponent(b);var e=b.split("/");e.length>=2&&(this.pid=e[1]),this.qdata=b,this.type=6}else{c>-1&&(this.qdata=b.substr(c+1));var f=d;f.match(/_edit$/)?this.mode="editor":f.match(/_play$/)&&(this.mode="player"),this.pid=f.replace(/(_edit|_play)$/,""),this.type=1}}this.pid=a.variety.toPID(this.pid)},outputURLType:function(){var b="";switch(b=a.env.node?"http://pzv.jp/p.html":location.protocol+"//"+location.host+location.pathname,this.type){case 1:b+="?%PID%/";break;case 3:b="http://www.kanpen.net/%KID%.html?problem=";break;case 4:b="http://www.kanpen.net/%KID%.html?pzpr=";break;case 5:b="http://www.geocities.co.jp/heyawake/?problem=";break;case 6:b+="?"}var c=this.pid,d="";switch(this.mode){case"player":c+="_play",d="type=player&";break;case"editor":c+="_edit",d="type=editor&"}return 6===this.type&&(b+=d),b.replace("%PID%",a.variety(c).urlid).replace("%KID%",a.variety(this.pid).kanpenid)},parseURLData:function(){if(6===this.type){var a=this.qdata.split("/");return this.cols=+a[2],this.rows=+a[3],this.body=this.qdata.replace(/\//g,"\n"),void delete this.qdata}var b=this.qdata.split("/"),c=0,d=0;if(delete this.qdata,3!==this.type&&5!==this.type&&(b[0]&&b[0].match(/^v:(.*)/)&&(this.variant=RegExp.$1,b.shift()),b[0]&&isNaN(b[0])?(this.pflag=b[0],b.shift()):this.pflag=""),3===this.type)"kakuro"===this.pid?(d=+b.shift()-1,c=+b.shift()-1):"sudoku"===this.pid?d=c=+b.shift():(d=+b.shift(),c=+b.shift());else if(5===this.type){var e=b.shift().split("x");c=+e[0],d=+e[1]}else c=+b.shift()||NaN,d=+b.shift()||NaN;this.rows=d,this.cols=c,b[b.length-1]||b.pop(),this.body=b.join("/")},outputURLData:function(){var a=this,b=a.cols,c=a.rows,d=[];3!==a.type&&5!==a.type&&(null!==a.variant&&d.push("v:"+a.variant),(4===a.type||a.pflag)&&d.push(a.pflag)),3===a.type?"kakuro"===a.pid?(d.push(c+1),d.push(b+1)):"sudoku"===a.pid?d.push(b):(d.push(c),d.push(b)):5===a.type?d.push([b,c].join("x")):6!==a.type&&(d.push(b),d.push(c)),d.push(a.body);var e=d.join("/");return e.charAt(e.length-1).match(/[a-zA-Z0-9]/)||(e+="/"),e},changeProperPid:function(){if(this.body&&(1===this.type||2===this.type))switch(this.pid){case"ichimaga":this.pflag.indexOf("m")>=0?this.pid="ichimagam":this.pflag.indexOf("x")>=0?this.pid="ichimagax":this.pid="ichimaga";break;case"icelom":this.pflag.indexOf("a")<0&&(this.pid="icelom2");break;case"pipelink":this.body.match(/[0-9]/)&&(this.pid="pipelinkr");break;case"bonsan":if(this.pflag.indexOf("c")<0){var a=this.cols,b=this.rows;this.body.substr(0,(((a-1)*b+4)/5|0)+((a*(b-1)+4)/5|0)||0).match(/[^0]/)&&(this.pid="heyabon")}break;case"kramma":if(this.pflag.indexOf("c")<0)for(var c=(this.cols-1)*(this.rows-1),d=0,e=0;e<this.body.length;e++){var f=this.body.charAt(e);if(f.match(/\w/)){if((d+=parseInt(f,36))<c){this.pid="kramman";break}}else"."===f&&(d+=36);if(d>=c)break}}}},e=a.parser.FileData=function(b,c){this.pid=c||"",this.fstr=b,this.metadata=new a.MetaData},a.parser.FileData.prototype={pid:"",type:0,filever:0,fstr:"",qdata:"",cols:0,rows:0,body:"",history:"",metadata:null,xmldoc:null,isurl:!1,isfile:!0,FILE_AUTO:0,FILE_PZPR:1,FILE_PBOX:2,FILE_PBOX_XML:3,parse:function(){var a=this.parseFileType()&&this.parseFileData();return a&&this.changeProperPid(),a?this:null},generate:function(){return this.outputFileType()+this.outputFileData()},parseFileType:function(){var c=this.fstr.split("\n"),d=c.shift();return delete this.fstr,d.match(/^pzprv3/)?(this.type=1,d.match(/pzprv3\.(\d+)/)&&(this.filever=+RegExp.$1),this.pid=c.shift(),this.qdata=c.join("\n")):d.match(/^\<\?xml/)?(this.type=3,c.unshift(d),this.qdata=c.join("\n"),b?(this.body=(new b).parseFromString(this.qdata,"text/xml"),this.pid=this.body.querySelector("puzzle").getAttribute("type")):this.pid=""):d.match(/^\d+$/)?(this.type=2,c.unshift(d),this.qdata=c.join("\n")):this.pid="",this.pid=a.variety.toPID(this.pid),!!this.pid},outputFileType:function(){return 1===this.type?[0===this.filever?"pzprv3":"pzprv3."+this.filever,this.pid,""].join("\n"):(3===this.type&&this.body.querySelector("puzzle").setAttribute("type",a.variety(this.pid).kanpenid),"")},parseFileData:function(){var a=this.qdata.split("\n"),b=0,c=0;if(delete this.qdata,3===this.type?(c=+this.body.querySelector("size").getAttribute("row"),b=+this.body.querySelector("size").getAttribute("col"),"slither"!==this.pid&&"kakuro"!==this.pid||(c--,b--)):2===this.type&&"kakuro"===this.pid?(c=+a.shift()-1,b=+a.shift()-1):"sudoku"===this.pid?c=b=+a.shift():(c=+a.shift(),b=+a.shift()),c<=0||b<=0)return!1;if(this.rows=c,this.cols=b,1===this.type){for(var d=null,e="",f=[],g=!1,h=0;h<a.length&&!a[h].match(/^http\:\/\//);h++){if(a[h].match(/info:\{/)){d=h,g=!0;break}if(a[h].match(/history:\{|__HISTORY__/)){d=h;break}f.push(a[h])}if(this.body+=f.join("\n"),null!==d&&JSON)for(var i,j=0,h=d;h<a.length&&(e+=a[h],i=j,j+=(a[h].match(/\{/g)||[]).length,j-=(a[h].match(/\}/g)||[]).length,!(i>0&&0===j));h++);if(JSON)if(g&&"info:"===e.substr(0,5)){var k=JSON.parse(e.substr(5));this.metadata.update(k.metadata),this.history=k.history||""}else"history:"===e.substr(0,8)&&(this.history=JSON.parse(e.substr(8)))}else if(2===this.type)this.body=a.join("\n");else if(3===this.type&&this.body){var l=this.body.querySelector("property"),m=this.metadata;m.author=l.querySelector("author").getAttribute("value"),m.source=l.querySelector("source").getAttribute("value"),m.hard=l.querySelector("difficulty").getAttribute("value");var n=l.querySelector("comment");m.comment=n?n.childNodes[0].data:""}return!0},outputFileData:function(){var a=this,b=a.cols,d=a.rows,e=[],f=3===this.type?this.body.querySelector("puzzle"):null;if(3===a.type){var g=f.querySelector("size");g&&f.removeChild(g),"slither"!==a.pid&&"kakuro"!==a.pid||(d++,b++),f.appendChild(this.createXMLNode("size",{row:d,col:b}))}else 2===a.type&&"kakuro"===a.pid?(e.push(d+1),e.push(b+1)):"sudoku"===a.pid?e.push(b):(e.push(d),e.push(b));if(3!==a.type&&e.push(a.body),1===a.type&&JSON)if(a.metadata.empty())a.history&&e.push("history:"+JSON.stringify(a.history,null,1));else{var h={metadata:a.metadata.getvaliddata()};a.history&&(h.history=a.history),e.push("info:"+JSON.stringify(h,null,1))}else if(3===a.type){var i=f.querySelector("property");i&&f.removeChild(i),i=this.createXMLNode("property");var j=a.metadata;if(i.appendChild(this.createXMLNode("author",{value:j.author})),i.appendChild(this.createXMLNode("source",{value:j.source})),i.appendChild(this.createXMLNode("difficulty",{value:j.hard})),j.comment){var k=this.createXMLNode("comment");k.appendChild(this.body.createTextNode(j.comment)),i.appendChild(k)}f.appendChild(i),f.appendChild(f.querySelector("board")),f.appendChild(f.querySelector("answer"))}var l;return 3!==a.type?l=e.join("\n"):(l=(new c).serializeToString(this.body),l.match(/^\<\?xml/)||(l='<?xml version="1.0" encoding="UTF-8"?>\n'+l)),l},createXMLNode:function(a,b){var c=this.body.createElement(a);if(b)for(var d in b)c.setAttribute(d,b[d]);return c},changeProperPid:function(){if(1===this.type)switch(this.pid){case"ichimaga":var a=this.body.split("\n")[0];"mag"===a?this.pid="ichimagam":"cross"===a&&(this.pid="ichimagax");break;case"icelom":"skipwhite"===this.body.split("\n")[2]&&(this.pid="icelom2");break;case"pipelink":var b=this.body.split("\n"),c=1,d=this.rows;b.slice(c,c+d).join("").match(/o/)&&(this.pid="pipelinkr");break;case"bonsan":var b=this.body.split("\n"),c=2*this.rows,d=2*this.rows-1;b.slice(c,c+d).join("").match(/1/)&&(this.pid="heyabon");break;case"kramma":var b=this.body.split("\n"),c=this.rows,d=this.rows+1;b.slice(c,c+d).join("").match(/1/)&&(this.pid="kramman")}}}}(),a.MetaData=function(){},a.MetaData.prototype={author:"",source:"",hard:"",comment:"",items:{author:"",source:"",hard:"",comment:""},update:function(a){if(a)for(var b in this.items)"string"==typeof a[b]&&(this[b]=a[b])},getvaliddata:function(){var a={};for(var b in this.items)this[b]&&(a[b]=this[b]);return a},reset:function(){for(var a in this.items)this[a]=""},empty:function(){for(var a in this.items)if(this[a])return!1;return!0}},function(){var b=a.env.API,c=["mousedown"],d=["mousemove"],e=["mouseup"],f=[""];a.env.bz.AndroidBrowser&&(c=[""],d=[""],e=[""]),b.pointerevent?(c=["pointerdown"],d=["pointermove"],e=["pointerup"],f=["pointercancel"]):b.mspointerevent?(c=["MSPointerDown"],d=["MSPointerMove"],e=["MSPointerUp"],f=["MSPointerCancel"]):b.touchevent&&(c.push("touchstart"),d.push("touchmove"),e.push("touchend"),f.push("touchcancel")),a.util={getpath:function(){if(!a.env.browser)return require("path").dirname(__filename)+"/"+(__filename.match("pzpr.js")?"":"../");for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++){var d=b[c].src.match(/^(.*\/)pzpr\.js(?:\?.*)?$/);if(d)return d[1]+(d[1].match(/\/$/)?"":"/")}return""},currentTime:function(){return(new Date).getTime()},unselectable:function(a){return a.style.MozUserSelect="none",a.style.KhtmlUserSelect="none",a.style.webkitUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none",a.unselectable="on",this},addEvent:function(a,b,g,h,i){function j(a){h.call(g,a)}var k=[b];return"mousedown"===b?k=c:"mousemove"===b?k=d:"mouseup"===b?k=e:"mousecancel"===b&&(k=f),k.forEach(function(b){a.addEventListener(b,j,!!i)}),function(){k.forEach(function(b){a.removeEventListener(b,j,!!i)})}},getMouseButton:function(a){return void 0!==a.touches?1===a.touches.length?"left":"":a.pointerType&&"mouse"!==a.pointerType?a.isPrimary?"left":"":["left","middle","right"][void 0!==a.button?a.button:a.which-1]||""},getPagePos:function(a){return{px:this.pageX(a),py:this.pageY(a)}},pageX:function(a){if(void 0!==a.touches&&a.touches.length>0){var b=a.touches.length,c=0;if(b>0){for(var d=0;d<b;d++)c+=a.touches[d].pageX;return c/b}}return a.pageX||0},pageY:function(a){if(void 0!==a.touches&&a.touches.length>0){var b=a.touches.length,c=0;if(b>0){for(var d=0;d<b;d++)c+=a.touches[d].pageY;return c/b}}return a.pageY||0},getRect:function(b){if(!a.env.browser)return{top:0,bottom:0,left:0,right:0,height:0,width:0};var c,d,e=b.getBoundingClientRect();if(void 0!==window.scrollX)c=window.scrollX,d=window.scrollY;else{var f=document.documentElement;c=f.scrollLeft,d=f.scrollTop}var g=e.left+c,h=e.top+d,i=e.right+c,j=e.bottom+d;return{top:h,bottom:j,left:g,right:i,height:j-h,width:i-g}},checkpid:function(a,b){var c=a.match(/!?[a-z0-9-]+/g),d=!0;if(c){d=!1;for(var e=0;e<c.length;e++)"!"!==c[e].charAt(0)?c[e]===b&&(d=!0):d=c[e].substr(1)!==b}return d}}}(),function(){function b(b,d,e,g){"string"==typeof e||g||(g=e,e=void 0),b.ready=!1;var h=b.klass,i=h&&h.Board?h.Board:null,j=a.parser(d,e||b.pid);a.classmgr.setPuzzleClass(b,j.pid,function(){i!==b.klass.Board?c(b):b.painter.suspendAll();try{b.metadata.reset(),j.isurl?(new b.klass.Encode).decodeURL(j):j.isfile&&(new b.klass.FileIO).filedecode(j),b.ready=!0,b.emit("ready"),b.emit("mode"),b.canvas&&f(b),b.resetTime(),g&&g(b)}catch(a){throw b.emit("fail-open"),a}})}function c(b){var c=b.klass;b.board=new c.Board,a.classmgr.setPrototypeRef(b,"board",b.board),b.checker=new c.AnsCheck,b.painter=new c.Graphic,b.cursor=new c.TargetCursor,b.mouse=new c.MouseEvent,b.key=new c.KeyEvent,b.opemgr=new c.OperationManager,b.faillist=new c.FailCode}function d(b,c){"canvas"===c&&a.Candle.enable.canvas&&!CanvasRenderingContext2D.prototype.fillText&&(c="svg"),a.Candle.start(b.canvas,c,function(d){if(a.util.unselectable(d.canvas),d.child.style.pointerEvents="none",d.use.canvas&&!b.subcanvas){var g=b.subcanvas=e("canvas");document.body&&(g.id="_"+(new Date).getTime()+c,g.style.position="absolute",g.style.left="-10000px",g.style.top="0px",document.body.appendChild(g))}b.ready&&f(b)})}function e(b){if(!a.Candle.enable[b])return null;var c=document.createElement("div");return a.Candle.start(c,b),c}function f(a){var b=a.painter,c=a.preInitCanvasInfo;a.preInitCanvasInfo&&("viewer"!==a.instancetype?g(a):b.outputImage=!0,b.canvasWidth&&b.canvasHeight||(c.width&&c.height?b.resizeCanvas(c.width,c.height):c.cellsize&&b.resizeCanvasByCellSize(c.cellsize)),delete a.preInitCanvasInfo),b.initCanvas()}function g(b){function c(c,d){a.util.addEvent(b.canvas,c,b,d)}c("mousedown",h),c("mousemove",i),c("mouseup",j),c("mousecancel",k),b.canvas.oncontextmenu=function(){return!1},b.canvas.style.touchAction="pinch-zoom",c("keydown",l),c("keyup",m),c("click",function(a){a.stopPropagation(),a.preventDefault()})}function h(a){this.mouse&&this.mouse.e_mousedown(a)}function i(a){this.mouse&&this.mouse.e_mousemove(a)}function j(a){this.mouse&&this.mouse.e_mouseup(a)}function k(a){this.mouse&&this.mouse.e_mousecancel(a)}function l(a){this.key&&this.key.e_keydown(a)}function m(a){this.key&&this.key.e_keyup(a)}function n(a,b){var c=e(b.type),d=new a.klass.Graphic;return d.context=c.getContext("2d"),d.context.enableTextLengthWA=!1,d.outputImage=!0,"bgcolor"in b&&(d.bgcolor=b.bgcolor),"kramma"===a.pid&&(d.imgtile=a.painter.imgtile),d.resizeCanvasByCellSize(b.cellsize),d.unsuspend(),c}function o(){for(var b={},c=a.Candle.current,d=null,e=null,f=null,g=0;g<arguments.length;g++){var h=arguments[g];switch(typeof h){case"string":c=h;break;case"number":h>1.01?d=h:f=h;break;case"object":"cellsize"in h&&(d=h.cellsize),"bgcolor"in h&&(e=h.bgcolor)}}return b.type=(c||a.Candle.current).match(/svg/)?"svg":"canvas",b.mimetype="svg"!==b.type?"image/"+c:"image/svg+xml",null!==f&&void 0!==f&&(b.quality=f),null!==d&&(b.cellsize=d),null!==e&&(b.bgcolor=e),b}a.Puzzle=function(b,d){this.pzpr=a,void 0!==d||b&&b.parentNode||(d=b,b=void 0),d=d||{},this.instancetype=d.type||"editor";var e={player:1,viewer:2}[this.instancetype||0]||0;this.playeronly=!!e,this.editmode=!this.playeronly,this.playmode=!this.editmode,this.resetTime(),this.preInitCanvasInfo={type:d.graphic||"",width:d.width||null,height:d.height||null,cellsize:d.cellsize||null},this.listeners={},this.metadata=new a.MetaData,this.config=new this.Config(this),void 0!==d.config&&this.config.setAll(d.config),void 0!==d.mode&&this.setMode(d.mode),void 0!==d.variant&&this.config.set("variant",!0),b&&this.setCanvas(b),a.classmgr.setClasses(this,""),c(this)},a.Puzzle.prototype={pid:null,info:{},klass:null,ready:!1,editmode:!1,playmode:!1,playeronly:!1,instancetype:"",starttime:0,canvas:null,subcanvas:null,listeners:null,config:null,metadata:null,MODE_EDITOR:1,MODE_PLAYER:3,open:function(a,c,d){return b(this,a,c,d),this},on:function(a,b){this.addListener(a,b,!1)},once:function(a,b){this.addListener(a,b,!0)},addListener:function(a,b,c){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push({func:b,once:!!c})},emit:function(){var a=Array.prototype.slice.apply(arguments),b=a.shift(),c=this.listeners[b];if(c){a.unshift(this);for(var d=0;d<c.length;d++){var e=c[d];c[d].once&&(c.splice(d,1),d--),e.func.apply(this,a)}}},setCanvas:function(b,c){if(b){var e=a.util.getRect(b),f=document.createElement("div");f.style.width=e.width+"px",f.style.height=e.height+"px",b.appendChild(f),this.canvas=f,d(this,c||this.preInitCanvasInfo.type)}},setCanvasSize:function(a,b){this.preInitCanvasInfo?(this.preInitCanvasInfo.width=a,this.preInitCanvasInfo.height=b):this.painter.resizeCanvas(a,b)},setCanvasSizeByCellSize:function(a){this.preInitCanvasInfo?this.preInitCanvasInfo.cellsize=a:this.painter.resizeCanvasByCellSize(a)},redraw:function(a){a?this.painter.resizeCanvas():this.painter.paintAll()},irowake:function(){this.board.irowakeRemake(),(this.execConfig("irowake")||this.execConfig("irowakeblk"))&&this.redraw()},toDataURL:function(a,b,c){var d=o(a,b,c),e=n(this,d),f=e.toDataURL(d.mimetype,d.quality);return e.parentNode&&e.parentNode.removeChild(e),f},toBlob:function(a,b,c,d){var e=o(b,c,d),f=n(this,e);f.toBlob(function(b){a(b),f.parentNode&&f.parentNode.removeChild(f)},e.mimetype,e.quality)},toBuffer:function(a,b,c){var d=o(a,b,c),e=n(this,d),f=e.toBuffer(d.mimetype,d.quality);return e.parentNode&&e.parentNode.removeChild(e),f},getURL:function(a,b){return(new this.klass.Encode).encodeURL(a,b)},getFileData:function(a,b){return(new this.klass.FileIO).fileencode(a,b)},resetTime:function(){this.starttime=a.util.currentTime()},getTime:function(){return a.util.currentTime()-this.starttime},undo:function(){return this.opemgr.undo()},redo:function(){return this.opemgr.redo()},undoall:function(){for(;this.opemgr.undo(););},redoall:function(){for(;this.opemgr.redo(););},ismodified:function(){return this.opemgr.isModified()},saved:function(){return this.opemgr.resetModifiedState()},enterTrial:function(){this.opemgr.enterTrial()},acceptTrial:function(){this.opemgr.acceptTrial()},rejectTrial:function(){this.opemgr.rejectTrial(!0)},rejectCurrentTrial:function(){this.opemgr.rejectTrial(!1)},check:function(a){return a&&(this.key.keyreset(),this.mouse.mousereset()),this.checker.check(a)},ansclear:function(){this.board.ansclear(),this.board.rebuildInfo(),this.redraw()},subclear:function(){this.board.subclear(),this.redraw()},errclear:function(){var a=this.board.errclear();return a&&this.redraw(!0),a},clear:function(){this.playeronly?(this.ansclear(),this.opemgr.allerase()):(this.board.initBoardSize(),this.redraw())},setMode:function(a){this.playeronly||"string"==typeof a&&void 0===(a={edit:1,play:3}[a.substr(0,4)])||(this.editmode=a===this.MODE_EDITOR,this.playmode=!this.editmode,this.klass&&(this.cursor.adjust_modechange(),this.key.keyreset(),this.mouse.modechange(),this.board.errclear(),this.redraw()),this.emit("config","mode",a),this.emit("mode"))},getConfig:function(a){return this.config.get(a)},setConfig:function(a,b){return this.config.set(a,b)},resetConfig:function(a){return this.config.reset(a)},validConfig:function(a){return this.config.getexec(a)},execConfig:function(a){return this.config.get(a)&&this.config.getexec(a)},getCurrentConfig:function(){return this.config.getList()},saveConfig:function(){return this.config.getAll()},restoreConfig:function(a){this.config.setAll(a)}}}(),function(){(a.Puzzle.prototype.Config=function(a){this.puzzle=a,this.init()}).prototype={list:null,init:function(){this.list={},this.add("font",1,{option:[1,2]}),this.add("cursor",!0),this.add("trialmarker",!0),this.add("irowake",!1,{variety:!0}),this.add("irowakeblk",!1,{variety:!0}),this.add("dispmove",!0),this.add("disptype_yajilin",1,{option:[1,2]}),this.add("disptype_bosanowa",1,{option:[1,2,3]}),this.add("disptype_interbd",3,{option:[1,2,3]}),this.add("snakebd",!1),this.add("dispqnumbg",!1),this.add("undefcell",!0),this.add("squarecell",!0),this.add("use",a.env.API.touchevent?2:1,{option:[1,2]}),this.add("use_tri",1,{option:[1,2,3]}),this.add("support_tri",!0),this.add("bgcolor",!1),this.add("singlenum",!a.env.API.touchevent),this.add("enline",!0),this.add("lattice",!0),this.add("autocmp",!0,{variety:!0}),this.add("autoerr",!1,{variety:!0}),this.add("multierr",!1),this.add("forceallcell",!1),this.add("dontpassallcell",!1,{variant:!0,volatile:!0}),this.add("aquarium_regions",!1,{variant:!0,volatile:!0}),this.add("country_empty",!1,{variant:!0,volatile:!0}),this.add("variant",!1,{variant:!0,volatile:!0}),this.add("variantid","",{volatile:!0}),this.add("discolor",!1),this.add("uramashu",!1,{volatile:!0})},add:function(a,b,c){c||(c={});var d={val:b,defval:b,volatile:!!c.volatile,extoption:c};c.option&&(d.option=c.option),c.variety&&(d.variety={}),c.variant&&(d.variant=!0),this.list[a]=d},getCurrentName:function(a){switch(a){case"color_qanscolor":a="color_shadecolor";break;case"autocmp_area":case"autocmp_border":this.getexec("autocmp")&&(a="autocmp")}return a},getNormalizedName:function(b){var c={name:b};if(b.match(/\@/)){var d=b.split(/\@/);c.name=d[0];var e=a.variety.toPID(d[1]);e&&(c.pid=e)}return c.name=this.getCurrentName(c.name),c},get:function(a){var b=this.getNormalizedName(a),c=b.name,d=this.list[c];if(!d)return null;if(d.variety){var e=void 0!==b.pid?b.pid:this.puzzle.pid;if(void 0!==d.variety[e])return d.variety[e]}return d.val},set:function(a,b){var c=this.getNormalizedName(a),d=c.name;this.list[d]&&(b=this.setproper(c,b),this.configevent(d,b),this.puzzle.emit("config",d,b))},reset:function(a){var b=this.getNormalizedName(a),c=this.list[b.name];c&&(c.variety&&!b.pid?(c.variety={},this.set(b.name,c.defval)):this.set(a,c.defval))},getList:function(){var a={};for(var b in this.list)this.getexec(b)&&(a[b]=this.get(b));return a},getvariant:function(a){var b=this.list[a];return b?b.variant:null},getVariants:function(){var a={};for(var b in this.list)this.list[b].variant&&this.getexec(b)&&(a[b]=this.get(b));return a},getAll:function(){var a={};for(var b in this.list){var c=this.list[b];if(!c.volatile&&(c.val!==c.defval&&(a[b]=c.val),c.variety))for(var d in c.variety)c.variety[d]!==c.defval&&(a[b+"@"+d]=c.variety[d])}return a},setAll:function(a){this.init();for(var b in a)this.set(b,a[b])},setproper:function(a,b){var c=a.name,d=this.list[c];switch(typeof d.defval){case"boolean":b=!!b;break;case"number":b=+b;break;case"string":b=""+b}if(!d.option||d.option.indexOf(b)>=0)if(d.variety){var e=void 0!==a.pid?a.pid:this.puzzle.pid;e&&(d.variety[e]=b)}else d.val=b;return b},getexec:function(a){var b=this.puzzle,c=b.pid,d=!b.playeronly,e=!1;switch(a){case"use":e=b.mouse.use;break;case"use_tri":case"support_tri":e="shakashaka"===c;break;case"dispmove":e=b.board.linegraph.moveline;break;case"disptype_bosanowa":e="bosanowa"===c;break;case"disptype_yajilin":e="yajilin"===c;break;case"disptype_interbd":e="interbd"===c;break;case"bgcolor":e="slither"===c;break;case"irowake":e=b.painter.irowake;break;case"irowakeblk":e=b.painter.irowakeblk;break;case"snakebd":e="hebi"===c;break;case"dispqnumbg":e="yinyang"===c;break;case"undefcell":e="shugaku"===c;break;case"autocmp":e=!!b.painter.autocmp;break;case"autoerr":e="hitori"===c||"gokigen"===c||"wagiri"===c;break;case"singlenum":e="hanare"===c||"putteria"===c;break;case"enline":case"lattice":e="kouchoku"===c||"angleloop"===c;break;case"discolor":e=d&&"tentaisho"===c;break;case"uramashu":e="mashu"===c;break;case"forceallcell":e="fillomino"===c||"symmarea"===c;break;case"dontpassallcell":e="arukone"===c;break;case"aquarium_regions":e="aquarium"===c;break;case"country_empty":e="country"===c;break;default:e=!!this.list[a]}return e},configevent:function(a,b){var c=this.puzzle;if(c.klass&&this.getexec(a))switch(a){case"irowake":case"irowakeblk":case"dispmove":case"cursor":case"trialmarker":case"undefcell":case"autocmp":case"autoerr":case"aquarium_regions":case"snakebd":case"disptype_yajilin":case"disptype_interbd":case"dispqnumbg":c.redraw();break;case"font":c.painter.initFont(),c.redraw();break;case"multierr":c.checker.resetCache();break;case"disptype_bosanowa":c.setCanvasSizeByCellSize();break;case"uramashu":c.board.revCircleConfig(b),c.redraw()}}}}(),a.classmgr.makeCommon({Position:{bx:null,by:null,NDIR:0,UP:1,DN:2,LT:3,RT:4,equals:function(a){return this.bx===a.bx&&this.by===a.by},getaddr:function(){return new this.klass.Address(this.bx,this.by)},relcell:function(a,b){return this.board.getc(this.bx+a,this.by+b)},relcross:function(a,b){return this.board.getx(this.bx+a,this.by+b)},relbd:function(a,b){return this.board.getb(this.bx+a,this.by+b)},relexcell:function(a,b){return this.board.getex(this.bx+a,this.by+b)},relobj:function(a,b){return this.board.getobj(this.bx+a,this.by+b)},reldirbd:function(a,b){return this.getaddr().movedir(a,b).getb()},draw:function(){this.puzzle.painter.paintRange(this.bx-1,this.by-1,this.bx+1,this.by+1)},drawaround:function(){this.puzzle.painter.paintRange(this.bx-3,this.by-3,this.bx+3,this.by+3)},isinside:function(){var a=this.board;return this.bx>=a.minbx&&this.bx<=a.maxbx&&this.by>=a.minby&&this.by<=a.maxby},getdir:function(a,b){var c=a.bx-this.bx,d=a.by-this.by;return 0===c&&d===-b?this.UP:0===c&&d===b?this.DN:c===-b&&0===d?this.LT:c===b&&0===d?this.RT:this.NDIR},getvert:function(a,b){var c=this.getdir(a,b);return c===this.UP||c===this.DN||c!==this.LT&&c!==this.RT&&void 0},getnb:function(a){return a.bx-this.bx==0&&a.by-this.by==-2?this.relbd(0,-1):a.bx-this.bx==0&&a.by-this.by==2?this.relbd(0,1):a.bx-this.bx==-2&&a.by-this.by==0?this.relbd(-1,0):a.bx-this.bx==2&&a.by-this.by==0?this.relbd(1,0):this.board.emptyborder},getborderobj:function(a){return 0==(1&a.bx)&&this.bx===a.bx&&1===Math.abs(this.by-a.by)||0==(1&a.by)&&this.by===a.by&&1===Math.abs(this.bx-a.bx)?(this.onborder()?this:a).getb():this.board.nullobj}},"Address:Position":{initialize:function(a,b){arguments.length>=2&&this.init(a,b)},reset:function(){this.bx=null,this.by=null},clone:function(){return new this.constructor(this.bx,this.by)},set:function(a){return this.bx=a.bx,this.by=a.by,this},init:function(a,b){return this.bx=a,this.by=b,this},move:function(a,b){return this.bx+=a,this.by+=b,this},oncell:function(){return!!(1&this.bx&&1&this.by)},oncross:function(){return!(1&this.bx||1&this.by)},onborder:function(){return!!(this.bx+this.by&1)},getc:function(){return this.board.getc(this.bx,this.by)},getx:function(){return this.board.getx(this.bx,this.by)},getb:function(){return this.board.getb(this.bx,this.by)},getex:function(){return this.board.getex(this.bx,this.by)},getobj:function(){return this.board.getobj(this.bx,this.by)},getDot:function(){return this.board.getDot(this.bx,this.by)},movedir:function(a,b){switch(a){case this.UP:this.by-=b;break;case this.DN:this.by+=b;break;case this.LT:this.bx-=b;break;case this.RT:this.bx+=b}return this}},"RawAddress:Address":{},"Dot:Position":{isnull:!0,id:null,piece:null,getDot:function(){return this.piece.qnum},setDot:function(a){this.puzzle.opemgr.disCombine=!0,this.piece.setQnum(a),this.puzzle.opemgr.disCombine=!1},iserror:function(){return this.piece.error>0},getaddr:function(){return new this.klass.Address(this.bx,this.by)}}}),a.classmgr.makeCommon({"BoardPiece:Position":{group:"none",id:null,isnull:!0,ques:0,qdir:0,qnum:-1,qnum2:-1,qnum3:-1,
qnum4:-1,qchar:0,qans:0,anum:-1,line:0,qsub:0,qcmp:0,snum:-1,error:0,qinfo:0,trial:0,propques:["ques","qdir","qnum","qnum2","qchar"],propans:["qans","anum","line","trial"],propsub:["qsub","qcmp","snum"],propinfo:["error","qinfo"],propnorec:{color:1,error:1,qinfo:1},maxnum:999,minnum:1,initAdjacent:function(){this.adjacent={top:this.relobj(0,-2),bottom:this.relobj(0,2),left:this.relobj(-2,0),right:this.relobj(2,0)}},initAdjBorder:function(){this.adjborder={top:this.relbd(0,-1),bottom:this.relbd(0,1),left:this.relbd(-1,0),right:this.relbd(1,0)}},setQues:function(a){this.setdata("ques",a)},setQans:function(a){this.setdata("qans",a)},setQdir:function(a){this.setdata("qdir",a)},setQnum:function(a){this.setdata("qnum",a)},setQnum2:function(a){this.setdata("qnum2",a)},setQchar:function(a){this.setdata("qchar",a)},setAnum:function(a){this.setdata("anum",a)},setLineVal:function(a){this.setdata("line",a)},setQsub:function(a){this.setdata("qsub",a)},setQcmp:function(a){this.setdata("qcmp",a)},setSnum:function(a){this.setdata("snum",a)},setQnumDir:function(a,b){switch(a){case this.RT:return void this.setdata("qnum",b);case this.DN:return void this.setdata("qnum2",b);case this.LT:return void this.setdata("qnum3",b);case this.UP:return void this.setdata("qnum4",b)}},getQnumDir:function(a){switch(a){case this.RT:return this.qnum;case this.DN:return this.qnum2;case this.LT:return this.qnum3;case this.UP:return this.qnum4}return-1},setdata:function(a,b,c){if(this[a]!==b&&(!this.prehook[a]||!this.prehook[a].call(this,b)||c)){this.addOpe(a,this[a],b),this[a]=b;var d=this.board.trialstage;d>0&&(this.trial=d),this.board.modifyInfo(this,this.group+"."+a),this.posthook[a]&&this.posthook[a].call(this,b)}},addOpe:function(a,b,c){b!==c&&this.puzzle.opemgr.add(new this.klass.ObjectOperation(this,a,b,c))},setdata2:function(a,b,c,d){if(this[a][b]!==c&&(!this.prehook[a]||!this.prehook[a].call(this,b,c)||d)){this.addOpe(a+b,this[a][b],c),this[a][b]=c;var e=this.board.trialstage;e>0&&(this.trial=e),this.posthook[a]&&this.posthook[a].call(this,b,c)}},getprops:function(){for(var a={},b=this.getproplist(["ques","ans","sub"]),c=0;c<b.length;c++){var d=b[c];a[d]=this[d]}return a},compare:function(a,b){for(var c=this.getproplist(["ques","ans","sub"]),d=0;d<c.length;d++){var e=c[d];a[e]!==this[e]&&b(this.group,this.id,e)}},getproplist:function(a){for(var b=[],c=0;c<a.length;c++){var d=[];switch(a[c]){case"ques":d=this.propques;break;case"ans":d=this.propans;break;case"sub":d=this.propsub;break;case"info":d=this.propinfo;break;case"trial":d=["trial"]}b=b.concat(d)}return b.indexOf("snum")>=0&&this.enableSubNumberArray&&b.splice(b.indexOf("snum"),1,"snum0","snum1","snum2","snum3"),b},getmaxnum:function(){return"function"==typeof this.maxnum?this.maxnum():this.maxnum},getminnum:function(){return"function"==typeof this.minnum?this.minnum():this.minnum},prehook:{},posthook:{},seterr:function(a){this.board.isenableSetError()&&(this.error=a)},setinfo:function(a){this.qinfo=a}},"Cell:BoardPiece":{group:"cell",lcnt:0,base:null,dirs51:2,disInputHatena:!1,numberWithMB:!1,numberAsObject:!1,numberAsLetter:!1,numberRemainsUnshaded:!1,enableSubNumberArray:!1,supportQnumAnum:!1,adjacent:{},adjborder:{},initialize:function(){if(this.temp=this.constructor.prototype,this.enableSubNumberArray){var a=this.temp.anum;this.snum=[a,a,a,a]}},prehook:{qnum:function(a){return this.getminnum()>0&&0===a},qnum2:function(a){return this.getminnum()>0&&0===a},anum:function(a){return this.getminnum()>0&&0===a}},posthook:{},isShade:function(){return!this.isnull&&1===this.qans},isUnshade:function(){return!this.isnull&&1!==this.qans},setShade:function(){this.setQans(1)},clrShade:function(){this.setQans(0)},allowShade:function(){return!this.numberRemainsUnshaded||-1===this.qnum},allowUnshade:function(){return!this.numberRemainsUnshaded||(-1===this.qnum||this.puzzle.painter.enablebcolor)},isShadeDecided:function(){return!!this.isnull||(!!this.isShade()||(this.qsub>0||(!this.allowShade()||!this.allowUnshade())))},getNum:function(){return-1!==this.qnum?this.qnum:this.anum},setNum:function(a){if(!(this.getminnum()>0&&0===a))if(this.puzzle.editmode)a=!this.numberAsObject&&-2!==a||this.qnum!==a?a:-1,this.setQnum(a),this.setAnum(-1),this.numberRemainsUnshaded&&this.setQans(0),this.puzzle.painter.enablebcolor||this.setQsub(0),this.setQcmp(0),this.clrSnum();else if(-1===this.qnum){var b=a>-1&&(!this.numberAsObject||this.anum!==a)?a:-1,c=a<-1&&(!this.numberAsObject||this.qsub!==-a-1)?-a-1:0;this.setAnum(b),this.setQsub(c),this.setQdir(0),this.setQcmp(0),this.numberWithMB&&-1===b||this.clrSnum()}},isNum:function(){return!this.isnull&&(this.qnum!==this.temp.qnum||this.anum!==this.temp.anum)},noNum:function(){return!this.isnull&&this.qnum===this.temp.qnum&&this.anum===this.temp.anum},isValidNum:function(){return!this.isnull&&(this.qnum>=0||this.anum>=0&&this.qnum===this.temp.qnum)},isNumberObj:function(){return this.qnum!==this.temp.qnum||this.anum!==this.temp.anum||this.numberWithMB&&1===this.qsub},sameNumber:function(a){return this.isValidNum()&&this.getNum()===a.getNum()},setSnum:function(a,b){this.isNum()&&-1!==b||(this.enableSubNumberArray?this.setdata2("snum",a,b):this.setdata("snum",b))},clrSnum:function(){this.enableSubNumberArray?(this.setSnum(0,-1),this.setSnum(1,-1),this.setSnum(2,-1),this.setSnum(3,-1)):this.setSnum(-1)},is51cell:function(){return 51===this.ques},set51cell:function(a){this.setQues(51);for(var b=1;b<=4;b++)this.setQnumDir(b,-1);this.setAnum(-1)},remove51cell:function(a){this.setQues(0);for(var b=1;b<=4;b++)this.setQnumDir(b,-1);this.setAnum(-1)},ice:function(){return 6===this.ques},isDot:function(){return 1===this.qsub},isEmpty:function(){return this.isnull||7===this.ques},isValid:function(){return!this.isnull&&7!==this.ques},isDeparture:function(){return!this.isnull&&!!this.base&&this.isNum()},isDestination:function(){return!this.isnull&&!!this.base&&!this.base.isnull},isLineStraight:function(){return 2===this.lcnt&&this.adjborder.top.isLine()&&this.adjborder.bottom.isLine()?1:2===this.lcnt&&this.adjborder.left.isLine()&&this.adjborder.right.isLine()?2:0},isLineCurve:function(){return 2===this.lcnt&&!this.isLineStraight()},isLPobj:{1:{11:1,12:1,14:1,15:1},2:{11:1,12:1,16:1,17:1},3:{11:1,13:1,15:1,16:1},4:{11:1,13:1,14:1,17:1}},noLPobj:{1:{1:1,4:1,5:1,13:1,16:1,17:1,21:1},2:{1:1,2:1,3:1,13:1,14:1,15:1,21:1},3:{1:1,2:1,5:1,12:1,14:1,17:1,22:1},4:{1:1,3:1,4:1,12:1,15:1,16:1,22:1}},isLP:function(a){return!!this.isLPobj[a][this.ques]},noLP:function(a){return!!this.noLPobj[a][this.ques]},countDir4Cell:function(a){for(var b=this.adjacent,c=0,d=[b.top,b.bottom,b.left,b.right],e=0;e<4;e++)"cell"===d[e].group&&!d[e].isnull&&a(d[e])&&c++;return c},getdir4clist:function(){for(var a=this.adjacent,b=[],c=[a.top,a.bottom,a.left,a.right],d=0;d<4;d++)"cell"!==c[d].group||c[d].isnull||b.push([c[d],d+1]);return b},getdir4cblist:function(){for(var a=this.adjacent,b=this.adjborder,c=[],d=[a.top,a.bottom,a.left,a.right],e=[b.top,b.bottom,b.left,b.right],f=0;f<4;f++)("cell"!==d[f].group||d[f].isnull)&&e[f].isnull||c.push([d[f],e[f],f+1]);return c},getOrthogonalCell:function(a){return this.bx===a.bx?this.by===a.by?this.board.emptycell:this.by>a.by?this.adjacent.top:this.adjacent.bottom:this.by===a.by?this.bx>a.bx?this.adjacent.left:this.adjacent.right:this.board.emptycell},eraseMovedLines:function(){if(null!==this.path){for(var a=this.path.clist,b=0,c=0,d=a.length;c<d;c++)for(var e=c+1;e<d;e++){var f=a[c].getnb(a[e]);f.isnull||(f.removeLine(),b++)}b>0&&a.draw()}}},"Cross:BoardPiece":{group:"cross",lcnt:0,adjborder:{},getNum:function(){return this.qnum},setNum:function(a){a=-2===a&&this.qnum===a?-1:a,this.setQnum(a)},noNum:function(){return!this.isnull&&-1===this.qnum},setCrossBorderError:function(){this.seterr(1),this.board.borderinside(this.bx-1,this.by-1,this.bx+1,this.by+1).seterr(1)}},"Border:BoardPiece":{initialize:function(){this.sidecell=[null,null],this.sidecross=[null,null],this.sideobj=[]},group:"border",isvert:!1,inside:!1,path:null,enableLineNG:!1,initSideObject:function(){var a=2===this.board.hasborder&&2===this.board.hasexcell;this.isvert?(this.sidecell[0]=!a||this.bx>0?this.relcell(-1,0):this.relexcell(-1,0),this.sidecell[1]=!a||this.bx<2*this.board.cols?this.relcell(1,0):this.relexcell(1,0),this.sidecross[0]=this.relcross(0,-1),this.sidecross[1]=this.relcross(0,1)):(this.sidecell[0]=!a||this.by>0?this.relcell(0,-1):this.relexcell(0,-1),this.sidecell[1]=!a||this.by<2*this.board.rows?this.relcell(0,1):this.relexcell(0,1),this.sidecross[0]=this.relcross(-1,0),this.sidecross[1]=this.relcross(1,0)),this.sideobj=this.board.borderAsLine?this.sidecross:this.sidecell},prehook:{qans:function(a){return 0!==this.ques},line:function(a){return this.checkStableLine(a)}},posthook:{},draw:function(){this.puzzle.painter.paintRange(this.bx-2,this.by-2,this.bx+2,this.by+2)},isLine:function(){return this.line>0},setLine:function(a){this.setLineVal(1),2===this.qsub&&this.setQsub(0)},setPeke:function(a){this.setLineVal(0),this.setQsub(2)},removeLine:function(a){this.setLineVal(0),2===this.qsub&&this.setQsub(0)},removeLineAndQsub:function(a){this.setLineVal(0),this.setQsub(0)},isBorder:function(){return this.ques>0||this.qans>0},setBorder:function(){this.puzzle.editmode?(this.setQues(1),this.setQans(0)):1!==this.ques&&this.setQans(1)},removeBorder:function(){this.puzzle.editmode?(this.setQues(0),this.setQans(0)):1!==this.ques&&this.setQans(0)},isVert:function(){return this.isvert},isHorz:function(){return!this.isvert},checkStableLine:function(a){return!!this.enableLineNG&&(0!==a&&this.isLineNG())},checkFormCurve:function(a){if(0===a)return!1;for(var b=0;b<=1;b++){if(this.isVert()&&(this.sidecell[b].adjborder.top.isLine()||this.sidecell[b].adjborder.bottom.isLine()))return!0;if(!this.isVert()&&(this.sidecell[b].adjborder.left.isLine()||this.sidecell[b].adjborder.right.isLine()))return!0}return!1},isLineEX:function(){return!1},isLineNG:function(){var a=this.sidecell[0],b=this.sidecell[1];return this.isVert()?a.noLP(a.RT)||b.noLP(b.LT):a.noLP(a.DN)||b.noLP(b.UP)}},"ExCell:BoardPiece":{group:"excell",adjacent:{},getNum:function(){return this.qnum},setNum:function(a){this.setQnum(a)},noNum:function(){return!this.isnull&&-1===this.qnum},is51cell:function(){return 51===this.ques},ice:function(){return!1}}}),a.classmgr.makeCommon({PieceList:{initialize:function(a){a&&this.extend(a)},length:0,add:Array.prototype.push,extend:function(a){var b=a.length,c=this.length;this.length+=b;for(var d=0;d<b;d++)this[c+d]=a[d]},pop:Array.prototype.pop,each:Array.prototype.forEach,some:Array.prototype.some,filter:function(a){for(var b=new this.constructor,c=this.length,d=0,e=0;e<c;e++)a(this[e])&&(b[d]=this[e],d++);return b.length=d,b},notnull:function(a){return this.filter(function(a){return!a.isnull})},map:function(a){for(var b=new this.constructor,c=b.length=this.length,d=0;d<c;d++)b[d]=a(this[d]);return b},indexOf:Array.prototype.indexOf,include:function(a){return this.indexOf(a)>=0},remove:function(a){var b=this.indexOf(a);b>=0&&Array.prototype.splice.call(this,b,1)},seterr:function(a){if(this.board.isenableSetError())for(var b=0;b<this.length;b++)this[b].error=a},setnoerr:function(){if(this.board.isenableSetError())for(var a=0;a<this.length;a++)0===this[a].error&&(this[a].error=-1)},setinfo:function(a){for(var b=0;b<this.length;b++)this[b].qinfo=a},allclear:function(a){this.propclear(["ques","ans","sub","info"],a)},ansclear:function(){this.propclear(["ans","sub","info"],!0)},subclear:function(){this.propclear(["sub","info"],!0)},errclear:function(){this.propclear(["info"],!1)},trialclear:function(){this.propclear(["trial"],!1)},propclear:function(a,b){var c=[],d={};this.length>0&&(c=this[0].getproplist(a),d=this[0].propnorec);for(var e=0;e<this.length;e++)for(var f=this[e],g=0;g<c.length;g++){var h=c[g],i="";if(h.length>4&&"snum"===h.substr(0,4)){i=h.charAt(4),h=h.substr(0,4);var j=f.constructor.prototype[h];f[h][i]!==j&&(b&&!d[h]&&f.addOpe(h+i,f[h][i],j),f[h][i]=j)}else{var j=f.constructor.prototype[h];f[h]!==j&&(b&&!d[h]&&f.addOpe(h,f[h],j),f[h]=j)}}}},"CellList:PieceList":{getRectSize:function(){for(var a=this.board,b={x1:a.maxbx+1,x2:a.minbx-1,y1:a.maxby+1,y2:a.minby-1,cols:0,rows:0,cnt:0},c=0;c<this.length;c++){var d=this[c];b.x1>d.bx&&(b.x1=d.bx),b.x2<d.bx&&(b.x2=d.bx),b.y1>d.by&&(b.y1=d.by),b.y2<d.by&&(b.y2=d.by),b.cnt++}return b.cols=(b.x2-b.x1+2)/2,b.rows=(b.y2-b.y1+2)/2,b},getQnumCell:function(){for(var a=0,b=this.length;a<b;a++)if(this[a].isNum())return this[a];return this.board.emptycell},getTopCell:function(){for(var a=this.board,b=null,c=a.maxbx,d=a.maxby,e=0;e<this.length;e++){var f=this[e];f.bx>c||f.bx===c&&f.by>=d||(b=this[e],c=f.bx,d=f.by)}return b},eraseLines:function(){for(var a=0,b=0,c=this.length;b<c;b++)for(var d=b+1;d<c;d++){var e=this.puzzle.mouse.getnb(this[b].getaddr(),this[d].getaddr());e.isnull||(e.removeLine(),a++)}a>0&&this.draw()},draw:function(){var a=this.getRectSize();this.puzzle.painter.paintRange(a.x1-1,a.y1-1,a.x2+1,a.y2+1)}},"CrossList:PieceList":{},"BorderList:PieceList":{cellinside:function(){for(var a=new this.klass.CellList,b=[],c=0;c<this.length;c++){var d=this[c],e=d.sidecell[0],f=d.sidecell[1];e.isnull||!0===b[e.id]||(a.add(e),b[e.id]=!0),f.isnull||!0===b[f.id]||(a.add(f),b[f.id]=!0)}return a},crossinside:function(){for(var a=new this.klass.CrossList,b=[],c=0;c<this.length;c++){var d=this[c],e=d.sidecross[0],f=d.sidecross[1];e.isnull||!0===b[e.id]||(a.add(e),b[e.id]=!0),f.isnull||!0===b[f.id]||(a.add(f),b[f.id]=!0)}return a}},"ExCellList:PieceList":{}}),a.classmgr.makeCommon({Board:{initialize:function(){var a=this.klass;this.minbx=0,this.minby=0,this.maxbx=0,this.maxby=0,this.diserror=0,this.haserror=!1,this.hasinfo=!1,this.cell=new a.CellList,this.cross=new a.CrossList,this.border=new a.BorderList,this.excell=new a.ExCellList,this.nullobj=new a.BoardPiece,this.emptycell=new a.Cell,this.emptycross=new a.Cross,this.emptyborder=new a.Border,this.emptyexcell=new a.ExCell;try{Object.freeze(this.nullobj),Object.freeze(this.emptycell),Object.freeze(this.emptycross),Object.freeze(this.emptyborder),Object.freeze(this.emptyexcell)}catch(a){}this.createExtraObject(),this.disrecinfo=0,this.infolist=[],this.linegraph=this.addInfoList(a.LineGraph),this.roommgr=this.addInfoList(a.AreaRoomGraph),this.sblkmgr=this.addInfoList(a.AreaShadeGraph),this.ublkmgr=this.addInfoList(a.AreaUnshadeGraph),this.nblkmgr=this.addInfoList(a.AreaNumberGraph),this.addExtraInfo(),this.exec=new a.BoardExec,this.exec.insex.cross=1===this.hascross?{2:!0}:{0:!0},this.trialstage=0},addInfoList:function(a){var b=new a;return b.enabled&&this.infolist.push(b),b},addExtraInfo:function(){},cols:10,rows:10,hascross:2,hasborder:0,hasexcell:0,hasflush:0,borderAsLine:!1,disable_subclear:!1,excellRows:function(a,b){return 1},excellCols:function(a,b){return 1},initBoardSize:function(a,b){(void 0===a||isNaN(a))&&(a=this.cols,b=this.rows),this.allclear(!1),this.initGroup("cell",a,b),this.initGroup("cross",a,b),this.initGroup("border",a,b),this.initGroup("excell",a,b),this.cols=a,this.rows=b,this.setminmax(),this.setposAll(),this.hasdots&&this.initDots(this.cols,this.rows,2===this.hasdots),this.initExtraObject(a,b),this.rebuildInfo(),this.puzzle.cursor.initCursor(),this.puzzle.opemgr.allerase()},createExtraObject:function(){},initExtraObject:function(a,b){},initGroup:function(a,b,c){var d=this.getGroup(a),e=this.estimateSize(a,b,c),f=d.length;if(f>e)for(var g=f-1;g>=e;g--)d.pop();else if(f<e){for(var h=new d.constructor,g=f;g<e;g++){var i=this.newObject(a,g);d.add(i),h.add(i)}h.allclear(!1)}return d.length=e,e-f},getGroup:function(a){return"cell"===a?this.cell:"cross"===a?this.cross:"border"===a?this.border:"excell"===a?this.excell:new this.klass.PieceList},estimateSize:function(a,b,c){if("cell"===a)return b*c;if("cross"===a)return(b+1)*(c+1);if("border"===a){if(1===this.hasborder)return 2*b*c-(b+c);if(2===this.hasborder)return 2*b*c+(b+c)}else if("excell"===a){if(1===this.hasexcell){var d=this.excellRows(b,c),e=this.excellCols(b,c);return b*=d,c*=e,b+c+(51===this.emptyexcell.ques?1:0)}if(2===this.hasexcell)return 2*(b+c)}return 0},newObject:function(a,b){var c=this.nullobj,d=this.klass;return"cell"===a?c=new d.Cell:"cross"===a?c=new d.Cross:"border"===a?c=new d.Border:"excell"===a&&(c=new d.ExCell),c!==this.nullobj&&void 0!==b&&(c.id=b),c},setposAll:function(){this.setposCells(),this.setposCrosses(),this.setposBorders(),this.setposExCells()},setposGroup:function(a){"cell"===a?this.setposCells():"cross"===a?this.setposCrosses():"border"===a?this.setposBorders():"excell"===a&&this.setposExCells()},setposCells:function(){for(var a=this.cols,b=0;b<this.cell.length;b++){var c=this.cell[b];c.id=b,c.isnull=!1,c.bx=b%a*2+1,c.by=1+(b/a<<1),c.initAdjacent(),c.initAdjBorder()}},setposCrosses:function(){for(var a=this.cols,b=0;b<this.cross.length;b++){var c=this.cross[b];c.id=b,c.isnull=!1,c.bx=b%(a+1)*2,c.by=b/(a+1)<<1,c.initAdjBorder()}},setposBorders:function(){for(var a=this.cols,b=this.rows,c=2*a*b-a-b,d=0;d<this.border.length;d++){var e=this.border[d],f=d;e.id=d,e.isnull=!1,f>=0&&f<(a-1)*b&&(e.bx=f%(a-1)*2+2,e.by=1+(f/(a-1)<<1)),f-=(a-1)*b,f>=0&&f<a*(b-1)&&(e.bx=f%a*2+1,e.by=2+(f/a<<1)),f-=a*(b-1),2===this.hasborder&&(f>=0&&f<a&&(e.bx=2*f+1,e.by=0),f-=a,f>=0&&f<a&&(e.bx=2*f+1,e.by=2*b),f-=a,f>=0&&f<b&&(e.bx=0,e.by=2*f+1),f-=b,f>=0&&f<b&&(e.bx=2*a,e.by=2*f+1),f-=b),e.isvert=!(1&e.bx),e.inside=d<c,e.initSideObject()}},setposExCells:function(){for(var a=this.excellRows(this.cols,this.rows),b=this.excellCols(this.cols,this.rows),c=this.cols*a,d=this.rows*b,e=0;e<this.excell.length;e++){var f=this.excell[e],g=e;f.id=e,f.isnull=!1,1===this.hasexcell?(g>=0&&g<c&&(f.bx=2*(g/a|0)+1,f.by=g%a*-2-1),g-=c,g>=0&&g<d&&(f.bx=g%b*-2-1,f.by=2*(g/b|0)+1),g-=d,0===g&&51===f.ques&&(f.bx=-1,f.by=-1),g--):2===this.hasexcell&&(g>=0&&g<c&&(f.bx=2*g+1,f.by=-1),g-=c,g>=0&&g<c&&(f.bx=2*g+1,f.by=2*d+1),g-=c,g>=0&&g<d&&(f.bx=-1,f.by=2*g+1),g-=d,g>=0&&g<d&&(f.bx=2*c+1,f.by=2*g+1),g-=d),f.initAdjacent()}},setminmax:function(){var a=this.hasexcell>0,b=2===this.hasexcell;this.minbx=a?-2*this.excellCols(this.cols,this.rows):0,this.minby=a?-2*this.excellRows(this.cols,this.rows):0,this.maxbx=b?2*this.cols+2:2*this.cols,this.maxby=b?2*this.rows+2:2*this.rows,this.puzzle.cursor.setminmax()},allclear:function(a){this.cell.allclear(a),this.cross.allclear(a),this.border.allclear(a),this.excell.allclear(a),a&&this.puzzle.opemgr.rejectTrial(!0)},ansclear:function(){var a=this.puzzle.opemgr;a.rejectTrial(!0),a.newOperation(),a.add(new this.puzzle.klass.BoardClearOperation),this.cell.ansclear(),this.cross.ansclear(),this.border.ansclear(),this.excell.ansclear(),this.rebuildInfo()},subclear:function(){this.puzzle.opemgr.newOperation(),this.cell.subclear(),this.cross.subclear(),this.border.subclear(),this.excell.subclear()},errclear:function(){var a=this.haserror||this.hasinfo;return a&&(this.cell.errclear(),this.cross.errclear(),this.border.errclear(),this.excell.errclear(),this.haserror=!1,this.hasinfo=!1),a},trialclear:function(a){(this.trialstage>0||a)&&(this.cell.trialclear(),this.cross.trialclear(),this.border.trialclear(),this.excell.trialclear(),this.puzzle.redraw(),this.trialstage=0)},getObjectPos:function(a,b,c){var d=this.nullobj;return"cell"===a?d=this.getc(b,c):"cross"===a?d=this.getx(b,c):"border"===a?d=this.getb(b,c):"excell"===a?d=this.getex(b,c):"obj"===a&&(d=this.getobj(b,c)),d},getc:function(a,b){var c=null,d=this.cols,e=this.rows;return!(a<0||a>d<<1||b<0||b>e<<1)&&1&a&&1&b&&(c=(a>>1)+(b>>1)*d),null!==c?this.cell[c]:this.emptycell},getx:function(a,b){var c=null,d=this.cols,e=this.rows;return a<0||a>d<<1||b<0||b>e<<1||1&a||1&b||(c=(a>>1)+(b>>1)*(d+1)),0!==this.hascross&&null!==c?this.cross[c]:this.emptycross},getb:function(a,b){var c=null,d=this.cols,e=this.rows;return this.hasborder&&a>=1&&a<=2*d-1&&b>=1&&b<=2*e-1?!(1&a)&&1&b?c=(a>>1)-1+(b>>1)*(d-1):1&a&&!(1&b)&&(c=(a>>1)+((b>>1)-1)*d+(d-1)*e):2===this.hasborder&&(0===b&&1&a&&a>=1&&a<=2*d-1?c=(d-1)*e+d*(e-1)+(a>>1):b===2*e&&1&a&&a>=1&&a<=2*d-1?c=(d-1)*e+d*(e-1)+d+(a>>1):0===a&&1&b&&b>=1&&b<=2*e-1?c=(d-1)*e+d*(e-1)+2*d+(b>>1):a===2*d&&1&b&&b>=1&&b<=2*e-1&&(c=(d-1)*e+d*(e-1)+2*d+e+(b>>1))),null!==c?this.border[c]:this.emptyborder},getex:function(a,b){var c=this.excellRows(this.cols,this.rows),d=this.excellCols(this.cols,this.rows),e=null,f=this.cols*c,g=this.rows*d;return 1===this.hasexcell?51===this.emptyexcell.ques&&-1===a&&-1===b?e=f+g:b>=this.minby&&b<0&&a>0&&a<2*f?e=(-b>>1)+(a>>1)*c:a>=this.minbx&&a<0&&b>0&&b<2*g&&(e=(-a>>1)+f+(b>>1)*d):2===this.hasexcell&&(-1===b&&a>0&&a<2*f?e=a>>1:b===2*g+1&&a>0&&a<2*f?e=f+(a>>1):-1===a&&b>0&&b<2*g?e=2*f+(b>>1):a===2*f+1&&b>0&&b<2*g&&(e=2*f+g+(b>>1))),null!==e?this.excell[e]:this.emptyexcell},getobj:function(a,b){if(a+b&1)return this.getb(a,b);if(!(1&a||1&b))return this.getx(a,b);var c=this.getc(a,b);return c===this.emptycell&&this.hasexcell?this.getex(a,b):c},operate:function(a){if(this.trialstage>0&&this.exec.isBoardOp(a))throw"board operations are not possible in trial mode";this.exec.execadjust(a)},flushexcell:function(){this.puzzle.opemgr.newOperation();var a=this.cols,b=this.rows,c=this.excell;this.genericFlush(this.excellCols(a,b),this.excellRows(a,b),a,b,function(a){return c[a].qnum},function(a,b){c[a].setQnum(b)}),this.puzzle.redraw()},genericFlush:function(a,b,c,d,e,f){for(var g=c*b,h=d*a,i=0,j=0;j<g+h;j++)if(-1!==e(j)&&(j!==i-1&&f(i,e(j)),i++),j<g&&j%b==b-1||j>=g&&(j-g)%a==a-1){for(var k=i;k<=j;k++)f(k,-1);i=j+1}},objectinside:function(a,b,c,d,e){return"cell"===a?this.cellinside(b,c,d,e):"cross"===a?this.crossinside(b,c,d,e):"border"===a?this.borderinside(b,c,d,e):"excell"===a?this.excellinside(b,c,d,e):new this.klass.PieceList},cellinside:function(a,b,c,d){for(var e=new this.klass.CellList,f=1|b;f<=d;f+=2)for(var g=1|a;g<=c;g+=2){var h=this.getc(g,f);h.isnull||e.add(h)}return e},crossinside:function(a,b,c,d){var e=new this.klass.CrossList;if(this.hascross)for(var f=b+(1&b);f<=d;f+=2)for(var g=a+(1&a);g<=c;g+=2){var h=this.getx(g,f);h.isnull||e.add(h)}return e},borderinside:function(a,b,c,d){var e=new this.klass.BorderList;if(this.hasborder)for(var f=b;f<=d;f++)for(var g=a+(a+f&1^1);g<=c;g+=2){var h=this.getb(g,f);h.isnull||e.add(h)}return e},excellinside:function(a,b,c,d){var e=new this.klass.ExCellList;if(this.hasexcell)for(var f=1|b;f<=d;f+=2)for(var g=1|a;g<=c;g+=2){var h=this.getex(g,f);h&&!h.isnull&&e.add(h)}return e},disableInfo:function(){this.puzzle.opemgr.disableRecord(),this.disrecinfo++},enableInfo:function(){this.puzzle.opemgr.enableRecord(),this.disrecinfo>0&&this.disrecinfo--},isenableInfo:function(){return 0===this.disrecinfo},rebuildInfo:function(){this.infolist.forEach(function(a){a.rebuild()})},modifyInfo:function(a,b){if(this.isenableInfo())for(var c=0;c<this.infolist.length;++c){var d=this.infolist[c];d.relation[b]&&d.modifyInfo(a,b)}},irowakeRemake:function(){for(var a=0;a<this.infolist.length;++a){var b=this.infolist[a];b.coloring&&b.newIrowake()}},disableSetError:function(){this.diserror++},enableSetError:function(){this.diserror--},isenableSetError:function(){return this.diserror<=0},freezecopy:function(){var a={cell:[],cross:[],border:[],excell:[]};for(var b in a)for(var c=0;c<this[b].length;c++)a[b][c]=this[b][c].getprops();return a},compareData:function(a,b){for(var c in a)if(this[c])for(var d=0;d<a[c].length;d++)this[c][d]&&this[c][d].compare(a[c][d],b)},dotsmax:0,dots:[],initDots:function(a,b,c){var d=2*a+(c?1:-1),e=2*b+(c?1:-1);this.dotsmax=d*e,this.dots=[];for(var f=0;f<this.dotsmax;f++){this.dots[f]=new this.klass.Dot;var g=this.dots[f];g.id=f,g.bx=f%d+(c?0:1),g.by=(f/d|0)+(c?0:1),g.isnull=!1,g.piece=g.getaddr().getobj()}},getDot:function(a,b){var c=this.cols,d=this.rows,e=-1;if(1===this.hasdots){if(a<=0||a>=c<<1||b<=0||b>=d<<1)return null;e=a-1+(b-1)*(2*c-1)}if(2===this.hasdots){if(a<0||a>c<<1||b<0||b>d<<1)return null;e=a+b*(2*c+1)}if(-1===e)return null;var f=this.dots[e];return f.isnull?null:f},dotinside:function(a,b,c,d){for(var e=new this.klass.PieceList,f=b;f<=d;f++)for(var g=a;g<=c;g++){var h=this.getDot(g,f);h&&e.add(h)}return e}}}),function(){a.classmgr.makeCommon({BoardExec:{UP:1,DN:2,LT:3,RT:4,EXPAND:16,REDUCE:32,TURN:64,FLIP:128,TURNFLIP:192,EXPANDUP:17,EXPANDDN:18,EXPANDLT:19,EXPANDRT:20,REDUCEUP:33,REDUCEDN:34,REDUCELT:35,REDUCERT:36,TURNL:65,TURNR:66,FLIPX:129,FLIPY:130,boardtype:{expandup:[33,17],expanddn:[34,18],expandlt:[35,19],expandrt:[36,20],reduceup:[17,33],reducedn:[18,34],reducelt:[19,35],reducert:[20,36],turnl:[66,65],turnr:[65,66],flipy:[130,130],flipx:[129,129]},qnumw:[],qnumh:[],insex:{cell:{1:!0},cross:{},border:{1:!0,2:!0},excell:{1:!0}},isBoardOp:function(a){return!!this.boardtype[a]},execadjust:function(a){if(this.isBoardOp(a)){var b=this.puzzle,c=this.board;if(0===a.indexOf("reduce"))if("reduceup"===a||"reducedn"===a){if(c.rows<=1)return}else if(("reducelt"===a||"reducert"===a)&&c.cols<=1)return;b.opemgr.newOperation(),b.painter.suspendAll();var d={x1:0,y1:0,x2:2*c.cols,y2:2*c.rows};this.execadjust_main(this.boardtype[a][1],d),this.addOpe(d,a),c.setminmax(),c.rebuildInfo(),b.painter.resizeCanvas(),b.emit("adjust"),b.painter.unsuspend()}},execadjust_main:function(a,b){var c=this.board;if(this.adjustBoardData(a,b),c.roommgr.hastop&&32&a&&this.reduceRoomNumber(a,b),64&a){var d=c.cols;c.cols=c.rows,c.rows=d,b={x1:0,y1:0,x2:2*c.cols,y2:2*c.rows}}else 16&a&&(a===this.EXPANDUP||a===this.EXPANDDN?c.rows++:a!==this.EXPANDLT&&a!==this.EXPANDRT||c.cols++);["cell","cross","border","excell"].forEach(function(d){16&a?c.exec.expandGroup(d,a):32&a?c.exec.reduceGroup(d,a):c.exec.turnflipGroup(d,a,b)}),32&a&&(a===this.REDUCEUP||a===this.REDUCEDN?c.rows--:a!==this.REDUCELT&&a!==this.REDUCERT||c.cols--),c.setposAll(),c.hasdots&&c.initDots(c.cols,c.rows,2===c.hasdots),this.adjustBoardData2(a,b)},addOpe:function(a,b){var c,d=this.boardtype[b][1],e=this.puzzle;c=d&this.TURNFLIP?new e.klass.BoardFlipOperation(a,b):new e.klass.BoardAdjustOperation(b),e.opemgr.add(c)},expandGroup:function(a,b){var c=this.board,d=c.initGroup(a,c.cols,c.rows),e=c.getGroup(a),f=new e.constructor;c.setposGroup(a);for(var g=e.length-1;g>=0;g--){var h=e[g];this.isdel(b,h)?(h=c.newObject(a,g),e[g]=h,f.add(h),d--):d>0&&(e[g]=e[g-d])}f.allclear(!1),"border"===a&&this.expandborder(b)},reduceGroup:function(a,b){var c=this.board;"border"===a&&this.reduceborder(b);for(var d=0,e=c.getGroup(a),f=new e.constructor,g=0;g<e.length;g++){var h=e[g];this.isdel(b,h)?(h.id=g,f.add(h),d++):d>0&&(e[g-d]=e[g])}var i=this.puzzle.opemgr;i.undoExec||i.redoExec||(i.forceRecord=!0,f.allclear(!0),i.forceRecord=!1);for(var g=0;g<d;g++)e.pop()},isdel:function(a,b){if("excell"===b.group&&a&(this.EXPAND|this.REDUCE)){var c=this.board,d=c.cols,e=c.rows;(7&a)===this.UP||(7&a)===this.DN?e--:d--;var f=c.excellCols(d,e),g=c.excellRows(d,e),h=-2*f+1,i=-2*g+1;if(b.bx<h||b.by<i)return!0}return!!this.insex[b.group][this.distObj(a,b)]},turnflipGroup:function(a,b,c){var d=this.board;if("excell"===a)if(1===d.hasexcell&&b&this.FLIP){var e={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};b===this.FLIPY?(e.x1=-2*d.excellCols(d.cols,d.rows)+1,e.x2=-1):b===this.FLIPX&&(e.y1=-2*d.excellRows(d.cols,d.rows)+1,e.y2=-1),c=e}else 2===d.hasexcell&&(c={x1:-1,y1:-1,x2:c.x2+1,y2:c.y2+1});for(var f=d.objectinside(a,c.x1,c.y1,c.x2,c.y2),g={},h=c.x1+c.x2,i=c.y1+c.y2,j=0;j<f.length;j++){var k=f[j],l=null;switch(b){case this.FLIPY:l=d.getObjectPos(a,k.bx,i-k.by).id;break;case this.FLIPX:l=d.getObjectPos(a,h-k.bx,k.by).id;break;case this.TURNL:l=d.getObjectPos(a,k.by,i-k.bx).id;break;case this.TURNR:l=d.getObjectPos(a,h-k.by,k.bx).id}g[l]=k}var m=d.getGroup(a);for(var n in g)m[+n]=g[n]},distObj:function(a,b){var c=this.board;return b.isnull?-1:(a&=15,a===this.UP?b.by:a===this.DN?2*c.rows-b.by:a===this.LT?b.bx:a===this.RT?2*c.cols-b.bx:-1)},expandborder:function(a){var b=this.board,c=b.borderAsLine;if(c||!b.puzzle.opemgr.undoExec){var d=new this.klass.BorderList;b.setposBorders();for(var e=c?2:1,f=0;f<b.border.length;f++){var g=b.border[f];if(this.distObj(a,g)===e){var h=c?this.outerBorder(f,a):this.innerBorder(f,a);this.copyBorder(g,h),d.add(h)}}c&&d.allclear(!1)}},reduceborder:function(a){var b=this.board;if(b.borderAsLine)for(var c=0;c<b.border.length;c++){var d=b.border[c];if(0===this.distObj(a,d)){var e=this.innerBorder(c,a);this.copyBorder(d,e)}}},copyBorder:function(a,b){a.ques=b.ques,a.qans=b.qans,this.board.borderAsLine&&(a.line=b.line,a.qsub=b.qsub)},innerBorder:function(a,b){var c=this.board.border[a];return b&=15,b===this.UP?c.relbd(0,2):b===this.DN?c.relbd(0,-2):b===this.LT?c.relbd(2,0):b===this.RT?c.relbd(-2,0):null},outerBorder:function(a,b){var c=this.board.border[a];return b&=15,b===this.UP?c.relbd(0,-2):b===this.DN?c.relbd(0,2):b===this.LT?c.relbd(-2,0):b===this.RT?c.relbd(2,0):null},reduceRoomNumber:function(a,b){for(var c=[],d=this.board,e=0;e<d.cell.length;e++){var f=d.cell[e];this.insex.cell[this.distObj(a,f)]&&(-1!==f.qnum&&(c.push({cell:f,area:f.room,pos:[f.bx,f.by],val:f.qnum}),f.qnum=-1),f.room.clist.remove(f))}for(var g=0;g<c.length;g++){var h=c[g],i=h.area,j=i.clist.getTopCell();if(j.isnull){var k=this.puzzle.opemgr;k.undoExec||k.redoExec||(k.forceRecord=!0,h.cell.addOpe("qnum",h.val,-1),k.forceRecord=!1)}else j.qnum=h.val}},adjustBoardData:function(a,b){},adjustBoardData2:function(a,b){}}})}(),a.classmgr.makeCommon({GraphBase:{enabled:!1,relation:{},pointgroup:"",linkgroup:"",coloring:!1,removeFromArray:function(a,b){var c=a.indexOf(b);c>=0&&Array.prototype.splice.call(a,c,1)},setComponentRefs:function(a,b){},getObjNodeList:function(a){return[]},resetObjNodeList:function(a){},isnodevalid:function(a){return!1},isedgevalidbylinkobj:function(a){return!0},isedgevalidbynodeobj:function(a,b){return!0},isedgeexistsbylinkobj:function(a){var b=this.getSideNodesBySeparator(a);return!!b&&b[0].nodes.indexOf(b[1])>=0},calcNodeCount:function(a){return this.isnodevalid(a)?1:0},rebuildmode:!1,rebuild:function(){this.enabled&&(this.rebuildmode=!0,this.components=[],this.modifyNodes=[],this.rebuild2(),this.searchGraph(),this.rebuildmode=!1)},rebuild2:function(){for(var a=this.board[this.pointgroup],b=this.board[this.linkgroup],c=0;c<a.length;c++)this.setComponentRefs(a[c],null),this.resetObjNodeList(a[c]),this.isnodevalid(a[c])&&this.createNode(a[c]);if(this.linkgroup)for(var d=0;d<b.length;d++)this.setComponentRefs(b[d],null),this.isedgevalidbylinkobj(b[d])&&this.addEdgeByLinkObj(b[d]);else for(var c=0;c<a.length;c++)this.isnodevalid(a[c])&&this.setEdgeByNodeObj(a[c])},createComponent:function(){var a=new this.klass.GraphComponent;return this.components.push(a),a},deleteComponent:function(a){for(var b=0;b<a.nodes.length;b++)this.modifyNodes.push(a.nodes[b]),this.setComponentRefs(a.nodes[b].obj,null),a.nodes[b].component=null;this.removeFromArray(this.components,a)},createNode:function(a){var b=new this.klass.GraphNode(a);return this.getObjNodeList(a).push(b),this.modifyNodes.push(b),b},deleteNode:function(a){var b=a.obj;this.setComponentRefs(b,null),this.removeFromArray(this.getObjNodeList(b),a),this.removeFromArray(this.modifyNodes,a);var c=a.component;null!==c&&(this.removeFromArray(c.nodes,a),this.resetExtraData(b),0===c.nodes.length&&this.deleteComponent(c))},createNodeIfEmpty:function(a){0===this.getObjNodeList(a).length&&this.createNode(a)},deleteNodeIfEmpty:function(a){var b=this.getObjNodeList(a);0!==b[0].nodes.length||this.isnodevalid(a)||this.deleteNode(b[0])},addEdge:function(a,b){a.nodes.indexOf(b)>=0||(a.nodes.push(b),b.nodes.push(a),this.rebuildmode||(this.modifyNodes.indexOf(a)<0&&this.modifyNodes.push(a),this.modifyNodes.indexOf(b)<0&&this.modifyNodes.push(b)))},removeEdge:function(a,b){a.nodes.indexOf(b)<0||(this.removeFromArray(a.nodes,b),this.removeFromArray(b.nodes,a),this.rebuildmode||(this.modifyNodes.indexOf(a)<0&&this.modifyNodes.push(a),this.modifyNodes.indexOf(b)<0&&this.modifyNodes.push(b)))},getSideObjByLinkObj:function(a){return a.sideobj},getSideObjByNodeObj:function(a){for(var b=a.getdir4clist(),c=[],d=0;d<b.length;d++){var e=b[d][0]
;this.isnodevalid(e)&&c.push(e)}return c},getSideNodesByLinkObj:function(a){for(var b=[],c=this.getSideObjByLinkObj(a),d=0;d<c.length;d++){var e=c[d],f=this.getObjNodeList(e),g=f[0];f[1]&&a.isvert&&(g=f[1]),b.push(g)}return b},getSideNodesBySeparator:function(a){for(var b=[],c=a.sideobj,d=0;d<c.length;d++){var e=this.getObjNodeList(c[d]);e&&e[0]&&b.push(e[0])}return b.length>=2?b:null},modifyInfo:function(a,b){if(this.enabled){var c=this.relation[b];if(c){switch(this.modifyNodes=[],c){case"node":this.setEdgeByNodeObj(a);break;case"link":this.setEdgeByLinkObj(a);break;case"separator":this.setEdgeBySeparator(a);break;default:this.modifyOtherInfo(a,c)}this.modifyNodes.length>0&&this.remakeComponent()}}},setEdgeBySeparator:function(a){var b=this.isedgevalidbylinkobj(a);b!==this.isedgeexistsbylinkobj(a)&&(this.incdecBorderCount&&this.incdecBorderCount(a,!b),b?this.addEdgeBySeparator(a):this.removeEdgeBySeparator(a))},addEdgeBySeparator:function(a){var b=this.getSideNodesBySeparator(a);b&&this.addEdge(b[0],b[1])},removeEdgeBySeparator:function(a){var b=this.getSideNodesBySeparator(a);b&&(this.removeEdge(b[0],b[1]),this.linkgroup&&this.setComponentRefs(a,null))},attachNode:function(a,b){a.component=b,b.nodes.push(a),this.setComponentInfo(b)},remakeComponent:function(){var a=this.getAffectedComponents();1===a.length&&this.checkDividedComponent(a[0]),this.modifyNodes&&this.modifyNodes.length>0&&this.remakeMaximalComponents(a)},getAffectedComponents:function(){for(var a=[],b=0;b<this.modifyNodes.length;b++){var c=this.modifyNodes[b].component;null!==c&&(c.isremake||(a.push(c),c.isremake=!0))}return a},checkDividedComponent:function(a){for(var b=0,c=this.modifyNodes.length;b<c;b++){var d=this.modifyNodes[b];d.component=null,this.setComponentRefs(d.obj,null),this.removeFromArray(a.nodes,d)}var e=new this.klass.GraphComponent;if(this.searchSingle(this.modifyNodes[0],e),e.nodes.length===this.modifyNodes.length){for(var b=0;b<this.modifyNodes.length;b++){var d=this.modifyNodes[b];d.component=a,a.nodes.push(d)}this.modifyNodes=[],this.setComponentInfo(a),a.isremake=!1}},remakeMaximalComponents:function(a){for(var b=this.coloring?this.getLongColor(a):null,c=0;c<a.length;c++)this.deleteComponent(a[c]);var d=this.searchGraph();this.coloring&&this.setLongColor(d,b)},searchGraph:function(){for(var a=this.modifyNodes,b=[],c=0,d=a.length;c<d;c++)a[c].component=null;for(var c=0,d=a.length;c<d;c++)if(null===a[c].component){var e=this.createComponent();this.searchSingle(a[c],e),this.setComponentInfoExtra(e,!1),b.push(e)}this.modifyNodes=[];for(var c=0;c<b.length;c++)this.setExtraData(b[c]);return b},searchSingle:function(a,b){for(var c=[a];c.length>0;){var d=c.pop();if(null===d.component){d.component=b,b.nodes.push(d);for(var e=0;e<d.nodes.length;e++)c.push(d.nodes[e])}}},setComponentInfo:function(a){this.setComponentInfoExtra(a,!0)},setComponentInfoExtra:function(a,b){for(var c=0,d=0;d<a.nodes.length;d++){var e=a.nodes[d];c+=e.nodes.length,this.setComponentRefs(e.obj,a)}a.circuits=(c>>1)-a.nodes.length+1,b&&this.setExtraData(a)},resetExtraData:function(a){},setExtraData:function(a){},getLargeComponent:function(a){if(0===a.length)return null;for(var b=a[0],c=b.isTrial(),d=1;d<a.length;d++){var e=a[d],f=e.isTrial();f===c?b.nodes.length<e.nodes.length&&(b=e,c=f):f||(b=e,c=f)}return b},getLongColor:function(a){var b=this.getLargeComponent(a);return b?b.color:null},setLongColor:function(a,b){if(0!==a.length&&b){var c=this.puzzle,d=this.getLargeComponent(a);d&&(d.color=b),this.coloring&&(c.execConfig("irowake")||c.execConfig("irowakeblk"))&&this.repaintNodes(a)}},repaintNodes:function(a){},newIrowake:function(){for(var a=this.components,b=0;b<a.length;b++)a[b].color=this.puzzle.painter.getNewLineColor()}},GraphComponent:{initialize:function(){this.nodes=[],this.color="",this.circuits=-1},getLinkObjByNodes:function(a,b){var c=a.obj.bx,d=a.obj.by,e=b.obj.bx,f=b.obj.by;return c>e||c===e&&d>f?null:this.board.getobj(c+e>>1,d+f>>1)},getnodeobjs:function(){for(var a=new(this.board.getGroup(this.nodes[0].obj.group).constructor),b=0;b<this.nodes.length;b++)a.add(this.nodes[b].obj);return a},getedgeobjs:function(){for(var a=[],b=0;b<this.nodes.length;b++)for(var c=this.nodes[b],d=0;d<c.nodes.length;d++){var e=this.getLinkObjByNodes(c,c.nodes[d]);e&&a.push(e)}return a},checkAutoCmp:function(){var a=!!this.clist.checkCmp&&this.clist.checkCmp();this.cmp!==a&&(this.cmp=a,this.puzzle.execConfig("autocmp")&&this.clist.draw())},isTrial:function(){for(var a=this.getedgeobjs(),b=0;b<a.length;b++)if(!a[b].trial)return!1;return!0},setedgeerr:function(a){for(var b=this.getedgeobjs(),c=0;c<b.length;c++)b[c].seterr(a)},setedgeinfo:function(a){for(var b=this.getedgeobjs(),c=0;c<b.length;c++)b[c].setinfo(a)}},GraphNode:{initialize:function(a){this.obj=a,this.nodes=[],this.component=null}}}),a.classmgr.makeCommon({"LineGraph:GraphBase":{initialize:function(){this.moveline&&(this.relation["cell.qnum"]="move")},enabled:!1,relation:{"border.line":"link"},pointgroup:"cell",linkgroup:"border",countprop:"lcnt",isLineCross:!1,makeClist:!1,moveline:!1,coloring:!0,setComponentRefs:function(a,b){a.path=b},isedgeexistsbylinkobj:function(a){return null!==a.path},getObjNodeList:function(a){return a.pathnodes},resetObjNodeList:function(a){a.pathnodes=[],this.moveline&&this.resetExtraData(a)},isnodevalid:function(a){return a[this.countprop]>0||this.moveline&&a.isNum()},isedgevalidbylinkobj:function(a){return a.isLine()},iscrossing:function(a){return this.isLineCross},rebuild:function(){this.board.borderAsLine&&(this.pointgroup="cross"),a.common.GraphBase.prototype.rebuild.call(this)},rebuild2:function(){this.incdecLineCount&&this.resetLineCount(),a.common.GraphBase.prototype.rebuild2.call(this)},resetLineCount:function(){var a=this.board[this.pointgroup],b=this.board[this.linkgroup];this.ltotal=[a.length];for(var c=0;c<a.length;c++)a[c][this.countprop]=0;for(var d=0;d<b.length;d++)this.isedgevalidbylinkobj(b[d])&&this.incdecLineCount(b[d],!0)},incdecLineCount:function(a,b){if(a.group===this.linkgroup)for(var c=0;c<2;c++){var d=a.sideobj[c];d.isnull||(this.ltotal[d[this.countprop]]--,b?d[this.countprop]++:d[this.countprop]--,this.ltotal[d[this.countprop]]=(this.ltotal[d[this.countprop]]||0)+1)}},setEdgeByLinkObj:function(a){var b=this.isedgevalidbylinkobj(a);b!==this.isedgeexistsbylinkobj(a)&&(this.incdecLineCount&&this.incdecLineCount(a,b),b?this.addEdgeByLinkObj(a):this.removeEdgeByLinkObj(a))},addEdgeByLinkObj:function(a){var b=0===this.modifyNodes.length,c=this.getSideObjByLinkObj(a);this.createNodeIfEmpty(c[0]),this.createNodeIfEmpty(c[1]);var d=this.getSideNodesByLinkObj(a);if(this.addEdge(d[0],d[1]),!this.rebuildmode&&b){var e=null,f=d[0],g=d[1];1===f.obj[this.countprop]&&null===f.component&&null!==g.component?e=[d[0],d[1]]:1===g.obj[this.countprop]&&null===g.component&&null!==f.component&&(e=[d[1],d[0]]),e&&(this.attachNode(e[0],e[1].component),this.modifyNodes=[])}},removeEdgeByLinkObj:function(a){var b=0===this.modifyNodes.length,c=this.getSideNodesByLinkObj(a);if(this.removeEdge(c[0],c[1]),this.deleteNodeIfEmpty(c[0].obj),this.deleteNodeIfEmpty(c[1].obj),this.setComponentRefs(a,null),b){var d=null,e=c[0],f=c[1],g=e.obj[this.countprop],h=f.obj[this.countprop];0===g&&(1===h||!this.isLineCross&&h>1)&&null!==f.component?d=[c[0],c[1]]:0===h&&(1===g||!this.isLineCross&&g>1)&&null!==e.component&&(d=[c[1],c[0]]),d&&(this.setComponentInfo(d[1].component),this.modifyNodes=[])}},modifyOtherInfo:function(a,b){var c=!!a.path;c!==this.isnodevalid(a)?c?this.deleteNodeIfEmpty(a):this.createNodeIfEmpty(a):c?this.setComponentInfo(a.path):this.resetExtraData(a)},createNodeIfEmpty:function(a){var b=this.getObjNodeList(a);if(0===b.length)this.createNode(a);else if(!b[1]&&2===b[0].nodes.length&&this.iscrossing(a)){var c=b[0].nodes,d=[a.getvert(c[0].obj,2),a.getvert(c[1].obj,2)];if(d[0]!==d[1]){var e=c[d[0]?0:1],f=c[d[0]?1:0];this.removeEdge(b[0],e),this.removeEdge(b[0],f),this.deleteNode(b[0]),this.createNode(a),this.createNode(a),this.addEdge(b[0],e),this.addEdge(b[1],f)}else this.createNode(a),d[0]||d[1]||b.push(b.shift())}},deleteNodeIfEmpty:function(a){var b=this.getObjNodeList(a);if(1!==b.length||0!==b[0].nodes.length||this.isnodevalid(a)){if(b[1]&&b[0].nodes.length+b[1].nodes.length===2&&this.iscrossing(a)){if(1===b[1].nodes.length){var c=b[1].nodes[0];this.removeEdge(b[1],c),this.addEdge(b[0],c)}else 2===b[1].nodes.length&&b.push(b.shift());this.deleteNode(b[1])}}else this.deleteNode(b[0])},resetExtraData:function(a){this.moveline&&(a.base=a.isNum()?a:this.board.emptycell)},setExtraData:function(a){this.coloring&&!a.color&&(a.color=this.puzzle.painter.getNewLineColor());for(var b=a.getedgeobjs(),c=0;c<b.length;c++)this.setComponentRefs(b[c],a);(this.makeClist||this.moveline)&&(a.clist=new this.klass.CellList(a.getnodeobjs()),this.moveline&&this.setMovedBase(a))},repaintNodes:function(a){for(var b=new this.klass.BorderList,c=0;c<a.length;c++)b.extend(a[c].getedgeobjs());this.puzzle.painter.repaintLines(b)},setMovedBase:function(a){var b=this.board.emptycell;a.departure=a.destination=b,a.movevalid=!1;var c=a.clist;if(!(c.length<1)){for(var d=0;d<c.length;d++){var e=c[d];e.base=e.isNum()?e:b}var f=null,g=null,h=0;if(1===c.length)f=g=c[0],h=2;else for(var d=0;d<c.length;d++){var e=c[d];1===e[this.countprop]&&(h++,e.isNum()?f=e:g=e)}null!==f&&null!==g&&2===h&&(f.base=b,a.departure=g.base=f,a.destination=g,a.movevalid=!0)}}}}),a.classmgr.makeCommon({"AreaGraphBase:GraphBase":{pointgroup:"cell",isedgevalidbynodeobj:function(a,b){return this.isedgevalidbylinkobj(this.board.getb(a.bx+b.bx>>1,a.by+b.by>>1))},setEdgeByNodeObj:function(a){this.getObjNodeList(a).length>0&&this.removeEdgeByNodeObj(a),this.calcNodeCount(a)>0&&this.addEdgeByNodeObj(a)},removeEdgeByNodeObj:function(a){for(var b=this.getSideObjByNodeObj(a),c=this.getObjNodeList(a)[0],d=c.nodes.length,e=c.component,f=0===this.modifyNodes.length,g=0;g<b.length;g++){var h=this.getObjNodeList(b[g])[0];c&&h&&(this.removeEdge(c,h),this.incdecBorderCount&&this.incdecBorderCount(this.board.getb(c.obj.bx+h.obj.bx>>1,c.obj.by+h.obj.by>>1),!0))}c&&this.deleteNode(c),!this.rebuildmode&&1===d&&f&&(this.setComponentInfo(e),this.modifyNodes=[])},addEdgeByNodeObj:function(a){for(var b=0,c=this.calcNodeCount(a);b<c;b++)this.createNode(a);for(var d=this.getSideObjByNodeObj(a),e=this.getObjNodeList(a)[0],f=0===this.modifyNodes.length,b=0;b<d.length;b++)if(this.isedgevalidbynodeobj(a,d[b])){var g=this.getObjNodeList(d[b])[0];e&&g&&(this.addEdge(e,g),this.incdecBorderCount&&this.incdecBorderCount(this.board.getb(e.obj.bx+g.obj.bx>>1,e.obj.by+g.obj.by>>1),!1))}!this.rebuildmode&&1===e.nodes.length&&f&&(this.attachNode(e,e.nodes[0].component),this.modifyNodes=[])},setExtraData:function(a){a.clist=new this.klass.CellList(a.getnodeobjs())}},"AreaShadeGraph:AreaGraphBase":{relation:{"cell.qans":"node"},setComponentRefs:function(a,b){a.sblk=b},getObjNodeList:function(a){return a.sblknodes},resetObjNodeList:function(a){a.sblknodes=[]},isnodevalid:function(a){return a.isShade()},setExtraData:function(a){a.clist=new this.klass.CellList(a.getnodeobjs()),this.coloring&&!a.color&&(a.color=this.puzzle.painter.getNewLineColor())},repaintNodes:function(a){for(var b=new this.klass.CellList,c=0;c<a.length;c++)b.extend(a[c].getnodeobjs());this.puzzle.painter.repaintBlocks(b)}},"AreaUnshadeGraph:AreaGraphBase":{relation:{"cell.qans":"node"},setComponentRefs:function(a,b){a.ublk=b},getObjNodeList:function(a){return a.ublknodes},resetObjNodeList:function(a){a.ublknodes=[]},isnodevalid:function(a){return a.isUnshade()}},"AreaNumberGraph:AreaGraphBase":{relation:{"cell.qnum":"node","cell.anum":"node","cell.qsub":"node"},setComponentRefs:function(a,b){a.nblk=b},getObjNodeList:function(a){return a.nblknodes},resetObjNodeList:function(a){a.nblknodes=[]},isnodevalid:function(a){return a.isNumberObj()}},"AreaRoomGraph:AreaGraphBase":{relation:{"cell.ques":"node","border.ques":"separator","border.qans":"separator"},hastop:!1,getComponentRefs:function(a){return a.room},setComponentRefs:function(a,b){a.room=b},getObjNodeList:function(a){return a.roomnodes},resetObjNodeList:function(a){a.roomnodes=[]},isnodevalid:function(a){return 7!==a.ques},isedgevalidbylinkobj:function(a){return!a.isBorder()},rebuild2:function(){this.klass.AreaGraphBase.prototype.rebuild2.call(this),this.resetBorderCount()},resetBorderCount:function(){for(var a=this.board,b=a.border,c=0;c<a.cross.length;c++){var d=a.cross[c],e=d.bx,f=d.by,g=1===a.hasborder&&(0===e||e===2*a.cols||0===f||f===2*a.rows);d.lcnt=g?2:0}for(var h=0;h<b.length;h++)this.isedgevalidbylinkobj(b[h])||this.incdecBorderCount(b[h],!0)},incdecBorderCount:function(a,b){for(var c=0;c<2;c++){var d=a.sidecross[c];d.isnull||(b?d.lcnt++:d.lcnt--)}},addEdgeBySeparator:function(a){var b=this.getSideNodesBySeparator(a);b&&(this.addEdge(b[0],b[1]),0===a.sidecross[0].lcnt||0===a.sidecross[1].lcnt?this.modifyNodes=[]:this.hastop&&b.length>=2&&this.setTopOfRoom_combine(b[0].obj,b[1].obj))},removeEdgeBySeparator:function(a){var b=this.getSideNodesBySeparator(a);b&&(this.removeEdge(b[0],b[1]),1!==a.sidecross[0].lcnt&&1!==a.sidecross[1].lcnt||(this.modifyNodes=[]))},setTopOfRoom_combine:function(a,b){if(a.room&&b.room&&a.room!==b.room){var c,d,e=a.room.top,f=b.room.top;e.bx>f.bx||e.bx===f.bx&&e.by>f.by?(c=e,d=f):(c=f,d=e),c.isNum()&&(d.noNum()&&(d.setQnum(c.qnum),d.draw()),c.setQnum(-1),c.draw())}},setExtraData:function(a){var b=a.clist=new this.klass.CellList(a.getnodeobjs());if(this.hastop&&(a.top=b.getTopCell(),this.rebuildmode)){for(var c=-1,b=b,d=a.top,e=0,f=b.length;e<f;e++){var g=b[e];g.room===a&&-1!==g.qnum&&(-1===c&&(c=g.qnum),d!==g&&(g.qnum=-1))}-1!==c&&-1===d.qnum&&(d.qnum=c)}this.puzzle.validConfig("autocmp")&&a.checkAutoCmp()},getSideAreaInfo:function(){for(var a=[],b=this.components.length,c={},d=this.board,e=0;e<this.components.length;e++)this.components[e].id=e;for(var f=0;f<d.border.length;f++){var g=this.getComponentRefs(d.border[f].sidecell[0]),h=this.getComponentRefs(d.border[f].sidecell[1]);if(g!==h&&g&&h){var i=g.id<h.id?g.id*b+h.id:h.id*b+g.id;c[i]||(c[i]=!0,a.push([g,h]))}}return a}}}),function(){a.classmgr.makeCommon({Graphic:{initialize:function(){this.gridcolor=this.gridcolor_list[this.gridcolor_type]||this.gridcolor;var b=this;[["getQuesCellColor",this.fgcellcolor_func],["getBGCellColor",this.bgcellcolor_func],["getBorderColor",this.bordercolor_func],["getQuesNumberColor",this.numbercolor_func],["getCircleFillColor",this.circlefillcolor_func],["getCircleStrokeColor",this.circlestrokecolor_func]].forEach(function(c){b[c[0]]===a.common.Graphic.prototype[c[0]]&&(b[c[0]]=b[c[0]+"_"+c[1]]||b[c[0]])}),this.resetRange(),this.initFont()},context:null,subcontext:null,fgcellcolor_func:"ques",bgcellcolor_func:"error1",bordercolor_func:"ques",numbercolor_func:"mixed",circlefillcolor_func:"qnum",circlestrokecolor_func:"qnum",quescolor:"black",qanscolor:"rgb(0, 160, 0)",qcmpcolor:"silver",qcmpbgcolor:"rgb(224, 224, 255)",trialcolor:"rgb(160, 160, 160)",subcolor:"rgb(127, 127, 255)",shadecolor:"black",errcolor1:"rgb(192, 0, 0)",errcolor2:"rgb(32, 32, 255)",fontShadecolor:"rgb(224, 224, 224)",enablebcolor:!1,bcolor:"rgb(160, 255, 160)",errbcolor1:"rgb(255, 160, 160)",errbcolor2:"rgb(64, 255, 64)",qsubcolor1:"rgb(160,255,160)",qsubcolor2:"rgb(255,255,127)",qsubcolor3:"rgb(192,192,192)",icecolor:"rgb(192, 224, 255)",erricecolor:"rgb(224,  96, 160)",circlebasecolor:"white",mbcolor:"rgb(0, 160, 0)",linecolor:"rgb(0, 160, 0)",errlinecolor:"rgb(255, 0, 0)",noerrcolor:"rgb(160, 160, 160)",movelinecolor:"silver",movetrialcolor:"rgb(255, 160, 0)",pekecolor:"rgb(0, 127, 0)",bbcolor:"rgb(160, 160, 160)",targetColorEdit:"rgb(255, 64,  64)",targetColorPlay:"rgb(64,  64, 255)",targetColorTrial:"rgb(255,  64, 255)",ttcolor:"rgb(127,255,127)",movecolor:"red",gridcolor:"black",gridcolor_type:"",gridcolor_list:{DARK:"rgb( 48,  48,  48)",LIGHT:"rgb(127, 127, 127)",DLIGHT:"rgb(160, 160, 160)",SLIGHT:"rgb(191, 191, 191)",THIN:"rgb(224, 224, 224)"},bgcolor:"white",textoption:null,fontsizeratio:.8,fontwidth:[.5,.4,.33],fontfamily:"",isSupportMaxWidth:!0,crosssize:.4,circleratio:[.4,.35],margin:.15,canvasWidth:null,canvasHeight:null,x0:0,y0:0,cw:36,ch:36,bw:18,bh:18,devicePixelRatio:1,gw:1,lw:1,lwmin:3,lm:1,lwratio:10,addlw:0,lastHdeg:0,lastYdeg:0,minYdeg:.18,maxYdeg:.7,range:null,useBuffer:!1,outputImage:!1,pendingResize:!1,suspended:!0,suspendedAll:!0,hideHatena:!1,autocmp:"",irowake:!1,irowakeblk:!1,initCanvas:function(){var b=this.puzzle;if((this.context=b.canvas?b.canvas.getContext("2d"):null).use.canvas&&(this.subcontext=b.subcanvas?b.subcanvas.getContext("2d"):null,this.useBuffer=!!this.subcontext),null===this.canvasWidth||null===this.canvasHeight){var c=a.util.getRect(b.canvas);this.resizeCanvas(c.width,c.height)}this.pendingResize=!0,this.resize_canvas_main(),b.emit("canvasReady"),this.unsuspend()},initFont:function(){var a=1===this.puzzle.getConfig("font");this.puzzle.pzpr.env.OS.Android?this.fontfamily=a?"Helvetica, Verdana, Arial, ":'"Times New Roman", ':this.fontfamily="",this.fontfamily+=a?"sans-serif":"serif"},resizeCanvas:function(a,b){var c=this.suspended;this.suspendAll(),this.canvasWidth=a||this.canvasWidth,this.canvasHeight=b||this.canvasHeight,this.pendingResize=!0,c||this.unsuspend()},resizeCanvasByCellSize:function(a){var b=this.suspended;this.suspendAll(),this.cw=a||this.cw,this.ch=a||this.ch,this.canvasWidth=this.cw*this.getCanvasCols(),this.canvasHeight=this.ch*this.getCanvasRows(),this.pendingResize=!0,b||this.unsuspend()},resize_canvas_main:function(){this.pendingResize&&(this.pendingResize=!1,this.setParameter(),this.setOffset(),this.puzzle.emit("resize"),this.clearObject())},setParameter:function(){var a=this.canvasWidth,b=this.canvasHeight,c=this.getCanvasCols(),d=this.getCanvasRows(),e=a/c|0,f=b/d|0;this.devicePixelRatio=this.puzzle.pzpr.env.browser?window.devicePixelRatio||1:1,this.puzzle.getConfig("squarecell")?this.cw=this.ch=Math.min(e,f):(this.cw=e,this.ch=f),this.bw=this.cw/2,this.bh=this.ch/2;var g=Math.min(this.cw/40,1),h=1/this.devicePixelRatio,i=Math.max(1,Math.round(g/h));this.gw=i*h;var j=Math.max(this.cw/this.lwratio,this.lwmin),k=Math.max(1,Math.round(j/h));this.lw=k*h,this.lm=this.lw/2},setOffset:function(){var b=this.context,c=this.subcontext,d=this.canvasWidth,e=this.canvasHeight;b.changeSize(0|d,0|e),c&&c.changeSize(0|d,0|e);var f=this.x0=.5+((d-this.cw*this.getBoardCols())/2+this.cw*this.getOffsetCols()|0),g=this.y0=.5+((e-this.ch*this.getBoardRows())/2+this.ch*this.getOffsetRows()|0);if(b.use.canvas)b.translate(f,g),c&&c.translate(f,g);else{var h=a.util.getRect(b.canvas);b.translate(f-h.left%1,g-h.top%1)}},clearObject:function(){this.context.clear()},getCanvasCols:function(){return this.getBoardCols()+2*this.margin},getCanvasRows:function(){return this.getBoardRows()+2*this.margin},getBoardCols:function(){var a=this.board;return(a.maxbx-a.minbx)/2},getBoardRows:function(){var a=this.board;return(a.maxby-a.minby)/2},getOffsetCols:function(){return(0-this.board.minbx)/2},getOffsetRows:function(){return(0-this.board.minby)/2},suspend:function(){this.suspended=!0},suspendAll:function(){this.suspendedAll=!0,this.suspended=!0},unsuspend:function(){if(this.context){if(this.resize_canvas_main(),this.suspendedAll){var a=this.board;this.setRange(a.minbx-2,a.minby-2,a.maxbx+2,a.maxby+2),this.suspendedAll=!1}this.suspended&&(this.suspended=!1,this.prepaint())}},prepaint:function(){if(!this.suspended&&this.context){this.isSupportMaxWidth=this.context.use.svg&&a.env.API.svgTextLength||this.context.use.canvas&&a.env.API.maxWidth;var b=this.board,c=2*this.margin,d=this.range.x1,e=this.range.y1,f=this.range.x2,g=this.range.y2;if(d>f||e>g||d>=b.maxbx+c||e>=b.maxby+c||f<=b.minbx-c||g<=b.minby-(c+("starbattle"===this.pid?2:0)));else if(this.useBuffer){var h=this.context,i=this.subcontext;this.context=i,this.setRangeObject(d-1,e-1,f+1,g+1),this.flushCanvas(),this.paintMain(),this.context=h,this.copyBufferData(h,i,d,e,f,g)}else this.setRangeObject(d,e,f,g),this.flushCanvas(),this.paintMain();this.resetRange()}},paintMain:function(){this.paint(),this.paintPost()},paint:function(){},paintPost:function(){},setRange:function(a,b,c,d){this.range.x1>a&&(this.range.x1=a),this.range.y1>b&&(this.range.y1=b),this.range.x2<c&&(this.range.x2=c),this.range.y2<d&&(this.range.y2=d)},setRangeObject:function(a,b,c,d){var e=this.board;this.range.cells=e.cellinside(a,b,c,d),this.range.crosses=e.crossinside(a,b,c,d),this.range.borders=e.borderinside(a,b,c,d),this.range.excells=e.excellinside(a,b,c,d)},resetRange:function(){var a=this.puzzle,b=a.board,c=a.klass;this.range={x1:b.maxbx+1,y1:b.maxby+1,x2:b.minbx-1,y2:b.minby-1,cells:new c.CellList,crosses:new c.CrossList,borders:new c.BorderList,excells:new c.ExCellList}},copyBufferData:function(a,b,c,d,e,f){var g=this.x0+c*this.bw-1,h=this.y0+d*this.bh-1,i=this.x0+e*this.bw+2,j=this.y0+f*this.bh+2;g<0&&(g=0),i>b.child.width&&(i=b.child.width),h<0&&(h=0),j>b.child.height&&(j=b.child.height),a.drawImage(b.child,g,h,i-g,j-h,g-this.x0,h-this.y0,i-g,j-h)},paintRange:function(a,b,c,d){this.setRange(a,b,c,d),this.prepaint()},paintAll:function(){this.suspended&&(this.suspendedAll=!0);var a=this.board;this.paintRange(a.minbx-2,a.minby-2,a.maxbx+2,a.maxby+2)},getNewLineColor:function(){for(var a=0;;){var b=(384*Math.random()|0)-64;b<0&&(b=0),b>255&&(b=255);var c=(384*Math.random()|0)-64;c<0&&(c=0),c>255&&(c=255);var d=(384*Math.random()|0)-64;d<0&&(d=0),d>255&&(d=255);var e=Math.max(b,Math.max(c,d)),f=Math.min(b,Math.min(c,d)),g=0,h=.5*(e+f)/255,i=e===f?0:(e-f)/(h<=.5?e+f:510-e-f);e===f?g=0:b>=c&&b>=d?g=(60*(c-d)/(e-f)+360)%360:c>=b&&c>=d?g=(120+60*(d-b)/(e-f)+360)%360:d>=c&&d>=b&&(g=(240+60*(b-c)/(e-f)+360)%360);var j=(.29891*b+.58661*c+.11448*d)/255;if(this.minYdeg<j&&j<this.maxYdeg&&Math.abs(this.lastYdeg-j)>.15&&(i<.02||.4<i)&&(360+this.lastHdeg-g)%360>=45&&(360+this.lastHdeg-g)%360<=315)return this.lastHdeg=g,this.lastYdeg=j,"rgb("+b+","+c+","+d+")";if(++a>100)return"rgb("+b+","+c+","+d+")"}},repaintBlocks:function(a){a.draw()},repaintLines:function(a){this.range.borders=a,this.drawLines(),this.context.use.canvas&&this.repaintParts(a)},repaintParts:function(a){},flushCanvas:function(){var a=this.vinc("background","crispEdges",!0),b=this.bw,c=this.bh,d=this.margin>.15?this.margin:0,e=this.board,f=e.minbx-d,g=e.minby-d,h=e.maxbx+d-f,i=e.maxby+d-g;a.vid="BG",a.fillStyle=this.bgcolor,a.fillRect(f*b-.5,g*c-.5,h*b+1,i*c+1)},vinc:function(a,b,c){var d=this.context,e={freeze:!!c};return e.rendering=b,d.setLayer(a,e),d},CENTER:1,BOTTOMLEFT:2,BOTTOMRIGHT:3,TOPRIGHT:4,TOPLEFT:5,UP:6,DN:7,RT:9,LT:8,disptext:function(a,b,c,d){d=d||{};var e=this.context,f=this.cw*(d.ratio||this.fontsizeratio)|0,g=void 0,h=d.width||this.fontwidth,i=a.length<=h.length+1?a.length-2:h.length-1,j=i>=0?h[i]*a.length:null;this.isSupportMaxWidth?g=j?f*j:void 0:j&&(f=f*j*1.5/a.length|0);var k=d.style?d.style+" ":"";e.font=k+f+"px "+this.fontfamily;var l=this.bw*(d.hoffset||.9),m=this.bh*(d.voffset||.82),n=d.position||1;switch(n){case 1:case 6:case 7:e.textAlign="center";break;case 2:case 5:case 8:e.textAlign="left",b-=l;break;case 3:case 4:case 9:e.textAlign="right",b+=l}switch(n){case 1:case 8:case 9:e.textBaseline="middle";break;case 4:case 5:case 6:e.textBaseline="candle-top",c-=m;break;case 3:case 2:case 7:e.textBaseline="alphabetic",c+=m}e.fillText(a,b,c,g)}},ImageTile:{cols:1,rows:1,width:0,height:0,initialize:function(){var a=this.puzzle;"undefined"!=typeof Image?(this.image_canvas=this.image_svg=new Image,this.image_canvas.onload=function(){a.painter.paintAll()}):(this.image_canvas=a.pzpr.Candle.Canvas?new a.pzpr.Candle.Canvas.Image:{},this.image_svg={}),this.image_canvas.src=this.image_svg.src=this.imgsrc_dataurl,this.image_canvas.height=this.image_svg.height=this.height,this.image_canvas.width=this.image_svg.width=this.width,this.cwidth=this.image_canvas.width/this.cols,this.cheight=this.image_canvas.height/this.rows,this.loaded=!0},putImage:function(a,b,c,d,e,f,g){var h=a.use.canvas?this.image_canvas:this.image_svg,i=this.cwidth,j=this.cheight,k=i*(c%this.cols),l=j*(c/this.cols|0);void 0===f&&(f=i,g=j),a.vid=b,a.drawImage(null!==c?h:null,k,l,i,j,d,e,f,g)}}})}(),a.classmgr.makeCommon({MouseEvent:{initialize:function(){this.cursor=this.puzzle.cursor,this.enableMouse=!0,this.mouseCell=null,this.firstCell=null,this.inputPoint=new this.klass.RawAddress,this.firstPoint=new this.klass.RawAddress,this.prevPos=new this.klass.Address,this.btn="",this.inputData=null,this.firstState=null,this.bordermode=!1,this.mousestart=!1,this.mousemove=!1,this.mouseend=!1,this.inputMode="auto",this.savedInputMode={edit:"auto",play:"auto"},this.mousereset()},RBShadeCell:!1,use:!1,bgcolor:!1,inputMode:"auto",savedInputMode:{},inputModes:{edit:[],play:[]},inversion:!1,mousereset:function(){var a=this.mouseCell;this.mouseCell=this.firstCell=this.board.emptycell,this.firstPoint.reset(),this.prevPos.reset(),this.btn="",this.inputData=null,this.bordermode=!1,this.mousestart=!1,this.mousemove=!1,this.mouseend=!1,this.puzzle.execConfig("dispmove")&&a&&!a.isnull&&a.draw()},modechange:function(){this.mousereset(),this.inputMode=this.savedInputMode[this.puzzle.editmode?"edit":"play"]},e_mousedown:function(a){if(!this.enableMouse)return!0;if(this.setMouseButton(a),!this.btn)return void this.mousereset();var b=this.getBoardAddress(a);this.moveTo(b.bx,b.by),a.stopPropagation(),a.preventDefault()},e_mouseup:function(a){if(!this.enableMouse||!this.btn)return!0;this.inputEnd(),a.stopPropagation(),a.preventDefault()},e_mousemove:function(a){if(!this.enableMouse||!this.btn)return!0;if(void 0!==a.touches||void 0===a.which||0!==a.which||a.type.match(/pointermove/i)&&a.buttons>0){var b=this.getBoardAddress(a);this.lineTo(b.bx,b.by)}else this.mousereset();a.stopPropagation(),a.preventDefault()},e_mousecancel:function(a){this.mousereset()},setMouseButton:function(b){this.btn=a.util.getMouseButton(b);var c=this.puzzle.key;c.checkmodifiers(b),(c.isSHIFT||c.isMETA)===this.inversion&&"number-"!==this.inputMode||("left"===this.btn?this.btn="right":"right"===this.btn&&(this.btn="left"))},getBoardAddress:function(b){var c=this.puzzle,d=c.painter,e={px:NaN,py:NaN};if(!d.context)return e;if(!a.env.API.touchevent||a.env.API.pointerevent||a.env.OS.iOS)e=isNaN(b.offsetX)?{px:b.layerX,py:b.layerY}:{px:b.offsetX,py:b.offsetY};else{var f=a.util.getPagePos(b),g=a.util.getRect(d.context.child);e={px:f.px-g.left,py:f.py-g.top}}return{bx:(e.px-d.x0)/d.bw,by:(e.py-d.y0)/d.bh}},moveTo:function(a,b){this.inputPoint.init(a,b),this.mouseevent(0)},lineTo:function(a,b){for(var c=a-this.inputPoint.bx,d=b-this.inputPoint.by,e=2*((c>=0?c:-c)+(d>=0?d:-d))+.9|0,f=c/e,g=d/e,h=0;h<e-1;h++)this.inputPoint.move(f,g),this.mouseevent(1);this.inputPoint.init(a,b),this.mouseevent(1)},inputEnd:function(){this.mouseevent(2),this.mousereset()},inputPath:function(){var a=Array.prototype.slice.call(arguments);this.mousereset(),this.btn="string"==typeof a[0]?a.shift():"left",this.moveTo(a[0],a[1]);for(var b=2;b<a.length-1;b+=2)this.lineTo(a[b],a[b+1]);this.inputEnd()},mouseevent:function(a){this.cancelEvent=!1,this.mousestart=0===a,this.mousemove=1===a,this.mouseend=2===a;var b=this.puzzle;b.emit("mouse"),this.cancelEvent||"left"!==this.btn&&"right"!==this.btn||(this.mousestart?(b.opemgr.newOperation(),b.errclear(),b.opemgr.updateStarts()):b.opemgr.newChain(),this.mouseinput())},mouseinput:function(){var a=this.inputMode;switch(this.puzzle.key.isZ&&-1===this.inputMode.indexOf(/info\-/)&&(this.inputModes.play.indexOf("info-line")>=0?a="info-line":this.inputModes.play.indexOf("info-blk")>=0&&(a="info-blk")),a){case"auto":this.mouseinput_auto();break;case"number":case"number-":this.mouseinput_number();break;case"clear":this.mouseinput_clear();break;case"cell51":this.input51_fixed();break;case"circle-unshade":this.inputFixedNumber(1);break;case"circle-shade":this.inputFixedNumber(2);break;case"undef":this.inputFixedNumber(-2);break;case"ice":this.inputIcebarn();break;case"numexist":this.inputFixedNumber(-2);break;case"numblank":this.inputFixedNumber(-3);break;case"bgcolor":this.inputBGcolor(!0);break;case"subcircle":case"bgcolor1":this.inputFixedQsub(1);break;case"subcross":case"bgcolor2":this.inputFixedQsub(2);break;case"completion":this.mousestart&&this.inputqcmp();break;case"objblank":this.inputDot();break;case"direc":this.inputdirec();break;case"arrow":this.inputarrow_cell();break;case"crossdot":this.mousestart&&this.inputcrossMark();break;case"border":this.inputborder();break;case"subline":this.inputQsubLine();break;case"shade":case"unshade":this.inputShade();break;case"line":this.inputLine();break;case"peke":this.inputpeke();break;case"bar":this.inputTateyoko();break;case"info-line":this.mousestart&&this.dispInfoLine();break;case"info-blk":this.mousestart&&this.dispInfoBlk();break;default:this.mouseinput_other()}},mouseinput_number:function(){this.mousestart&&this.inputqnum()},mouseinput_clear:function(){this.inputclean_cell()},mouseinput_auto:function(){},mouseinput_other:function(){},notInputted:function(){return!this.puzzle.opemgr.changeflag},setInputMode:function(a){if(a=a||"auto",!(this.getInputModeList().indexOf("number-"===a?"number":a)>=0))throw"Invalid input mode :"+a;this.inputMode=a,this.savedInputMode[this.puzzle.editmode?"edit":"play"]=a},getInputModeList:function(a){if("viewer"===this.puzzle.instancetype)return[];a=a||(this.puzzle.editmode?"edit":"play");var b=["auto"];return b=b.concat(this.inputModes[a]),b.indexOf("number")>=0&&b.splice(b.indexOf("number")+1,0,"number-"),b},setInversion:function(a){this.inversion=!!a},getcell:function(){return this.getpos(0).getc()},getcell_excell:function(){var a=this.getpos(0),b=a.getex();return b.isnull?a.getc():b},getcross:function(){return this.getpos(.5).getx()},getpos:function(a){var b=this.inputPoint,c=2*a,d=2*(1-a),e=Math.min(this.board.minbx,this.board.minby),f=4+(e>=0?0:-2&-e),g=b.bx+f,h=b.by+f,i=g%2,j=h%2;return g=+(i>=c)+(-2&g)+ +(i>=d)-f,h=+(j>=c)+(-2&h)+ +(j>=d)-f,new this.klass.Address(g,h)},getborder:function(a){var b=this.inputPoint,c=1+(-2&b.bx),d=1+(-2&b.by),e=b.bx+1-c,f=b.by+1-d,g=this.board;if(g.linegraph.isLineCross)if(g.borderAsLine){var h=2*(.5-a),i=2*(.5+a);if(h<e&&e<i&&h<f&&f<i)return g.emptyborder}else{var h=2*a,i=2*(1-a);if((e<h||i<e)&&(f<h||i<f))return g.emptyborder}return e<2-f?e>f?g.getb(c,d-1):g.getb(c-1,d):e>f?g.getb(c+1,d):g.getb(c,d+1)},isBorderMode:function(){return this.mousestart&&(this.bordermode=!this.getpos(.25).oncell()),this.bordermode},setcursor:function(a){var b=this.cursor.getaddr();this.cursor.setaddr(a),b.draw(),a.draw()},setcursorsnum:function(a){var b=this.cursor.getaddr();this.cursor.setaddr(a);var c=this.inputPoint.bx,d=this.inputPoint.by;c=(c+12)%2*1.5|0,d=(d+12)%2*1.5|0;var e;e="factors"!==this.pid?[5,0,4,0,0,0,2,0,3][3*d+c]:[0,0,4,0,0,0,2,0,3][3*d+c],this.cursor.targetdir!==e&&(this.cursor.targetdir=e),b.draw(),a.draw()}}}),a.classmgr.makeCommon({KeyEvent:{initialize:function(){this.cursor=this.puzzle.cursor,this.enableKey=!0,this.keyreset()},enablemake:!1,enableplay:!1,keyup_event:!1,keyreset:function(){this.isCTRL=!1,this.isMETA=!1,this.isALT=!1,this.isSHIFT=!1,this.isZ=!1,this.isX=!1,this.isY=!1,this.keydown=!1,this.keyup=!1,this.ca="",this.prev=null},isenablemode:function(){return this.puzzle.editmode&&this.enablemake||this.puzzle.playmode&&this.enableplay},e_keydown:function(a){var b=this.getchar(a);if(!this.enableKey)return void("BS"!==b&&" "!==b||(a.stopPropagation(),a.preventDefault()));this.checkbutton(b,0),b&&this.keyevent(b,0),(a.target===this.puzzle.canvas||this.cancelDefault)&&(a.stopPropagation(),a.preventDefault())},e_keyup:function(a){var b=this.getchar(a);if(!this.enableKey)return void("BS"!==b&&" "!==b||(a.stopPropagation(),a.preventDefault()));this.checkbutton(b,1),b&&this.keyevent(b,1),(a.target===this.puzzle.canvas||this.cancelDefault)&&(a.stopPropagation(),a.preventDefault())},checkmodifiers:function(a){this.isSHIFT=a.shiftKey,this.isCTRL=a.ctrlKey,this.isMETA=a.metaKey,this.isALT=a.altKey
},checkbutton:function(a,b){var c=a.split(/\+/).pop();"z"===c&&(this.isZ=0===b),"x"===c&&(this.isX=0===b),"y"===c&&(this.isY=0===b)},getchar:function(a){this.checkmodifiers(a);var b="",c=a.keyCode?a.keyCode:a.charCode;38===c?b="up":40===c?b="down":37===c?b="left":39===c?b="right":48<=c&&c<=57?b=(c-48).toString(36):65<=c&&c<=90?b=(c-55).toString(36):96<=c&&c<=105?b=(c-96).toString(36):112<=c&&c<=123?b="F"+(c-111).toString(10):32===c||46===c?b=" ":8===c?b="BS":109!==c&&189!==c&&173!==c||(b="-");var d=b?[b]:[];return this.isMETA&&d.unshift("meta"),this.isALT&&d.unshift("alt"),this.isCTRL&&d.unshift("ctrl"),this.isSHIFT&&d.unshift("shift"),b=d.join("+"),"alt+h"===b?b="left":"alt+k"===b?b="up":"alt+j"===b?b="down":"alt+l"===b&&(b="right"),b},inputKeys:function(a){for(var b=0;b<arguments.length;b++)this.keyevent(arguments[b],0),this.keyevent(arguments[b],1)},keyevent:function(a,b){var c=this.puzzle;if(this.cancelEvent=!1,this.cancelDefault=!1,this.keydown=0===b,this.keyup=1===b,"BS"!==a&&" "!==a||(this.cancelDefault=!0),this.keydown?c.opemgr.newOperation():c.opemgr.newChain(),this.keydown&&!this.isZ&&(c.errclear(),c.opemgr.updateStarts()),c.emit("key",a),!this.cancelEvent&&this.keyexec(a)&&this.keyDispInfo(a)&&this.isenablemode())return this.keydown&&this.moveTarget(a)?void(this.cancelDefault=!0):void((this.keydown||this.keyup&&this.keyup_event)&&this.keyinput(a))},keyexec:function(a){var b=this.puzzle;return!(this.keydown&&"alt+c"===a&&!b.playeronly)||(b.setMode(b.playmode?b.MODE_EDITOR:b.MODE_PLAYER),!1)},keyDispInfo:function(a){return!0},keyinput:function(a){this.key_inputqnum(a)},moveTarget:function(a){return this.moveTCell(a)},moveTCell:function(a){return this.moveTC(a,2)},moveTCross:function(a){return this.moveTC(a,2)},moveTBorder:function(a){return this.moveTC(a,1)},moveTC:function(a,b){var c=this.cursor,d=c.getaddr(),e=!0,f=c.NDIR;switch(a){case"up":c.by-b>=c.miny&&(f=c.UP);break;case"down":c.by+b<=c.maxy&&(f=c.DN);break;case"left":c.bx-b>=c.minx&&(f=c.LT);break;case"right":c.bx+b<=c.maxx&&(f=c.RT);break;default:e=!1}return e&&(c.movedir(f,b),d.draw(),c.draw()),e},moveExCell:function(a){var b=this.cursor,c=b.getaddr(),d=!0,e=c.NDIR;switch(a){case"up":b.by===b.maxy&&b.minx<b.bx&&b.bx<b.maxx?b.by=b.miny:b.by>b.miny?e=c.UP:"easyasabc"===this.pid&&-1===b.by?e=c.UP:d=!1;break;case"down":b.by===b.miny&&b.minx<b.bx&&b.bx<b.maxx?b.by=b.maxy:b.by<b.maxy?e=c.DN:"easyasabc"===this.pid&&-3===b.by?e=c.DN:d=!1;break;case"left":b.bx===b.maxx&&b.miny<b.by&&b.by<b.maxy?b.bx=b.minx:b.bx>b.minx?e=c.LT:d=!1;break;case"right":b.bx===b.minx&&b.miny<b.by&&b.by<b.maxy?b.bx=b.maxx:b.bx<b.maxx?e=c.RT:d=!1;break;default:d=!1}return d&&(e!==c.NDIR&&b.movedir(e,2),c.draw(),b.draw()),d}},"TargetCursor:Address":{initialize:function(){this.bx=1,this.by=1,this.mode51=51===this.puzzle.klass.ExCell.prototype.ques,this.modesnum=this.puzzle.klass.Cell.prototype.enableSubNumberArray,this.targetdirs=this.puzzle.klass.Cell.prototype.dirs51,this.mode51&&this.puzzle.editmode&&(this.targetdir=4)},init:function(a,b){return this.bx=a,this.by=b,this.mode51||(this.targetdir=0),this},minx:null,miny:null,maxx:null,maxy:null,crosstype:!1,initCursor:function(){this.crosstype?this.init(0,0):this.init(1,1),this.adjust_init()},setminmax:function(){var a=this.board,b=this.crosstype?0:1;this.minx=a.minbx+b,this.miny=a.minby+b,this.maxx=a.maxbx-b,this.maxy=a.maxby-b,this.setminmax_customize(),this.adjust_init()},setminmax_customize:function(){},adjust_init:function(){this.bx<this.minx&&(this.bx=this.minx),this.by<this.miny&&(this.by=this.miny),this.bx>this.maxx&&(this.bx=this.maxx),this.by>this.maxy&&(this.by=this.maxy)},adjust_modechange:function(){this.setminmax_customize!==this.common.setminmax_customize&&this.setminmax(),this.mode51&&this.puzzle.editmode?this.targetdir=4:this.modesnum&&this.puzzle.playmode&&(this.targetdir=0)},adjust_cell_to_excell:function(){var a=this.board,b=Math.min(this.bx,2*a.cols-this.bx,this.by,2*a.rows-this.by);b<=0||(this.by===b?this.by=this.miny:2*a.rows-this.by===b?this.by=this.maxy:this.bx===b?this.bx=this.minx:2*a.cols-this.bx===b&&(this.bx=this.maxx))},checksnum:function(a){var b=2*(((a.bx+12)/2|0)-6)+1,c=2*(((a.by+12)/2|0)-6)+1,d=this.bx===b&&this.by===c;if(d&&this.modesnum&&this.puzzle.playmode){var e=(a.bx+12)%2*1.5|0,f=(a.by+12)%2*1.5|0;d="factors"!==this.pid?[5,0,4,0,0,0,2,0,3][3*f+e]===this.targetdir:[0,0,4,0,0,0,2,0,3][3*f+e]===this.targetdir}return d},movedir:function(a,b){return this.puzzle.klass.Address.prototype.movedir.call(this,a,b),this.modesnum&&this.puzzle.playmode&&(this.targetdir=0),this},setaddr:function(a){a.bx<this.minx||this.maxx<a.bx||a.by<this.miny-("easyasabc"===this.pid?2:0)||this.maxy<a.by||(this.set(a),this.modesnum&&this.puzzle.playmode&&(this.targetdir=0))},moveTo:function(a,b){this.init(a,b),this.modesnum&&this.puzzle.playmode&&(this.targetdir=0)},targetdir:0,chtarget:function(a,b,c){if(this.oncell()&&this.modesnum&&this.puzzle.playmode)"factors"!==this.pid?this.targetdir=[5,1,3,0,2,4][this.targetdir]:this.targetdir=[4,1,3,0,2,0][this.targetdir];else if(4===this.targetdirs)if(a){var d=b-c>0,e=b+c<0;this.targetdir=d?e?1:4:e?3:2}else this.targetdir=[4,0,3,1,2,0][this.targetdir];else this.targetdir=a?b-c>0?4:2:2===this.targetdir?4:2;this.draw()},detectTarget:function(a){a=a||this.getobj();var b=this.board,c=a.adjacent;if(a.isnull)return 0;if("cell"===a.group){if(51!==a.ques||a.id===b.cell.length-1)return 0;if(2===this.targetdirs){var d=c.right.isnull||51===c.right.ques,e=c.bottom.isnull||51===c.bottom.ques;if(d&&e)return 0;if(e)return a.RT;if(d)return a.DN}}else{if("excell"!==a.group)return 0;if(a.id===b.cols+b.rows)return 0;if(-1===a.by&&51===c.bottom.ques||-1===a.bx&&51===c.right.ques)return 0;if(-1===a.by)return a.DN;if(-1===a.bx)return a.RT}return this.targetdir},getNumOfTarget:function(a){var b=1;if(a.isnull)b=0;else if("cell"===a.group)if(this.modesnum&&this.puzzle.playmode)b=4-("factors"===this.pid?1:0);else if(51===a.ques){var c=a.adjacent;b=(c.right.isnull||51===c.right.ques?0:1)+(c.bottom.isnull||51===c.bottom.ques?0:1)}return b},getDot:function(){return this.board.getDot(this.bx,this.by)}}}),a.classmgr.makeCommon({Encode:{pflag:"",outpflag:"",outvariant:null,outcols:null,outrows:null,outbstr:"",fio:null,checkpflag:function(a){return this.pflag.indexOf(a)>=0},decodeURL:function(b){var c=a.parser.parseURL(b),d=this.puzzle,e=d.board;if(c.type===c.URL_PZPRFILE)return void(new d.klass.FileIO).filedecode(c.body);if(e.initBoardSize(c.cols,c.rows),null!==c.variant&&(d.setConfig("variant",!0),d.setConfig("variantid",c.variant)),c.body)switch(this.pflag=c.pflag,this.outbstr=c.body,c.type){case c.URL_PZPRV3:case c.URL_KANPENP:this.decodePzpr(c.URL_PZPRV3);break;case c.URL_PZPRAPP:this.decodePzpr(c.URL_PZPRAPP);break;case c.URL_KANPEN:this.fio=new d.klass.FileIO,this.fio.dataarray=this.outbstr.replace(/_/g," ").split("/"),this.decodeKanpen(),this.fio=null;break;case c.URL_HEYAAPP:this.decodeHeyaApp()}e.rebuildInfo()},encodeURL:function(b,c){var d=this.puzzle,e=d.pid,f=d.board,g=new a.parser.URLData("",c);b=b||g.URL_PZPRV3,b===g.URL_KANPEN&&"lits"===e&&(b=g.URL_KANPENP),this.outpflag=null;var h=d.getConfig("variant");switch(this.outvariant=h?d.getConfig("variantid"):null,this.outcols=f.cols,this.outrows=f.rows,this.outbstr="",b){case g.URL_PZPRV3:this.encodePzpr(g.URL_PZPRV3);break;case g.URL_PZPRFILE:var i=this.puzzle.getFileData(g.FILE_PZPRV3).split("\n");i=i.map(encodeURIComponent),this.outbstr=i.join("/");break;case g.URL_PZPRAPP:throw"no implementation";case g.URL_KANPENP:if(!d.info.exists.kanpen)throw"no implementation";this.encodePzpr(g.URL_PZPRAPP),this.outpflag=this.outpflag||"";break;case g.URL_KANPEN:this.fio=new d.klass.FileIO,this.encodeKanpen(),this.outbstr=this.fio.datastr.replace(/\r?\n/g,"/").replace(/ /g,"_"),this.fio=null;break;case g.URL_HEYAAPP:this.encodeHeyaApp();break;default:throw"invalid URL Type"}return g.pid=e,g.type=b,g.pflag=this.outpflag,g.variant=this.outvariant,g.cols=this.outcols,g.rows=this.outrows,g.body=this.outbstr,g.generate()},decodePzpr:function(a){throw"no implementation"},encodePzpr:function(a){throw"no implementation"},decodeKanpen:function(){throw"no implementation"},encodeKanpen:function(){throw"no implementation"},decodeHeyaApp:function(){throw"no implementation"},encodeHeyaApp:function(){throw"no implementation"}}}),function(){function c(){throw"no implementation"}a.classmgr.makeCommon({FileIO:{filever:0,lineseek:0,dataarray:null,xmldoc:null,datastr:"",currentType:0,filedecode:function(b){var c=this.puzzle,d=c.board,e=a.parser.parseFile(b,c.pid),f=this.currentType=e.type;switch(d.initBoardSize(e.cols,e.rows),this.filever=e.filever,f!==e.FILE_PBOX_XML?(this.lineseek=0,this.dataarray=e.body.split("\n")):this.xmldoc=e.body,f){case e.FILE_PZPR:this.decodeData(),(this.readLine()||"").match(/TrialData/)&&(this.lineseek--,this.decodeTrial());break;case e.FILE_PBOX:this.kanpenOpen();break;case e.FILE_PBOX_XML:this.kanpenOpenXML()}c.metadata.update(e.metadata),e.history&&f===e.FILE_PZPR&&c.opemgr.decodeHistory(e.history),d.rebuildInfo(),this.dataarray=null},fileencode:function(c,d){var e=this.puzzle,f=e.board,g=new a.parser.FileData("",e.pid);if(this.currentType=c=c||g.FILE_PZPR,d=d||{},this.filever=0,this.datastr="",c===g.FILE_PBOX_XML){this.xmldoc=(new b).parseFromString('<?xml version="1.0" encoding="utf-8" ?><puzzle />',"text/xml");var h=this.xmldoc.querySelector("puzzle");h.appendChild(this.createXMLNode("board")),h.appendChild(this.createXMLNode("answer"))}switch(c){case g.FILE_PZPR:this.encodeData(),!d.history&&d.trial&&f.trialstage>0&&this.encodeTrial();break;case g.FILE_PBOX:this.kanpenSave();break;case g.FILE_PBOX_XML:this.kanpenSaveXML();break;default:throw"invalid filetype"}return g.type=c,g.filever=this.filever,g.cols=f.cols,g.rows=f.rows,c!==g.FILE_PBOX_XML?g.body=this.datastr:g.body=this.xmldoc,g.metadata.update(e.metadata),d.history&&c===g.FILE_PZPR&&(g.history=e.opemgr.encodeHistory({time:!!d.time})),this.datastr="",g.generate()},decodeData:c,encodeData:c,kanpenOpen:c,kanpenSave:c,kanpenOpenXML:c,kanpenSaveXML:c,decodeTrial:function(){for(var a=this.puzzle.opemgr,b=this.board,c=0|this.readLine().match(/TrialData\((\d+)\)/)[1],d=c-1;d>=0;d--){var e=[],f=b.freezecopy();b.allclear(!1),this.decodeData(),b.compareData(f,function(a,c,d){var g=b[a][c],h=g[d],i=f[a][c][d];e.push(new this.puzzle.klass.ObjectOperation(g,d,h,i))}),a.history.unshift(e),a.history.unshift([new this.puzzle.klass.TrialEnterOperation(d,d+1)]),a.trialpos.unshift(2*d),this.readLine()}a.position=a.history.length,a.resumeTrial()},encodeTrial:function(){var a=this.puzzle.opemgr,b=a.position;a.disableRecord();for(var c=this.board.trialstage;c>0;c--)this.writeLine("TrialData("+c+")"),a.resumeGoto(a.trialpos[c-1]),this.encodeData();a.resumeGoto(b),a.resumeTrial(),a.enableRecord()},readLine:function(){return this.lineseek++,this.dataarray[this.lineseek-1]},getItemList:function(a){for(var b,c=[],d=0;d<a;d++)if(b=this.readLine())for(var e=b.split(" "),f=0;f<e.length;f++)""!==e[f]&&c.push(e[f]);return c},writeLine:function(a){a="number"==typeof a?""+a:a||"",this.datastr+=a+"\n"},decodeObj:function(a,b,c,d,e,f){for(var g=c,h=d,i=this.getItemList((f-d)/2+1),j=0;j<i.length&&(a.call(this,this.board.getObjectPos(b,g,h),i[j]),g+=2,g>e&&(g=c,h+=2),!(h>f));j++);},decodeCell:function(a){this.decodeObj(a,"cell",1,1,2*this.board.cols-1,2*this.board.rows-1)},decodeCross:function(a){this.decodeObj(a,"cross",0,0,2*this.board.cols,2*this.board.rows)},decodeBorder:function(b){var c=this.puzzle,d=c.board;1===d.hasborder||"bosanowa"===c.pid||"fourcells"===c.pid&&0===this.filever?(this.decodeObj(b,"border",2,1,2*d.cols-2,2*d.rows-1),this.decodeObj(b,"border",1,2,2*d.cols-1,2*d.rows-2)):2===d.hasborder&&(this.currentType===a.parser.FILE_PZPR?(this.decodeObj(b,"border",0,1,2*d.cols,2*d.rows-1),this.decodeObj(b,"border",1,0,2*d.cols-1,2*d.rows)):this.currentType===a.parser.FILE_PBOX&&(this.decodeObj(b,"border",1,0,2*d.cols-1,2*d.rows),this.decodeObj(b,"border",0,1,2*d.cols,2*d.rows-1)))},decodeCellExCell:function(a){this.decodeObj(a,"obj",this.board.minbx+1,this.board.minby+1,this.board.maxbx-1,this.board.maxby-1)},encodeObj:function(a,b,c,d,e,f){for(var g=d;g<=f;g+=2){for(var h="",i=c;i<=e;i+=2)h+=a.call(this,this.board.getObjectPos(b,i,g));this.writeLine(h)}},encodeCell:function(a){this.encodeObj(a,"cell",1,1,2*this.board.cols-1,2*this.board.rows-1)},encodeCross:function(a){this.encodeObj(a,"cross",0,0,2*this.board.cols,2*this.board.rows)},encodeBorder:function(b){var c=this.puzzle,d=c.board;1===d.hasborder||"bosanowa"===c.pid?(this.encodeObj(b,"border",2,1,2*d.cols-2,2*d.rows-1),this.encodeObj(b,"border",1,2,2*d.cols-1,2*d.rows-2)):2===d.hasborder&&(this.currentType===a.parser.FILE_PZPR?(this.encodeObj(b,"border",0,1,2*d.cols,2*d.rows-1),this.encodeObj(b,"border",1,0,2*d.cols-1,2*d.rows)):this.currentType===a.parser.FILE_PBOX&&(this.encodeObj(b,"border",1,0,2*d.cols-1,2*d.rows),this.encodeObj(b,"border",0,1,2*d.cols,2*d.rows-1)))},encodeCellExCell:function(a){this.encodeObj(a,"obj",this.board.minbx+1,this.board.minby+1,this.board.maxbx-1,this.board.maxby-1)},decodeFlags:function(){for(var a=this.readLine().split(","),b=0;b<a.length;b++)this.puzzle.setConfig(a[b],!0)},encodeFlags:function(a){for(var b=[],c=0;c<a.length;c++)this.puzzle.getConfig(a[c])&&b.push(a[c]);this.writeLine(b.join(","))},decodeCellXMLBoard:function(a){for(var b=this.xmldoc.querySelectorAll("board number"),c=0;c<b.length;c++){var d=b[c],e=this.board.getc(2*+d.getAttribute("c")-1,2*+d.getAttribute("r")-1);e.isnull||a(e,+d.getAttribute("n"))}},encodeCellXMLBoard:function(a){for(var b=this.xmldoc.querySelector("board"),c=this.board,d=0;d<c.cell.length;d++){var e=c.cell[d],f=a(e);null!==f&&b.appendChild(this.createXMLNode("number",{r:1+(e.by/2|0),c:1+(e.bx/2|0),n:f}))}},PBOX_ADJUST:0,decodeCellXMLBrow:function(a){this.decodeCellXMLrow_com(a,"board","brow")},encodeCellXMLBrow:function(a){this.encodeCellXMLrow_com(a,"board","brow")},decodeCellXMLArow:function(a){this.decodeCellXMLrow_com(a,"answer","arow")},encodeCellXMLArow:function(a){this.encodeCellXMLrow_com(a,"answer","arow")},decodeCellXMLrow_com:function(a,b,c){for(var d=this.xmldoc.querySelectorAll(b+" "+c),e=this.PBOX_ADJUST,f=0;f<d.length;f++)for(var g=1-e,h=2*+d[f].getAttribute("row")-1-e,i=d[f].childNodes,j=0;j<i.length;j++)if(1===i[j].nodeType){var k=i[j].nodeName,l=i[j].getAttribute("n")||1;"z"===k?k="n0":"n"===k&&(k="n"+ +i[j].getAttribute("v"));for(var m=0;m<l;m++)a(this.board.getobj(g,h),k),g+=2}},encodeCellXMLrow_com:function(a,b,c){for(var d=this.xmldoc.querySelector(b),e=this.PBOX_ADJUST,f=this.board,g=1-e;g<=f.maxby;g+=2){for(var h=this.createXMLNode(c,{row:1+((g+e)/2|0)}),i=1-e;i<=f.maxbx;i+=2){var j,k=f.getobj(i,g),l=a(k);j=l.match(/n(\d\d+)/)||l.match(/n(\-\d+)/)?this.createXMLNode("n",{v:RegExp.$1}):"n0"===l?this.createXMLNode("z"):this.createXMLNode(l),h.appendChild(j)}d.appendChild(h)}},createXMLNode:function(a,b){var c=this.xmldoc.createElement(a);if(b)for(var d in b)c.setAttribute(d,b[d]);return c}}})}(),a.classmgr.makeCommon({AnsCheck:{initialize:function(){this.inCheck=!1,this.checkOnly=!1,this.makeCheckList()},failcodemode:void 0,failcode:void 0,_info:void 0,checklist:[],makeCheckList:function(){for(var b=this.checklist,c=[],d=0;d<b.length;d++){var e=b[d],f=!0,g=0;e.match("@")&&(f=a.util.checkpid(e.substr(e.indexOf("@")+1),this.puzzle.pid),e=e.substr(0,e.indexOf("@"))),f&&(g=(e.match(/\+/)||[]).length,e=e.replace(/\+/g,""),c.push([this[e],g]))}this.checklist_normal=[];for(var d=0;d<c.length;d++)this.checklist_normal.push(c[d][0]);c=c.sort(function(a,b){return b[1]-a[1]}),this.checklist_auto=[];for(var d=0;d<c.length;d++)this.checklist_auto.push(c[d][0])},check:function(a){var b=this.puzzle,c=this.board;return this.inCheck=!0,a?(this.checkOnly=!1,this.checkAns(!1),this.failcode.complete||(c.haserror=!0,b.redraw(!0))):void 0!==this.failcode&&this.failcodemode===a||(c.disableSetError(),this.checkOnly=!0,this.checkAns(!1===a),this.failcodemode=a,c.enableSetError()),this.inCheck=!1,this.failcode},checkAns:function(a){this.failcode=new this.klass.CheckInfo;for(var b=!this.puzzle.getConfig("multierr")||a,c=this.checkOnly&&b?this.checklist_auto:this.checklist_normal,d=0;d<c.length&&(c[d].call(this),!(b&&this.failcode.length>0));d++);a||(this.failcode.text=this.failcode.gettext())},resetCache:function(){this.failcode=this.failcodemode=void 0,this._info={}}},CheckInfo:{initialize:function(a){this.add(a)},complete:!0,undecided:!1,text:"",length:0,lastcode:null,add:function(a){a&&(a!==this.lastcode&&(this[this.length++]=this.lastcode=a),this.complete=!1)},gettext:function(b){var c=this.puzzle,d=c.faillist,e=[],f="ja"===(b||a.lang)?0:1;if(0===this.length)return d.complete[f];for(var g=0;g<this.length;g++){var h=d[this[g]]||d.invalid;e.push(h[f])}return e.join("\n")},setUndecided:function(){this.undecided=!0}},FailCode:{complete:["正解です！","Complete!"],invalid:["不明なエラーです","Invalid Error"]}}),a.classmgr.makeCommon({Operation:{external:!1,initialize:function(){if(this.manager=this.puzzle.opemgr,arguments.length>0){var a=Array.prototype.slice.call(arguments);this.setData.apply(this,a)}},reqReset:!1,setData:function(a,b){this.old=a,this.num=b},decode:function(a){return!1},toString:function(){return""},toJSON:function(){return this.toString()},broadcast:function(){},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.num)},exec:function(a){}},"ObjectOperation:Operation":{group:"",property:"",pos:null,STRGROUP:{C:"cell",X:"cross",B:"border",E:"excell"},STRPROP:{U:"ques",N:"qnum",Z:"qnum2",C:"qchar",M:"anum",D:"qdir",A:"qans",S:"qsub",K:"qcmp",B:"snum",L:"line"},setData:function(a,b,c,d){this.group=a.group,this.property=b,this.bx=a.bx,this.by=a.by,this.old=c,this.num=d,b.length>4&&"snum"===b.substr(0,4)&&(this.property="snum",this.pos=b.substr(4))},decode:function(a){return this.group=this.STRGROUP[a[0].charAt(0)],this.property=this.STRPROP[a[0].charAt(1)],!(!this.group||!this.property)&&(this.pos="CB"===a[0].substr(0,2)&&a[0].length>2?+a[0].charAt(2):null,this.bx=+a[1],this.by=+a[2],this.old=+a[3],this.num=+a[4],!0)},toString:function(){var a="";for(var b in this.STRGROUP)if(this.group===this.STRGROUP[b]){a+=b;break}for(var b in this.STRPROP)if(this.property===this.STRPROP[b]){a+=b;break}return"CB"===a&&null!==this.pos&&(a+=this.pos),[a,this.bx,this.by,this.old,this.num].join(",")},broadcast:function(){this.external||this.puzzle.emit("cellop",this.toJSON())},isModify:function(a){var b=this.property;return a.group===this.group&&a.property===this.property&&a.num===this.old&&a.bx===this.bx&&a.by===this.by&&("qnum"===b||"qnum2"===b||"qchar"===b||"anum"===b||"snum"===b&&a.pos===this.pos)&&(a.num=this.num,!0)},isNoop:function(){return this.num===this.old},getPiece:function(){return this.board.getObjectPos(this.group,this.bx,this.by)},exec:function(a){var b=this.getPiece(),c=this.board;if(this.group!==b.group)return!0;switch(null===this.pos?b.setdata(this.property,a,!0):b.setdata2(this.property,this.pos,a,!0),b.draw(),this.property){case"qcmp":c.cell.each(function(a){b===a.base&&a.draw()});break;default:this.puzzle.checker.resetCache()}}},"BoardClearOperation:Operation":{prefix:"AC",reqReset:!0,decode:function(a){return a[0]===this.prefix},toString:function(){return this.prefix}},"BoardAdjustOperation:Operation":{prefix:"AJ",reqReset:!0,setData:function(a){this.old=this.num=a},decode:function(a){return a[0]===this.prefix&&(this.old=this.num=a[1],!0)},toString:function(){return[this.prefix,this.num].join(",")},undo:function(){var a=this.board.exec.boardtype[this.old][0];this.exec(a)},redo:function(){var a=this.board.exec.boardtype[this.num][1];this.exec(a)},exec:function(a){var b=this.puzzle,c=b.board,d={x1:0,y1:0,x2:2*c.cols,y2:2*c.rows};c.exec.execadjust_main(a,d),b.redraw()}},"BoardFlipOperation:Operation":{prefix:"AT",reqReset:!0,area:{},setData:function(a,b){this.area=a,this.old=this.num=b},decode:function(a){return a[0]===this.prefix&&(this.old=this.num=a[1],this.area.x1=+a[2],this.area.y1=+a[3],this.area.x2=+a[4],this.area.y2=+a[5],!0)},toString:function(){var a=this.area;return[this.prefix,this.num,a.x1,a.y1,a.x2,a.y2].join(",")},undo:function(){var a=this.area,b={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},c=this.board.exec.boardtype[this.old][0];if(c&this.TURN){var d=b.x1;b.x1=b.y1,b.y1=d}this.exec(c,b)},redo:function(){var a=this.area,b={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},c=this.board.exec.boardtype[this.num][1];this.exec(c,b)},exec:function(a,b){var c=this.puzzle;c.board.exec.execadjust_main(a,b),c.redraw()}},"TrialEnterOperation:Operation":{setData:function(a,b){this.old=a,this.num=b},undo:function(){this.manager.position--,this.manager.resumeTrial(),this.manager.position++,this.manager.trialpos.pop(),this.manager.emitTrial(this.old)},redo:function(){this.manager.trialpos.push(this.manager.position),this.manager.emitTrial(this.num)},decode:function(a){return"TE"===a[0]&&(this.old=+a[1],this.num=+a[2],!0)},toString:function(){return["TE",this.old,this.num].join(",")}},"TrialFinalizeOperation:Operation":{num:[],setData:function(a){this.old=a},exec:function(a){this.manager.trialpos=a.concat(),0===a.length?this.board.trialclear():(this.manager.position--,this.manager.resumeTrial(),this.manager.position++),this.manager.emitTrial(a.length),this.puzzle.redraw()},decode:function(a){return"TF"===a[0]&&(a.shift(),this.old=JSON.parse(a.join(",")),!0)},toString:function(){return"TF,["+this.old.join(",")+"]"}},OperationList:{initialize:function(){this.time=this.puzzle.getTime(),this.length=0},push:function(a){this[this.length++]=a},some:function(a){return Array.prototype.slice.call(this).some(a)}},OperationManager:{initialize:function(){this.lastope=null,this.history=[],this.position=0,this.trialpos=[],this.disEmitTrial=0,this.savedStarts=[],this.broken=!1,this.initpos=0,this.disrec=0,this.disCombine=!1,this.forceRecord=!1,this.changeflag=!1,this.chainflag=!1,this.enableUndo=!1,this.enableRedo=!1,this.limitTrialUndo=!1,this.undoExec=!1,this.redoExec=!1,this.reqReset=!1,this.enableNetwork=!0;var a=this.klass;this.operationlist=[a.ObjectOperation,a.BoardClearOperation,a.BoardAdjustOperation,a.BoardFlipOperation,a.TrialEnterOperation,a.TrialFinalizeOperation],this.addExtraOperation()},addExtraOperation:function(){},getStarts:function(){for(var a=[],b=0;b<this.trialpos.length;b++){var c=this.trialpos[b];if(c+1<this.history.length){var d=this.history[c+1][0];d.getPiece&&a.push(d.getPiece())}}return a},updateStarts:function(){var a,b=this.savedStarts;for(a=b.length;a>0&&b[a-1].isnull;a--);var c=this.getStarts();if(a!==c.length){for(var d=0;d<c.length;d++)this.savedStarts[d]=c[d];for(var d=c.length;d<this.savedStarts.length;d++)this.savedStarts[d]=new this.puzzle.board.klass.BoardPiece;for(var d=0;d<b.length;d++)b[d].draw();for(var d=0;d<this.savedStarts.length;d++)this.savedStarts[d].draw()}},disableRecord:function(){this.disrec++},enableRecord:function(){this.disrec>0&&this.disrec--},checkexec:function(){void 0!==this.history&&(this.checkenable(),this.puzzle.emit("history"))},atStartOfTrial:function(){return this.trialpos.length>0&&this.position<=this.trialpos[this.trialpos.length-1]+1},checkenable:function(){this.limitTrialUndo&&this.trialpos.length>0?this.enableUndo=!this.atStartOfTrial():this.enableUndo=this.position>0,this.enableRedo=this.position<this.history.length,this.board.trialstage=this.trialpos.length},allerase:function(){this.lastope=null,this.history=[],this.position=0,this.broken=!1,this.initpos=0,this.changeflag=!1,this.chainflag=!1,this.checkexec(),this.trialpos=[],this.limitTrialUndo=!1,this.puzzle.checker.resetCache()},newOperation:function(){this.changeflag=!1,this.chainflag=!1},newChain:function(){this.chainflag=!1},isModified:function(){return this.broken||this.initpos<this.position},resetModifiedState:function(){this.broken=!1,this.initpos=this.position},removeDescendant:function(){this.position<this.initpos&&(this.broken=!0);for(var a=this.history.length-1;a>=this.position;a--)this.history.pop();this.position=this.history.length,this.chainflag=!1},add:function(a){if(!(!this.puzzle.ready||!this.forceRecord&&this.disrec>0)){a.broadcast(),this.enableRedo&&this.removeDescendant();var b=this.puzzle;!this.disCombine&&this.lastope&&a.isModify&&a.isModify(this.lastope)?this.lastope.isNoop&&this.lastope.isNoop()&&(this.history.pop(),this.position--,this.lastope=null):(this.chainflag||(this.history.push(new this.klass.OperationList),this.position++,this.chainflag=!0),this.history[this.history.length-1].push(a),this.lastope=a,this.updateStarts()),"qcmp"!==a.property&&"snum"!==a.property&&b.checker.resetCache(),this.changeflag=!0,this.checkexec()}},decodeHistory:function(a){this.allerase(),this.initpos=this.position=a.current||0,this.history=[];for(var b=a.datas||[],c=0,d=b.length;c<d;c++){var e=new this.klass.OperationList;this.history.push(e);var f=b[c];void 0!==f.time&&(e.time=f.time,f=f.ope);for(var g=0,h=f.length;g<h;g++){for(var i=f[g].split(/,/),j=null,k=this.operationlist,l=0;l<k.length;l++){var m=new k[l];if(m.decode(i)){j=m;break}}j&&(e.push(j),this.lastope=j)}}this.checkexec(),this.trialpos=a.trialpos||[],this.trialpos.length>0&&(this.resumeTrial(),this.limitTrialUndo=!0)},encodeHistory:function(a){a=a||{},this.initpos=this.position;var b={type:"pzpr",version:.4};if(a.time&&(b.time=this.puzzle.getTime()),this.history.length>0){b.current=this.position,this.trialpos.length>0&&(b.trialpos=this.trialpos);for(var c=[],d=0;d<this.history.length;++d){var e=Array.prototype.slice.call(this.history[d]);a.time?c.push({ope:e,time:this.history[d].time}):c.push(e)}b.datas=c}return b},undo:function(){if(!this.enableUndo)return!1;var a=this.history[this.position-1];return this.reqReset=this.checkReqReset(a),this.preproc(),this.undoCore(),this.postproc(),this.enableUndo},redo:function(){if(!this.enableRedo)return!1;var a=this.history[this.position];return this.reqReset=this.checkReqReset(a),this.preproc(),this.redoCore(),this.postproc(),this.enableRedo},undoCore:function(){this.undoExec=!0;for(var a=this.history[this.position-1],b=a.length-1;b>=0;b--)a[b]&&a[b].undo();this.position--,this.undoExec=!1},redoCore:function(){this.redoExec=!0;for(var a=this.history[this.position],b=0;b<a.length;++b)a[b]&&a[b].redo();this.position++,this.redoExec=!1},resumeGoto:function(a){if(a<this.position)for(;a<this.position;)this.undoCore();else if(this.position<a)for(;this.position<a;)this.redoCore();this.checkenable()},checkReqReset:function(a){return a.some(function(a){return a.reqReset})},preproc:function(a){var b=this.puzzle,c=b.board;this.disableRecord(),b.painter.suspend(),b.errclear(),this.updateStarts(),this.reqReset&&c.disableInfo()},postproc:function(){var a=this.puzzle,b=a.board;this.reqReset&&(b.setposAll(),b.setminmax(),b.enableInfo(),b.rebuildInfo(),a.redraw(!0),a.emit("adjust")),a.painter.unsuspend(),this.enableRecord(),this.checkexec()},enterTrial:function(){this.atStartOfTrial()||(this.newOperation(),this.add(new this.puzzle.klass.TrialEnterOperation(this.trialpos.length,this.trialpos.length+1)),this.trialpos.push(this.position-1),this.limitTrialUndo=!0,this.checkexec(),this.newOperation(),this.emitTrial())},acceptTrial:function(){this.trialpos[this.trialpos.length-1]+1===this.position&&(this.position--,this.removeDescendant(),this.trialpos.pop()),this.trialpos.length>0&&(this.newOperation(),this.add(new this.puzzle.klass.TrialFinalizeOperation(this.trialpos)),this.board.trialclear()),this.trialpos=[],this.limitTrialUndo=!1,this.removeDescendant(),this.checkexec(),this.newOperation(),this.emitTrial()},rejectTrial:function(a){if(0!==this.trialpos.length){if(this.disableRecord(),this.board.errclear(),a||1===this.trialpos.length){var b=this.trialpos[0];this.board.trialclear(),this.trialpos=[],this.limitTrialUndo=!1,this.resumeGoto(b)}else this.resumeGoto(this.trialpos[this.trialpos.length-1]),this.resumeTrial();this.enableRecord(),this.removeDescendant(),this.checkexec(),this.newOperation(),this.emitTrial()}},resumeTrial:function(){if(this.trialpos.length>0){this.disEmitTrial++;var a=this.position;this.checkenable(),this.resumeGoto(this.trialpos[0]),this.board.trialclear(!0),this.position<a&&(this.board.trialstage=1,this.resumeGoto(a)),this.disEmitTrial--}},emitTrial:function(a){0===this.disEmitTrial&&this.puzzle.emit("trial",void 0===a?this.trialpos.length:a)}}}),a.classmgr.makeCommon({Graphic:{paintPost:function(){this.drawTrialStarts()},drawQuesCells:function(){this.vinc("cell_front","crispEdges",!0),this.drawCells_common("c_fullf_",this.getQuesCellColor)},getQuesCellColor:function(a){return null},getQuesCellColor_ques:function(a){return 1!==a.ques?null:1===(a.error||a.qinfo)?this.errcolor1:this.quescolor},getQuesCellColor_qnum:function(a){return-1===a.qnum?null:1===(a.error||a.qinfo)?this.errcolor1:this.quescolor},drawShadedCells:function(){this.vinc("cell_shaded","crispEdges",!0),this.drawCells_common("c_fulls_",this.getShadedCellColor)},getShadedCellColor:function(a){if(1!==a.qans)return null;var b=a.error||a.qinfo;return 1===b?this.errcolor1:2===b?this.errcolor2:a.trial?this.trialcolor:this.puzzle.execConfig("irowakeblk")?a.sblk.color:this.shadecolor},drawBGCells:function(){this.vinc("cell_back","crispEdges",!0),this.drawCells_common("c_fullb_",this.getBGCellColor)},getBGCellColor:function(a){return null},getBGCellColor_error1:function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:null},getBGCellColor_error2:function(a){var b=a.error||a.qinfo;return 1===b?this.errbcolor1:2===b?this.errbcolor2:null},getBGCellColor_qcmp:function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:this.puzzle.execConfig("autocmp")&&a.room&&a.room.cmp?this.qcmpbgcolor:null},getBGCellColor_qcmp1:function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:1===a.qsub?this.bcolor:this.puzzle.execConfig("autocmp")&&a.room&&a.room.cmp?this.qcmpbgcolor:null},getBGCellColor_qsub1:function(a){return 1===(a.error||a.qinfo)?this.errbcolor1:1===a.qsub?this.bcolor:null},getBGCellColor_qsub2:function(a){return this.bcolor="silver",1===(a.error||a.qinfo)?this.errbcolor1:1===a.qsub?this.qsubcolor1:2===a.qsub?this.qsubcolor2:null},getBGCellColor_qsub3:function(a){return 1===(a.error||a.qinfo)?this.errbcolor1:1===a.qsub?this.qsubcolor1:2===a.qsub?this.qsubcolor2:3===a.qsub?this.qsubcolor3:null},getBGCellColor_icebarn:function(a){return 1===a.error||1===a.qinfo?6===a.ques?this.erricecolor:this.errbcolor1:6===a.ques?this.icecolor:null},drawCells_common:function(a,b){for(var c=this.context,d=this.range.cells,e=0;e<d.length;e++){var f=d[e],g=b.call(this,f);c.vid=a+f.id,g?(c.fillStyle=g,c.fillRectCenter(f.bx*this.bw,f.by*this.bh,this.bw+.5,this.bh+.5)):c.vhide()}},drawBGExCells:function(){for(var a=this.vinc("excell_back","crispEdges",!0),b=this.range.excells,c=0;c<b.length;c++){var d=b[c],e=this.getBGExCellColor(d);a.vid="ex_full_"+d.id,e?(a.fillStyle=e,a.fillRectCenter(d.bx*this.bw,d.by*this.bh,this.bw+.5,this.bh+.5)):a.vhide()}},getBGExCellColor:function(a){if(1===a.error||1===a.qinfo)return this.errbcolor1},drawDotCells:function(){for(var a=this.vinc("cell_dot","auto",!0),b=Math.max(.06*this.cw,2),c=this.range.cells,d=0;d<c.length;d++){var e=c[d];a.vid="c_dot_"+e.id,e.isDot()?(a.fillStyle=e.trial?this.trialcolor:this.qanscolor,a.fillCircle(e.bx*this.bw,e.by*this.bh,b)):a.vhide()}},drawCellArrows:function(){var a,b,c,d,e=this.vinc("cell_arrow","auto");"nagare"!==this.pid?(a=.4*this.cw,b=.03*this.cw,c=.16*this.cw,d=.16*this.cw):(a=.35*this.cw,b=.12*this.cw,c=0,d=.35*this.cw),b=b>=1?b:1,d=d>=5?d:5;for(var f=this.range.cells,g=0;g<f.length;g++){var h=f[g],i=h.numberAsObject?h.getNum():h.qdir,j=i>=1&&i<=4?this.getCellArrowColor(h):null;if(e.vid="c_arrow_"+h.id,j){e.fillStyle=j,e.beginPath();var k=h.bx*this.bw,l=h.by*this.bh;switch(i){case h.UP:e.setOffsetLinePath(k,l,0,-a,-d,-c,-b,-c,-b,a,b,a,b,-c,d,-c,!0);break;case h.DN:e.setOffsetLinePath(k,l,0,a,-d,c,-b,c,-b,-a,b,-a,b,c,d,c,!0);break;case h.LT:e.setOffsetLinePath(k,l,-a,0,-c,-d,-c,-b,a,-b,a,b,-c,b,-c,d,!0);break;case h.RT:
e.setOffsetLinePath(k,l,a,0,c,-d,c,-b,-a,-b,-a,b,c,b,c,d,!0)}e.fill()}else e.vhide()}},getCellArrowColor:function(a){var b=a.numberAsObject?a.getNum():a.qdir;return b>=1&&b<=4?a.numberAsObject&&-1===a.qnum?a.trial?this.trialcolor:this.qanscolor:this.quescolor:null},drawSlashes:function(){for(var a=this.vinc("cell_slash","auto"),b=Math.max(this.bw/4,2),c=this.puzzle.execConfig("irowake"),d=this.range.cells,e=0;e<=1;e++)for(var f=0;f<d.length;f++){var g=d[f];if(a.vid="c_slash_"+e+"_"+g.id,33===g.qans||g.qans===(e?32:31)){var h,i=g.qinfo||g.error,j=0;g.trial&&this.puzzle.execConfig("irowake")?j=-b/2:"gokigen"!==this.pid&&"wagiri"!==this.pid||1!==i&&3!==i||(j=b/2),i>0?i&(e?4:8)?h=this.noerrcolor:1&i?h=this.errcolor1:2&i&&(h=this.errcolor2):h=-1===i?this.noerrcolor:c&&33===g.qans?!!e===g.parity()?g.path.color:g.path2.color:c&&g.path&&g.path.color?g.path.color:c&&g.path2&&g.path2.color?g.path2.color:g.trial?this.trialcolor:this.linecolor,a.lineWidth=b+j,a.strokeStyle=h,a.beginPath();var k=g.bx*this.bw,l=g.by*this.bh;e?a.setOffsetLinePath(k,l,this.bw,-this.bh,-this.bw,this.bh,!0):a.setOffsetLinePath(k,l,-this.bw,-this.bh,this.bw,this.bh,!0),a.stroke()}else a.vhide()}},drawQuesNumbers:function(){this.vinc("cell_number","auto"),this.drawNumbers_com(this.getQuesNumberText,this.getQuesNumberColor,"cell_text_",this.textoption)},drawAnsNumbers:function(){this.vinc("cell_ans_number","auto"),this.drawNumbers_com(this.getAnsNumberText,this.getAnsNumberColor,"cell_ans_text_",{})},drawHatenas:function(){function a(a){return-2===a.ques||-2===a.qnum?"?":""}this.vinc("cell_number","auto"),this.drawNumbers_com(a,this.getQuesNumberColor_qnum,"cell_text_",this.textoption)},drawNumbers_com:function(a,b,c,d){for(var e=this.context,f=this.range.cells,g=0;g<f.length;g++){var h=f[g],i=a.call(this,h);if(e.vid=c+h.id,i){e.fillStyle=b.call(this,h);var j=h.bx*this.bw,k=h.by*this.bh+this.getNumberVerticalOffset(h);this.disptext(i,j,k,d)}else e.vhide()}},getNumberVerticalOffset:function(a){return 0},getQuesNumberText:function(a){return this.getNumberText(a,(this.puzzle.execConfig("dispmove")?a.base:a).qnum)},getAnsNumberText:function(a){return this.getNumberText(a,a.anum)},getNumberText:function(a,b){return a.numberAsLetter?this.getNumberTextCore_letter(b):this.getNumberTextCore(b)},getNumberTextCore:function(a){var b="yajilin"!==this.pid?this.hideHatena:2===this.puzzle.getConfig("disptype_yajilin");return a>=0?""+a:b||-2!==a?"":"?"},getNumberTextCore_letter:function(a){var b=""+a;return-1===a?b="":-2===a?b="?":a>0&&a<=26?b=(a+9).toString(36).toUpperCase():a>26&&a<=52&&(b=(a-17).toString(36).toLowerCase()),b},getQuesNumberColor:function(a){return null},getQuesNumberColor_fixed:function(a){return this.quescolor},getQuesNumberColor_fixed_shaded:function(a){return this.fontShadecolor},getQuesNumberColor_qnum:function(a){return 1===(a.error||a.qinfo)?this.errcolor1:this.quescolor},getQuesNumberColor_move:function(a){var b=this.puzzle,c=a.error||a.qinfo;return 1===c||4===c?this.errcolor1:b.execConfig("dispmove")&&b.mouse.mouseCell===a?this.movecolor:this.quescolor},getQuesNumberColor_mixed:function(a){var b=a.error||a.qinfo;return a.ques>=1&&a.ques<=5||1===a.qans?this.fontShadecolor:1===b||4===b?this.errcolor1:this.quescolor},getAnsNumberColor:function(a){return 1===(a.error||a.qinfo)?this.errcolor1:a.trial?this.trialcolor:this.qanscolor},drawNumbersExCell:function(){for(var a=this.vinc("excell_number","auto"),b=this.range.excells,c=0;c<b.length;c++){var d=b[c],e=this.getQuesNumberText(d);a.vid="excell_text_"+d.id,e?(a.fillStyle=this.getQuesNumberColor(d),this.disptext(e,d.bx*this.bw,d.by*this.bh)):a.vhide()}},drawSubNumbers:function(){for(var a=this.vinc("cell_subnumber","auto"),b=[5,4,2,3],c=this.range.cells,d=0;d<c.length;d++)for(var e=c[d],f=0;f<4;f++){var g=e.numberAsLetter?this.getNumberTextCore_letter(e.snum[f]):this.getNumberTextCore(e.snum[f]);a.vid="cell_subtext_"+e.id+"_"+f,g?(a.fillStyle=e.trial?this.trialcolor:this.subcolor,this.disptext(g,e.bx*this.bw,e.by*this.bh,{position:b[f],ratio:.33,hoffset:.8})):a.vhide()}},drawArrowNumbers:function(){for(var a=this.vinc("cell_arrownumber","auto"),b=.4*this.cw,c=.03*this.cw,d=.16*this.cw,e=.12*this.cw,f=.6*-this.bh,g=[.6*this.bw,.7*this.bw,.8*this.bw,.85*this.bw],h=this.range.cells,i=0;i<h.length;i++){var j=h[i],k=j.qdir,l=this.getQuesNumberText(j),m=j.bx*this.bw,n=j.by*this.bh,o=l.length-1;if(l&&(a.fillStyle=this.getQuesNumberColor(j)),a.vid="cell_arrow_"+j.id,l&&k!==j.NDIR){switch(a.beginPath(),k){case j.UP:a.setOffsetLinePath(m+g[o],n,0,-b,-e,-d,-c,-d,-c,b,c,b,c,-d,e,-d,!0);break;case j.DN:a.setOffsetLinePath(m+g[o],n,0,b,-e,d,-c,d,-c,-b,c,-b,c,d,e,d,!0);break;case j.LT:a.setOffsetLinePath(m,n+f,-b,0,-d,-e,-d,-c,b,-c,b,c,-d,c,-d,e,!0);break;case j.RT:a.setOffsetLinePath(m,n+f,b,0,d,-e,d,-c,-b,-c,-b,c,d,c,d,e,!0)}a.fill()}else a.vhide();if(a.vid="cell_arnum_"+j.id,l){var p={ratio:this.fontsizeratio};k!==j.NDIR&&(p.ratio=.7),k===j.UP||k===j.DN?m-=.1*this.cw:k!==j.LT&&k!==j.RT||(n+=.1*this.ch),this.disptext(l,m,n,p)}else a.vhide()}},drawCircledNumbers:function(){this.drawCircles(),this.vinc("cell_number","auto"),this.drawNumbers_com(this.getQuesNumberText,this.getQuesNumberColor,"cell_text_",{ratio:.65})},drawTapaNumbers:function(){for(var a=this.vinc("cell_tapanum","auto"),b=this.bw,c=this.bh,d=[{option:{},pos:[{x:0,y:0}]},{option:{ratio:.56},pos:[{x:-.4,y:-.4},{x:.4,y:.4}]},{option:{ratio:.48},pos:[{x:-.5,y:-.4},{x:.5,y:-.4},{x:0,y:.4}]},{option:{ratio:.4},pos:[{x:-.55,y:0},{x:0,y:-.5},{x:.55,y:0},{x:0,y:.5}]}],e=this.range.cells,f=0;f<e.length;f++){var g=e[f],h=g.bx,i=g.by,j=g.qnums,k=j.length;a.fillStyle=this.getQuesNumberColor(g);for(var l=0;l<4;l++)if(a.vid="cell_text_"+g.id+"_"+l,l<k&&-1!==j[l]){var m=d[k-1],n=(h+m.pos[l].x)*b,o=(i+m.pos[l].y)*c,p=j[l]>=0?""+j[l]:"?";this.disptext(p,n,o,m.option)}else a.vhide()}},drawCrosses:function(){var a=this.vinc("cross_base","auto",!0),b=this.cw*this.crosssize+1;a.lineWidth=1;for(var c={ratio:.6},d=this.range.crosses,e=0;e<d.length;e++){var f=d[e],g=f.bx*this.bw,h=f.by*this.bh;a.vid="x_cp_"+f.id,-1!==f.qnum?(a.fillStyle=1===f.error||1===f.qinfo?this.errcolor1:"white",a.strokeStyle="black",a.shapeCircle(g,h,b)):a.vhide(),a.vid="cross_text_"+f.id,f.qnum>=0?(a.fillStyle=this.quescolor,this.disptext(""+f.qnum,g,h,c)):a.vhide()}},drawCrossMarks:function(){for(var a=this.vinc("cross_mark","auto",!0),b=this.cw*this.crosssize,c=this.range.crosses,d=0;d<c.length;d++){var e=c[d];a.vid="x_cm_"+e.id,1===e.qnum?(a.fillStyle=1===e.error||1===e.qinfo?this.errcolor1:this.quescolor,a.fillCircle(e.bx*this.bw,e.by*this.bh,b)):a.vhide()}},drawBorders:function(){this.vinc("border","crispEdges",!0),this.drawBorders_common("b_bd_")},drawBorders_common:function(a){for(var b=this.context,c=this.range.borders,d=0;d<c.length;d++){var e=c[d],f=this.getBorderColor(e);if(b.vid=a+e.id,f){var g=e.bx*this.bw,h=e.by*this.bh,i=(this.lw+this.addlw)/2;b.fillStyle=f,e.isVert()?b.fillRectCenter(g,h,i,this.bh+i):b.fillRectCenter(g,h,this.bw+i,i)}else b.vhide()}},getBorderColor:function(a){return null},getBorderColor_ques:function(a){return a.isBorder()?this.quescolor:null},getBorderColor_qans:function(a){var b=a.error||a.qinfo;return a.isBorder()?1===b?this.errcolor1:-1===b?this.noerrcolor:a.trial?this.trialcolor:this.qanscolor:a.isCmp&&a.isCmp()?this.qcmpcolor:null},getBorderColor_ice:function(a){var b=a.sidecell[0],c=a.sidecell[1];return a.inside&&!b.isnull&&!c.isnull&&b.ice()^c.ice()?this.quescolor:null},drawQuesBorders:function(){this.vinc("border_question","crispEdges",!0),this.getBorderColor=this.getQuesBorderColor,this.drawBorders_common("b_bdques_")},drawQansBorders:function(){this.vinc("border_answer","crispEdges",!0),this.getBorderColor=this.getQansBorderColor,this.drawBorders_common("b_bdans_")},getQuesBorderColor:function(a){return a.ques>=1?this.getBorderColor_ques(a):null},getQansBorderColor:function(a){return a.qans>=1?this.getBorderColor_qans(a):null},drawBorderQsubs:function(){for(var a=this.vinc("border_qsub","crispEdges",!0),b=.15*this.cw,c=this.range.borders,d=0;d<c.length;d++){var e=c[d];if(a.vid="b_qsub1_"+e.id,1===e.qsub){var f=e.bx*this.bw,g=e.by*this.bh;a.fillStyle=e.trial?this.trialcolor:this.pekecolor,e.isHorz()?a.fillRectCenter(f,g,.5,this.bh-b):a.fillRectCenter(f,g,this.bw-b,.5)}else a.vhide()}},drawBoxBorders:function(a){var b=this.vinc("boxborder","crispEdges"),c=this.lm,d=this.cw,e=this.ch;b.strokeStyle=this.bbcolor,b.lineWidth=1;for(var f=this.range.cells,g=0;g<f.length;g++){var h=f[g],i=1===h.qans;if("stostone"===this.pid&&this.board.falling&&(i=!1),b.vid="c_bb_"+h.id,i){var j=(h.bx-1)*this.bw,k=(h.by-1)*this.bh,l=j-.5,m=j+c+.5,n=j+d-c-.5,o=j+d+.5,p=k-.5,q=k+c+.5,r=k+e-c-.5,s=k+e+.5,t=h.adjborder,u=h.by>2,v=h.by<2*this.board.rows-2,w=h.bx>2,x=h.bx<2*this.board.cols-2,y=!u||1===t.top.ques,z=!v||1===t.bottom.ques,A=!w||1===t.left.ques,B=!x||1===t.right.ques,C=!u||!w||1===h.relbd(-2,-1).ques||1===h.relbd(-1,-2).ques,D=!u||!x||1===h.relbd(2,-1).ques||1===h.relbd(1,-2).ques,E=!v||!w||1===h.relbd(-2,1).ques||1===h.relbd(-1,2).ques,F=!v||!x||1===h.relbd(2,1).ques||1===h.relbd(1,2).ques;b.beginPath(),(y||C)&&b.moveTo(m,q),!y&&C&&b.lineTo(m,p),!y&&D&&b.moveTo(n,p),y||D?b.lineTo(n,q):(B||D)&&b.moveTo(n,q),!B&&D&&b.lineTo(o,q),!B&&F&&b.moveTo(o,r),B||F?b.lineTo(n,r):(z||F)&&b.moveTo(n,r),!z&&F&&b.lineTo(n,s),!z&&E&&b.moveTo(m,s),z||E?b.lineTo(m,r):(A||E)&&b.moveTo(m,r),!A&&E&&b.lineTo(l,r),!A&&C&&b.moveTo(l,q),(A||C)&&b.lineTo(m,q),b.stroke()}else b.vhide()}},drawLines:function(){for(var a=this.vinc("line","crispEdges"),b=this.range.borders,c=0;c<b.length;c++){var d=b[c],e=this.getLineColor(d);if(a.vid="b_line_"+d.id,e){var f=d.bx*this.bw,g=d.by*this.bh,h=this.board.borderAsLine===d.isVert(),i=this.lm+this.addlw/2;a.fillStyle=e,h?a.fillRectCenter(f,g,i,this.bh+i):a.fillRectCenter(f,g,this.bw+i,i)}else a.vhide()}this.addlw=0},getLineColor:function(a){if(this.addlw=0,a.isLine()){var b=a.error||a.qinfo,c=this.puzzle,d=c.execConfig("irowake")&&a.path&&a.path.color,e=c.execConfig("dispmove");return a.trial&&c.execConfig("irowake")?this.addlw=-this.lm:1===b&&(this.addlw=1),1===b?this.errlinecolor:-1===b?this.noerrcolor:e?a.trial?this.movetrialcolor:this.movelinecolor:d?a.path.color:a.trial?this.trialcolor:this.linecolor}return null},drawTip:function(){for(var a=this.vinc("cell_linetip","auto"),b=.3*this.cw,c=.05*this.cw,d=this.range.cells,e=0;e<d.length;e++){var f=d[e],g=0,h=null;if(1===f.lcnt&&-1===f.qnum&&!this.puzzle.execConfig("dispmove")){var i=f.adjborder;i.top.isLine()?(g=2,h=i.top):i.bottom.isLine()?(g=1,h=i.bottom):i.left.isLine()?(g=4,h=i.left):i.right.isLine()&&(g=3,h=i.right)}if(a.vid="c_tip_"+f.id,0!==g){a.strokeStyle=this.getLineColor(h)||this.linecolor,a.lineWidth=this.lw+this.addlw,a.beginPath();var j=f.bx*this.bw+1,k=f.by*this.bh+1;1===g?a.setOffsetLinePath(j,k,-b,b,0,-c,b,b,!1):2===g?a.setOffsetLinePath(j,k,-b,-b,0,c,b,-b,!1):3===g?a.setOffsetLinePath(j,k,b,-b,-c,0,b,b,!1):4===g&&a.setOffsetLinePath(j,k,-b,-b,c,0,-b,b,!1),a.stroke()}else a.vhide()}},drawPekes:function(){var a=this.vinc("border_peke","auto",!0),b=.15*this.cw+1;b<4&&(b=4),a.lineWidth=1+this.cw/40|0;for(var c=this.range.borders,d=0;d<c.length;d++){var e=c[d];a.vid="b_peke_"+e.id,2===e.qsub?(a.strokeStyle=e.trial?this.trialcolor:this.pekecolor,a.strokeCross(e.bx*this.bw,e.by*this.bh,b-1)):a.vhide()}},drawBaseMarks:function(){var a=this.vinc("cross_mark","auto",!0);a.fillStyle=this.quescolor;for(var b=this.cw/10,c=this.range.crosses,d=0;d<c.length;d++){var e=c[d];a.vid="x_cm_"+e.id,a.fillCircle(e.bx*this.bw,e.by*this.bh,b/2)}},drawTriangle:function(){for(var a=this.vinc("cell_triangle","crispEdges"),b=this.range.cells,c=0;c<b.length;c++){var d=b[c],e=0!==d.ques?d.ques:d.qans;a.vid="c_tri_"+d.id,e>=2&&e<=5?(a.fillStyle=this.getTriangleColor(d),this.drawTriangle1(d.bx*this.bw,d.by*this.bh,e)):a.vhide()}},getTriangleColor:function(a){return this.quescolor},drawTriangle1:function(a,b,c){var d=this.context,e="reflect"===this.pid?1:.5,f=this.bw+1-e,g=this.bh+1-e;switch(d.beginPath(),c){case 2:d.setOffsetLinePath(a,b,-f,-g,-f,g,f,g,!0);break;case 3:d.setOffsetLinePath(a,b,f,-g,-f,g,f,g,!0);break;case 4:d.setOffsetLinePath(a,b,-f,-g,f,-g,f,g,!0);break;case 5:d.setOffsetLinePath(a,b,-f,-g,f,-g,-f,g,!0)}d.fill()},drawTriangle2:function(a,b,c){var d=this.context,e=this.bw+1,f=this.bh+1;switch(d.beginPath(),c){case 1:d.setOffsetLinePath(a,b,0,0,-e,-f,e,-f,!0);break;case 2:d.setOffsetLinePath(a,b,0,0,-e,f,e,f,!0);break;case 3:d.setOffsetLinePath(a,b,0,0,-e,-f,-e,f,!0);break;case 4:d.setOffsetLinePath(a,b,0,0,e,-f,e,f,!0)}d.fill()},drawMBs:function(){var a=this.vinc("cell_mb","auto",!0);a.lineWidth=1;for(var b=.35*this.cw,c=this.range.cells,d=0;d<c.length;d++){var e,f,g=c[d];g.qsub>0&&(e=g.bx*this.bw,f=g.by*this.bh,a.strokeStyle=g.trial?"rgb(192, 192, 192)":this.mbcolor),a.vid="c_MB1_"+g.id,1===g.qsub?a.strokeCircle(e,f,b):a.vhide(),a.vid="c_MB2_"+g.id,2===g.qsub?a.strokeCross(e,f,b):a.vhide()}},drawBorderAuxDir:function(){var a=this.vinc("border_dirsub","crispEdges"),b=.1*this.cw;a.lineWidth=.1*this.cw;for(var c=this.range.borders,d=0;d<c.length;d++){var e=c[d],f=e.bx*this.bw,g=e.by*this.bh,h=e.qsub-10;if(a.vid="b_daux_"+e.id,h>=1&&h<=8){switch(a.strokeStyle=e.trial?this.trialcolor:"rgb(64,64,64)",a.beginPath(),h){case e.UP:a.setOffsetLinePath(f,g,2*-b,+b,0,-b,2*+b,+b,!1);break;case e.DN:a.setOffsetLinePath(f,g,2*-b,-b,0,+b,2*+b,-b,!1);break;case e.LT:a.setOffsetLinePath(f,g,+b,2*-b,-b,0,+b,2*+b,!1);break;case e.RT:a.setOffsetLinePath(f,g,-b,2*-b,+b,0,-b,2*+b,!1)}a.stroke()}else a.vhide()}},drawCircles:function(){for(var a=this.vinc("cell_circle","auto",!0),b=this.circleratio,c=this.cw*(b[0]+b[1])/2,d=this.cw*b[0],e=this.range.cells,f=0;f<e.length;f++){var g=e[f],h=this.getCircleFillColor(g);a.vid="c_cirb_"+g.id,h?(a.fillStyle=h,a.fillCircle(g.bx*this.bw,g.by*this.bh,d)):a.vhide()}a=this.vinc("cell_circle_stroke","auto",!0),a.lineWidth=Math.max(this.cw*(b[0]-b[1]),1);for(var f=0;f<e.length;f++){var g=e[f],h=this.getCircleStrokeColor(g);a.vid="c_cira_"+g.id,h?(a.strokeStyle=h,a.strokeCircle(g.bx*this.bw,g.by*this.bh,c)):a.vhide()}},getCircleStrokeColor:function(a){return null},getCircleStrokeColor_qnum:function(a){var b=this.puzzle,c=a.error||a.qinfo,d=b.execConfig("dispmove");return-1!==(d?a.base:a).qnum?d&&b.mouse.mouseCell===a?this.movecolor:1===c||4===c?this.errcolor1:this.quescolor:null},getCircleStrokeColor_qnum2:function(a){return 1===a.qnum?1===a.error?this.errcolor1:this.quescolor:null},getCircleFillColor:function(a){return null},getCircleFillColor_qnum:function(a){if(-1!==a.qnum){var b=a.error||a.qinfo;return 1===b||4===b?this.errbcolor1:this.circlebasecolor}return null},getCircleFillColor_qnum2:function(a){return 1===a.qnum?1===a.error?this.errbcolor1:"white":2===a.qnum?1===a.error?this.errcolor1:this.quescolor:null},getCircleFillColor_qcmp:function(a){var b=this.puzzle,c=a.error||a.qinfo;return-1!==(b.execConfig("dispmove")?a.base:a).qnum?1===c||4===c?this.errbcolor1:a.isCmp()?this.qcmpcolor:this.circlebasecolor:null},drawDepartures:function(){var a=this.vinc("cell_depart","auto",!0);a.fillStyle=this.movelinecolor;for(var b=.15*this.cw,c=this.puzzle.execConfig("dispmove"),d=this.range.cells,e=0;e<d.length;e++){var f=d[e];if(a.vid="c_dcir_"+f.id,c&&f.isDeparture()){var g=f.bx*this.bw,h=f.by*this.bh;a.fillCircle(g,h,b)}else a.vhide()}},drawLineParts:function(){var a=this.vinc("cell_lineparts","crispEdges");a.fillStyle=this.quescolor;for(var b=this.lm,c=this.bw,d=this.bh,e=this.range.cells,f=0;f<e.length;f++){var g=e[f],h=g.ques;if(a.vid="c_lp_"+g.id,h>=11&&h<=17){var i=g.bx*this.bw,j=g.by*this.bh,k=i-c-.5,l=i-b,m=i+b,n=i+c+.5,o=j-d-.5,p=j-b,q=j+b,r=j+d+.5,s={11:15,12:3,13:12,14:9,15:5,16:6,17:10}[h];a.beginPath(),a.moveTo(l,p),1&s&&(a.lineTo(l,o),a.lineTo(m,o)),a.lineTo(m,p),8&s&&(a.lineTo(n,p),a.lineTo(n,q)),a.lineTo(m,q),2&s&&(a.lineTo(m,r),a.lineTo(l,r)),a.lineTo(l,q),4&s&&(a.lineTo(k,q),a.lineTo(k,p)),a.closePath(),a.fill()}else a.vhide()}},drawTateyokos:function(){for(var a=this.vinc("cell_tateyoko","crispEdges"),b=Math.max(this.cw/6,3)/2,c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=e.bx*this.bw,g=e.by*this.bh,h=e.qans;a.vid="c_bar1_"+e.id,11===h||12===h?(a.fillStyle=this.getBarColor(e,!0),a.fillRectCenter(f,g,b+this.addlw/2,this.bh)):a.vhide(),a.vid="c_bar2_"+e.id,11===h||13===h?(a.fillStyle=this.getBarColor(e,!1),a.fillRectCenter(f,g,this.bw,b+this.addlw/2)):a.vhide()}this.addlw=0},getBarColor:function(a,b){var c=a.error,d=1===c||4===c||5===c&&b||6===c&&!b,e="";return this.addlw=0,d?(e=this.errlinecolor,this.addlw=1):e=0!==c?this.noerrcolor:a.trial?this.trialcolor:this.linecolor,e},drawQues51:function(){this.drawExCellGrid(),this.drawTargetTriangle(),this.drawSlash51Cells(),this.drawSlash51ExCells()},drawSlash51Cells:function(){var a=this.vinc("cell_ques51","crispEdges",!0);a.strokeStyle=this.quescolor,a.lineWidth=1;for(var b=this.range.cells,c=0;c<b.length;c++){var d=b[c];if(a.vid="c_slash51_"+d.id,51===d.ques){var e=d.bx*this.bw,f=d.by*this.bh;a.strokeLine(e-this.bw,f-this.bh,e+this.bw,f+this.bh)}else a.vhide();if(a.vid="c_slash51b_"+d.id,51===d.ques&&4===d.dirs51){var e=d.bx*this.bw,f=d.by*this.bh;a.strokeLine(e-this.bw,f+this.bh,e+this.bw,f-this.bh)}else a.vhide()}},drawSlash51ExCells:function(){var a=this.vinc("excell_ques51","crispEdges",!0);a.strokeStyle=this.quescolor,a.lineWidth=1;for(var b=this.range.excells,c=0;c<b.length;c++){var d=b[c],e=d.bx*this.bw,f=d.by*this.bh;a.vid="ex_slash51_"+d.id,a.strokeLine(e-this.bw,f-this.bh,e+this.bw,f+this.bh)}},drawExCellGrid:function(){var a=this.vinc("grid_excell","crispEdges",!0);a.fillStyle=this.quescolor;for(var b=this.range.excells,c=0;c<b.length;c++){var d=b[c],e=d.bx*this.bw,f=d.by*this.bh;a.vid="ex_bdx_"+d.id,-1===d.by&&d.bx<this.board.maxbx?a.fillRectCenter(e+this.bw,f,.5,this.bh):a.vhide(),a.vid="ex_bdy_"+d.id,-1===d.bx&&d.by<this.board.maxby?a.fillRectCenter(e,f+this.bh,this.bw,.5):a.vhide()}},drawQuesNumbersOn51:function(){this.vinc("cell_number51","auto");for(var a=this.range,b=1|a.x1;b<=a.x2;b+=2)for(var c=1|a.y1;c<=a.y2;c+=2){var d=this.board.getobj(b,c);d.isnull||(4===d.dirs51?this.drawQuesNumbersOn51_2(d):this.drawQuesNumbersOn51_1(d))}},drawQuesNumbersOn51_1:function(a){var b,c,d=this.context,e=a.bx*this.bw,f=a.by*this.bh,g={ratio:.45};d.fillStyle=1===a.error||1===a.qinfo?this.errcolor1:this.quescolor,c=a.relcell(2,0),b=51===a.ques?a.qnum:-1,d.vid=[a.group,a.id,"text_ques51_rt"].join("_"),b>=0&&!c.isnull&&51!==c.ques?(g.position=this.TOPRIGHT,this.disptext(""+b,e,f,g)):d.vhide(),c=a.relcell(0,2),b=51===a.ques?a.qnum2:-1,d.vid=[a.group,a.id,"text_ques51_dn"].join("_"),b>=0&&!c.isnull&&51!==c.ques?(g.position=this.BOTTOMLEFT,this.disptext(""+b,e,f,g)):d.vhide()},drawQuesNumbersOn51_2:function(a){var b,c=this.context,d=a.bx*this.bw,e=a.by*this.bh,f={ratio:.4,width:[.35,.23,.15]};c.fillStyle=1===a.error||1===a.qinfo?this.errcolor1:this.quescolor;for(var g=1;g<=4;g++)b=a.getQnumDir(g),c.vid=[a.group,a.id,"text_ques51",g].join("_"),b>=0?(f.position=g+5,this.disptext(""+b,d,e,f)):c.vhide()},drawTarget:function(){this.drawCursor(!0,this.puzzle.editmode)},drawCursor:function(a,b){this.drawRawCursor("target_cursor","",this.puzzle.cursor,a,!1!==b&&this.puzzle.getConfig("cursor"),this.puzzle.editmode?this.targetColorEdit:this.targetColorPlay)},drawTrialStarts:function(){for(var a=this.puzzle.opemgr.savedStarts,b=0;b<a.length;b++){var c=a[b];this.drawRawCursor("trial_cursor","trial_"+b,c,!1,!c.isnull&&this.puzzle.getConfig("trialmarker"),this.targetColorTrial)}},drawRawCursor:function(a,b,c,d,e,f){var g,h,i=this.vinc(a,"crispEdges"),j=c.bx*this.bw,k=c.by*this.bh;!1!==d?(g=0|Math.max(this.cw/16,2),h=this.bw-.5):(g=0|Math.max(this.cw/24,1),h=.56*this.bw),e=!1!==e&&!this.outputImage,i.fillStyle=f,i.vid=b+"ti1_",e?i.fillRect(j-h,k-h,2*h,g):i.vhide(),i.vid=b+"ti2_",e?i.fillRect(j-h,k-h,g,2*h):i.vhide(),i.vid=b+"ti3_",e?i.fillRect(j-h,k+h-g,2*h,g):i.vhide(),i.vid=b+"ti4_",e?i.fillRect(j+h-g,k-h,g,2*h):i.vhide()},drawTargetSubNumber:function(){var a=this.vinc("target_subnum","crispEdges"),b=this.range,c=this.puzzle.cursor;if(!(c.bx<b.x1||b.x2<c.bx||c.by<b.y1||b.y2<c.by)){var d=c.targetdir;if(a.vid="target_subnum",a.fillStyle=this.ttcolor,this.puzzle.playmode&&0!==d){var e=this.bw,f=this.bh,g=c.bx*e+.5,h=c.by*f+.5,i=.8*e,j=.8*f;5===d?a.fillRect(g-e,h-f,i,j):4===d?a.fillRect(g+e-i,h-f,i,j):2===d?a.fillRect(g-e,h+f-j,i,j):3===d&&a.fillRect(g+e-i,h+f-j,i,j)}else a.vhide()}},drawTargetTriangle:function(){var a=this.vinc("target_triangle","auto"),b=this.range,c=this.puzzle.cursor;if(!(c.bx<b.x1||b.x2<c.bx||c.by<b.y1||b.y2<c.by)){var d=c.detectTarget();a.vid="target_triangle",a.fillStyle=this.ttcolor,this.puzzle.editmode&&0!==d?4===c.targetdirs?this.drawTriangle2(c.bx*this.bw,c.by*this.bh,d):this.drawTriangle1(c.bx*this.bw,c.by*this.bh,4===d?4:2):a.vhide()}},drawStartGoal:function(){var a=this.vinc("cell_sg","auto"),b=this.board,c=this.range;a.vid="text_stpos";var d=b.startpos.getc();d.bx>=c.x1&&c.x2>=d.bx&&d.by>=c.y1&&c.y2>=d.by&&(d.isnull?a.vhide():(a.fillStyle=this.puzzle.mouse.draggingSG&&10===this.puzzle.mouse.inputData?"red":1===d.qans?this.fontShadecolor:this.quescolor,this.disptext("S",d.bx*this.bw,d.by*this.bh))),a.vid="text_glpos",d=b.goalpos.getc(),d.bx>=c.x1&&c.x2>=d.bx&&d.by>=c.y1&&c.y2>=d.by&&(d.isnull?a.vhide():(a.fillStyle=this.puzzle.mouse.draggingSG&&11===this.puzzle.mouse.inputData?"red":1===d.qans?this.fontShadecolor:this.quescolor,this.disptext("G",d.bx*this.bw,d.by*this.bh)))},getDotFillColor:function(a){return 1===a.getDot()?"white":2===a.getDot()?a.iserror()?this.errcolor1:this.quescolor:null},getDotOutlineColor:function(a){return 1===a.getDot()?a.iserror()?this.errcolor1:this.quescolor:null},getDotRadius:function(a){return.18},drawDots:function(){var a=this.vinc("dot","auto",!0);a.lineWidth=Math.max(.04*this.cw,1);for(var b=this.range,c=this.board.dotinside(b.x1,b.y1,b.x2,b.y2),d=0;d<c.length;d++){var e=c[d],f=e.bx,g=e.by;a.vid="s_dot_"+e.id;var h=this.getDotOutlineColor(e),i=this.getDotFillColor(e);i||h?(a.strokeStyle=h,a.fillStyle=i,a.shapeCircle(f*this.bw,g*this.bh,this.cw*this.getDotRadius(e))):a.vhide()}},drawDashedCenterLines:function(){var a=this.vinc("centerline","crispEdges",!0),b=this.board,c=this.range.x1,d=this.range.y1,e=this.range.x2,f=this.range.y2;c<b.minbx+1&&(c=b.minbx+1),e>b.maxbx-1&&(e=b.maxbx-1),d<b.minby+1&&(d=b.minby+1),f>b.maxby-1&&(f=b.maxby-1),c-=1&~c,d-=1&~d,e+=1&~e,f+=1&~f;var g=this.getDashArray();a.lineWidth=1,a.strokeStyle=this.gridcolor;for(var h=c;h<=e;h+=2){var i=h*this.bw,j=d*this.bh,k=f*this.bh;a.vid="cliney_"+h,a.strokeDashedLine(i,j,i,k,g)}for(var h=d;h<=f;h+=2){var l=h*this.bh,m=c*this.bw,n=e*this.bw;a.vid="clinex_"+h,a.strokeDashedLine(m,l,n,l,g)}},getDashArray:function(){var a=Math.max(Math.round(this.cw/10),4),b=this.cw/a,c=5/8*b,d=b-c,e=[];e.push(c/2,d);for(var f=0;f<a-1;f++)e.push(c,d);return e.push(c/2),e.push(0),e},drawGrid:function(a,b){var c=this.vinc("grid","crispEdges",!0),d=this.board,e=Math.max(d.minbx,0),f=Math.min(d.maxbx,2*d.cols),g=Math.max(d.minby,0),h=Math.min(d.maxby,2*d.rows),i=this.range.x1,j=this.range.y1,k=this.range.x2,l=this.range.y2;if(i<e&&(i=e),k>f&&(k=f),j<g&&(j=g),l>h&&(l=h),i-=1&i,j-=1&j,!(i>=k||j>=l)){var m=2!==d.hasborder&&!1!==a?2:0,n=this.bw,o=this.bh,p=Math.max(i,e+m),q=Math.min(k,f-m),r=Math.max(j,g+m),s=Math.min(l,h-m);c.lineWidth=this.gw,c.strokeStyle=this.gridcolor;for(var t=p;t<=q;t+=2)if(c.vid="bdy_"+t,!1!==b){var u=t*n,v=j*o,w=l*o;c.strokeLine(u,v,u,w)}else c.vhide();for(var t=r;t<=s;t+=2)if(c.vid="bdx_"+t,!1!==b){var x=t*o,y=i*n,z=k*n;c.strokeLine(y,x,z,x)}else c.vhide()}},drawDashedGrid:function(a){var b=this.vinc("grid","crispEdges",!0),c=this.board,d=Math.max(c.minbx,0),e=Math.min(c.maxbx,2*c.cols),f=Math.max(c.minby,0),g=Math.min(c.maxby,2*c.rows),h=this.range.x1,i=this.range.y1,j=this.range.x2,k=this.range.y2;h<d&&(h=d),j>e&&(j=e),i<f&&(i=f),k>g&&(k=g),h-=1&h,i-=1&i,j+=1&j,k+=1&k;var l=this.getDashArray(),m=!1!==a?2:0,n=this.bw,o=this.bh,p=Math.max(h,d+m),q=Math.min(j,e-m),r=Math.max(i,f+m),s=Math.min(k,g-m);b.lineWidth=this.gw,b.strokeStyle=this.gridcolor;for(var t=p;t<=q;t+=2){var u=t*n,v=i*o,w=k*o;b.vid="bdy_"+t,b.strokeDashedLine(u,v,u,w,l)}for(var t=r;t<=s;t+=2){var x=t*o,y=h*n,z=j*n;b.vid="bdx_"+t,b.strokeDashedLine(y,x,z,x,l)}},drawChassis:function(a){var b=this.vinc("chassis","crispEdges",!0),c=this.board,d=a?-.5*c.minbx*this.cw:0,e=a?-.5*c.minby*this.ch:0,f=c.cols*this.cw,g=c.rows*this.ch,h=this.lw,i=this.lm;"bosanowa"===this.pid&&(h=1,i=.5),b.fillStyle=this.quescolor,b.vid="chs1_",b.fillRect(-i,-e-i,h,g+e+h),b.vid="chs2_",b.fillRect(f-i,-e-i,h,g+e+h),b.vid="chs3_",b.fillRect(-d-i,-i,f+d+h,h),b.vid="chs4_",b.fillRect(-d-i,g-i,f+d+h,h)},drawChassis_ex1:function(a){var b=this.vinc("chassis_ex1","crispEdges",!0),c=this.board,d=this.range.x1,e=this.range.y1,f=this.range.x2,g=this.range.y2;d<=0&&(d=c.minbx),f>c.maxbx&&(f=c.maxbx),e<=0&&(e=c.minby),g>c.maxby&&(g=c.maxby);var h=this.lw,i=this.lm,j=c.cols*this.cw,k=c.rows*this.ch;if(b.fillStyle=this.quescolor,b.vid="chsex1_1_",b.fillRect(-this.cw-i,-this.ch-i,h,k+this.ch+h),b.vid="chsex1_2_",b.fillRect(j-i,-this.ch-i,h,k+this.ch+h),b.vid="chsex1_3_",b.fillRect(-this.cw-i,-this.ch-i,j+this.cw+h,h),b.vid="chsex1_4_",b.fillRect(-this.cw-i,k-i,j+this.cw+h,h),a)b.vid="chs1_",b.fillRect(-i,-i,h,k+h-1),b.vid="chs2_",b.fillRect(-i,-i,j+h-1,h);else{b.vid="chs1_",b.fillRect(-.5,-.5,1,k),b.vid="chs2_",b.fillRect(-.5,-.5,j,1);for(var l=this.range.cells,m=0;m<l.length;m++){var n=l[m],o=(n.bx-1)*this.bw,p=(n.by-1)*this.bh;1===n.bx&&(b.vid="chs1_sub_"+n.by,51!==n.ques?b.fillRect(-i,p-i,h,this.ch+h):b.vhide()),1===n.by&&(b.vid="chs2_sub_"+n.bx,51!==n.ques?b.fillRect(o-i,-i,this.cw+h,h):b.vhide())}}}}}),a.classmgr.makeCommon({KeyEvent:{key_inputcross:function(a){var b=this.cursor.getx(),c=b.getmaxnum(),d=-1;if("0"<=a&&a<="9"){var e=+a,f=b.qnum;if((f<=0||10*f+e>c)&&(f=0),(d=10*f+e)>c)return}else if("-"===a)d=-2!==b.qnum?-2:-1;else{if(" "!==a&&"BS"!==a)return;d=-1}b.setQnum(d),b.draw()},key_inputqnum:function(a){var b=this.cursor.getc();b.enableSubNumberArray&&this.puzzle.playmode&&"shift"===a&&b.noNum()?this.cursor.chtarget():this.key_inputqnum_main(b,a)},key_inputqnum_main:function(a,b){var c=a,d=this.puzzle,e=d.board;if(d.editmode&&e.roommgr.hastop)c=a=a.room.top;else if(d.execConfig("dispmove"))if(a.isDestination())a=a.base;else if(a.lcnt>0)return;if(a.enableSubNumberArray&&this.cursor.targetdir>=2){var f=[-1,-1,2,3,1,0][this.cursor.targetdir];if(-1===f)return;var g=this.getNewNumber(a,b,a.snum[f]);if(null===g)return;a.setSnum(f,g)}else{var g=this.getNewNumber(a,b,a.getNum());if(null===g)return;a.setNum(g),a.numberWithMB&&a.enableSubNumberArray&&" "===b&&a.clrSnum()}d.execConfig("dispmove")&&a.noNum()&&a.eraseMovedLines(),c.draw(),this.prev=a,this.cancelDefault=!0},getNewNumber:function(a,b,c){var d=a.getmaxnum(),e=a.getminnum(),f=null;if("0"<=b&&b<="9"&&!a.numberAsLetter){var g=+b;(c<=0||10*c+g>d||this.prev!==a)&&(c=0),f=10*c+g,(f>d||e>0&&0===f)&&(f=null)}else if("a"<=b&&b<="z"&&1===b.length&&a.numberAsLetter){if(b.length>1&&"BS"!==b)return null;var g=parseInt(b,36)-10;f=c>0&&(c-1)%26===g?c<=26?c+26:-1:g+1,(f>d||e>0&&0===f)&&(f=null)}else f="BS"===b?c<10||a.numberAsLetter?-1:c/10|0:"-"===b?this.puzzle.editmode&&!a.disInputHatena?-2:-1:" "===b?-1:"s1"===b?-2:"s2"===b?-3:null;return f},key_inputarrow:function(a){return this.key_inputdirec_common(a,!1)},key_inputdirec:function(a){return this.key_inputdirec_common(a,!0)},key_inputdirec_common:function(a,b){var c=this.cursor.getc();if(b&&-1===c.qnum)return!1;var d=c.NDIR;switch(a){case"shift+up":d=c.UP;break;case"shift+down":d=c.DN;break;case"shift+left":d=c.LT;break;case"shift+right":d=c.RT}return d!==c.NDIR&&(c.setQdir(c.qdir!==d?d:c.NDIR),b||c.setQnum(-1),this.cursor.draw(),!0)},inputnumber51:function(a,b){var c=this.cursor;if("shift"===a)return void c.chtarget();var d=c.getobj(),e=c.detectTarget(d);if((0===e||"cell"===d.group&&d.is51cell())&&"q"===a&&!d.isnull)return d.is51cell()?d.remove51cell():d.set51cell(),void c.drawaround();if(0!==e){var f=this.klass.Cell.prototype[e===d.RT?"qnum":"qnum2"],g=d.getmaxnum(),h=f;if("0"<=a&&a<="9"){var i=+a,j=this.getnum51(d,e);if((j<=0||10*j+i>g||this.prev!==d)&&(j=0),(h=10*j+i)>g)return}else{if("-"!==a&&" "!==a)return;h=f}this.setnum51(d,e,h),this.prev=d,c.draw()}},setnum51:function(a,b,c){a.setQnumDir(b,c)},getnum51:function(a,b){return a.getQnumDir(b)}}}),a.classmgr.makeCommon({MouseEvent:{inputShade:function(){this.inputcell()},inputcell:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){null===this.inputData&&this.decIC(a),this.mouseCell=a,this.initFirstCell(a);if((1!==this.inputData||a.allowShade())&&(2!==this.inputData||a.allowUnshade())){if(this.RBShadeCell&&1===this.inputData){var b=this.firstCell;if((2&b.bx^2&b.by)!=(2&a.bx^2&a.by))return}this.RBShadeCell&&1!==this.inputData&&1!==this.firstState&&1===a.qans&&"right"===this.btn||(a.setQans(1===this.inputData?1:0),a.setQsub(2===this.inputData?1:0),a.draw())}}},initFirstCell:function(a){this.firstCell.isnull&&(this.firstCell=a,this.firstState=a.qans)},decIC:function(a){"shade"===this.inputMode?this.inputData=1!==a.qans?1:0:"unshade"===this.inputMode?this.inputData=1!==a.qsub?2:0:1===this.puzzle.getConfig("use")?"left"===this.btn?this.inputData=1!==a.qans?1:0:"right"===this.btn&&(this.inputData=1!==a.qsub?2:0):2===this.puzzle.getConfig("use")&&(a.numberRemainsUnshaded&&-1!==a.qnum?this.inputData=1!==a.qsub?2:0:"left"===this.btn?1===a.qans?this.inputData=2:1===a.qsub?this.inputData=0:this.inputData=1:"right"===this.btn&&(1===a.qans?this.inputData=0:1===a.qsub?this.inputData=1:this.inputData=2))},inputclean_cell:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){this.mouseCell=a;var b=new this.klass.CellList([a]);this.puzzle.playmode?b.ansclear():b.allclear(),a.draw()}},inputqnum:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(this.cursor.modesnum&&this.puzzle.playmode&&!this.cursor.checksnum(this.inputPoint)&&a.noNum()?this.setcursorsnum(a):a!==this.cursor.getc()?this.setcursor(a):this.inputqnum_main(a),this.mouseCell=a)},inputqnum_main:function(a){var b=a,c=this.puzzle;if(!c.playmode||a.qnum===c.klass.Cell.prototype.qnum||c.klass.Cell.prototype.supportQnumAnum){if(c.editmode&&c.board.roommgr.hastop)b=a=a.room.top;else if(c.execConfig("dispmove"))if(a.isDestination())a=a.base;else if(a.lcnt>0)return;if(a.enableSubNumberArray&&c.playmode&&this.cursor.targetdir>=2){var d=[-1,-1,2,3,1,0][this.cursor.targetdir];if(-1===d)return;a.setSnum(d,this.getNewNumber(a,a.snum[d]))}else if(c.editmode&&51===a.ques){var e=c.cursor.detectTarget(a);c.key.setnum51(a,e,this.getNewNumber(a,c.key.getnum51(a,e)))}else a.setNum(this.getNewNumber(a,a.getNum()));c.execConfig("dispmove")&&a.noNum()&&a.eraseMovedLines(),b.draw()}},getNewNumber:function(a,b){var c=this.puzzle,d=c.editmode&&!a.disInputHatena,e=a.getmaxnum(),f=a.getminnum(),g=-1,h=a.qsub,i=0;return c.editmode?i=-1:this.cursor.targetdir>=2?(i=0,h=0):a.numberWithMB?(i=2,h=a.qsub):"roma"===c.pid||"yinyang"===c.pid?i=0:(a.numberAsObject||"hebi"===c.pid)&&(i=1),"left"===this.btn?g=b>=e?i>=1?-2:-1:1===h?i>=2?-3:-1:2===h?-1:-1===b?d?-2:f:b<f?f:b+1:"right"===this.btn&&(g=1===h?e:2===h?-2:-1===b?1===i?-2:2===i?-3:e:b>e?e:b<=f?d?-2:-1:-2===b?-1:b-1),g},inputFixedNumber:function(a){var b=this.getcell();if(!b.isnull&&b!==this.mouseCell){var c=b.getNum();-1===c&&b.qsub>0&&(c=-1-b.qsub),null===this.inputData&&(this.inputData=c===a?-1:a),c===a&&-1!==this.inputData||(b.setNum(this.inputData),b.draw()),this.mouseCell=b}},inputQues:function(a){var b=this.getcell();b.isnull||(b!==this.cursor.getc()&&"auto"===this.inputMode?this.setcursor(b):this.inputQues_main(a,b))},inputQues_main:function(a,b){var c=b.ques,d=a.length;if(("quesmark"===this.inputMode||"auto"===this.inputMode)==("left"===this.btn)){for(var e=0;e<=d-1;e++)if(c===a[e]){b.setQues(a[e<d-1?e+1:0]);break}}else for(var e=d-1;e>=0;e--)if(c===a[e]){b.setQues(a[e>0?e-1:d-1]);break}b.draw()},
inputMB:function(){var a=this.getcell();a.isnull||(a.setQsub(("left"===this.btn?[1,2,0]:[2,0,1])[a.qsub]),a.draw())},inputFixedQsub:function(a){var b=this.getcell();b.isnull||b.is51cell()||b===this.mouseCell||(null===this.inputData&&(this.inputData=b.qsub!==a?a:0),b.setQsub(this.inputData),b.draw(),this.mouseCell=b)},inputBGcolor:function(a){var b=this.getcell();b.isnull||b.is51cell()||b===this.mouseCell||(null!==this.inputData||("bgcolor1"===this.inputMode?this.inputMode=1!==b.qsub?11:10:"bgcolor2"===this.inputMode?this.inputMode=2!==b.qsub?12:10:a||"left"===this.btn?0===b.qsub?this.inputData=11:1===b.qsub?this.inputData=12:this.inputData=10:0===b.qsub?this.inputData=12:1===b.qsub?this.inputData=10:this.inputData=11),b.setQsub(this.inputData-10),b.draw(),this.mouseCell=b)},inputdirec:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.prevPos.getc();if(!b.isnull&&-1!==b.qnum){var c=this.prevPos.getdir(a,2);c!==b.NDIR&&(b.setQdir(b.qdir!==c?c:0),b.draw())}this.prevPos=a}},inputarrow_cell:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)||1!==this.inputData){var b=a.NDIR,c=this.prevPos.getc();if(!c.isnull){var b=this.prevPos.getdir(a,2);if(b!==a.NDIR)return this.inputarrow_cell_main(c,b),c.draw(),void this.mousereset()}this.prevPos=a}},inputarrow_cell_main:function(a,b){a.numberAsObject&&a.setNum(b)},inputtile:function(){var a=this.getcell();if(!a.isnull&&!a.is51cell()&&a!==this.mouseCell){null===this.inputData&&this.decIC(a),this.mouseCell=a;for(var b=a.room.clist,c=0;c<b.length;c++){var d=b[c];1!==this.inputData&&3===d.qsub||((1===this.inputData?d.setShade:d.clrShade).call(d),d.setQsub(2===this.inputData?1:0))}b.draw()}},inputIcebarn:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(null===this.inputData&&(this.inputData=a.ice()?0:6),a.setQues(this.inputData),a.drawaround(),this.mouseCell=a)},input51:function(){var a=this.getcell_excell();if(!a.isnull){var b=a.group;"excell"===b||"cell"===b&&a!==this.cursor.getc()?this.setcursor(a):"cell"===b&&this.input51_main(a)}},input51_main:function(a){if("right"===this.btn)a.remove51cell();else if("left"===this.btn)if(a.is51cell()){var b=this.inputPoint.bx-a.bx,c=this.inputPoint.by-a.by;this.cursor.chtarget(!0,b,c)}else a.set51cell();a.drawaround()},input51_fixed:function(){var a=this.getcell();a.isnull||a===this.mouseCell||("clear"===this.inputMode?(a.remove51cell(),this.inputData=0):"cell51"!==this.inputMode||a.is51cell()||(a.set51cell(),this.inputData=51),a.drawaround(),this.mouseCell=a)},inputqnum_cell51:function(){var a=this.getcell_excell();a.isnull||this.mouseCell===a&&!this.mouseend||(!this.mousestart||a===this.cursor.getobj()&&51===a.ques?this.mousestart&&this.cursor.getNumOfTarget(a)<2||this.mouseend?(this.inputqnum_main(a),this.mousereset()):(this.mouseCell=a,this.inputselect_cell51(a)):(this.setcursor(a),this.mousereset()))},inputselect_cell51:function(a){if(this.mousestart)this.prevPos=this.getpos(0);else if(this.mousemove){var b=this.prevPos.getdir(this.getpos(0),2);b!==a.RT&&b!==a.DN||b===this.cursor.targetdir||(this.cursor.targetdir=b,this.cursor.draw()),b!==a.NDIR&&this.mousereset()}},inputqnum_cross:function(){var a=this.getcross();a.isnull||a===this.mouseCell||(a!==this.cursor.getx()?this.setcursor(a):this.inputqnum_main(a),this.mouseCell=a)},inputcross_main:function(a){"left"===this.btn?a.setQnum(4!==a.qnum?a.qnum+1:-2):"right"===this.btn&&a.setQnum(-2!==a.qnum?a.qnum-1:4),a.draw()},inputcrossMark:function(){var a=this.getpos(.24);if(a.oncross()){var b=this.board,c=2===b.hascross?0:2;if(!(a.bx<b.minbx+c||a.bx>b.maxbx-c||a.by<b.minby+c||a.by>b.maxby-c)){var d=a.getx();d.isnull||(this.puzzle.opemgr.disCombine=!0,d.setQnum(1===d.qnum?-1:1),this.puzzle.opemgr.disCombine=!1,d.draw())}}},inputclean_cross:function(){var a=this.getcross();if(!a.isnull&&a!==this.mouseCell){this.mouseCell=a;var b=new this.klass.CrossList([a]);this.puzzle.playmode?b.ansclear():b.allclear(),a.draw()}},inputborder:function(){var a=this.getpos(.35);if(!this.prevPos.equals(a)){var b=this.prevPos.getborderobj(a);b.isnull||(null===this.inputData&&(this.inputData=b.isBorder()?0:1),1===this.inputData?b.setBorder():0===this.inputData&&b.removeBorder(),b.draw()),this.prevPos=a}},inputQsubLine:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.prevPos.getnb(a);b.isnull||(null===this.inputData&&(this.inputData=0===b.qsub?1:0),1===this.inputData?b.setQsub(1):0===this.inputData&&b.setQsub(0),b.draw()),this.prevPos=a}},inputLine:function(){if(this.puzzle.execConfig("dispmove"))return void this.inputMoveLine();var a=this.getcell();this.initFirstCell(a);var b,c;if(this.board.borderAsLine){if(b=this.getpos(.35),this.prevPos.equals(b))return;c=this.prevPos.getborderobj(b)}else{if(b=this.getpos(0),this.prevPos.equals(b))return;c=this.prevPos.getnb(b)}c.isnull||(null===this.inputData&&(this.inputData=c.isLine()?0:1),1===this.inputData?c.setLine():0===this.inputData&&c.removeLine(),c.draw()),this.prevPos=b},inputMoveLine:function(){for(var a=!0,b=this.getcell();a;){a=!1;var c=this.mouseCell&&!this.mousestart?this.mouseCell.getOrthogonalCell(b):b;if(c.isnull)return;var d=this.mouseCell,e=c.getaddr();if(this.mousestart&&c.isDestination())this.mouseCell=c,this.prevPos=e,c.draw();else if(this.mousemove&&!d.isnull&&!c.isDestination()){var f=this.prevPos.getnb(e);if(!f.isnull&&(!f.isLine()&&0===c.lcnt||f.isLine()&&1===d.lcnt)){var g=f.isLine();g?f.removeLine():f.setLine(),this.puzzle.opemgr.changeflag=!0,g!==f.isLine()&&(this.mouseCell=c,this.prevPos=e,f.draw(),a=!0)}}}},inputpeke:function(){var a=this.getpos(.22);if(!this.prevPos.equals(a)){var b=a.getb();b.isnull||(null===this.inputData&&(this.inputData=2!==b.qsub?2:3),2===this.inputData&&b.isLine()&&this.puzzle.execConfig("dispmove")||(2===this.inputData?b.setPeke():3===this.inputData&&b.removeLineAndQsub()),b.draw()),this.prevPos=a}},inputpeke_ifborder:function(){var a=this.getpos(.22).getb();return"border"===a.group&&!a.isnull&&(this.inputpeke(),!0)},inputdiraux_mousedown:function(){var a=this.getpos(.22),b=a.getb();b.isnull||(this.inputData=b.isnull||2!==b.qsub?2:3,this.inputpeke())},inputdiraux_mousemove:function(){var a=this.getpos(0);if(!a.getc().isnull){var b=this.prevPos.getnb(a);if(!b.isnull){var c=null,d=this.prevPos.getdir(a,2);null===this.inputData&&(this.inputData=b.qsub!==10+d?11:0),11===this.inputData?c=10+d:0===this.inputData&&b.qsub===10+d&&(c=0),null!==c&&(b.setQsub(c),b.draw())}this.prevPos=a}},clickdiraux:function(){var a=this.getpos(.22);if(!this.prevPos.equals(a)){var b=a.getb();if(!b.isnull){var c={0:2,2:0},d=b.qsub;c=b.isvert?"left"===this.btn?{0:2,2:13,13:14,14:0}:{0:14,14:13,13:2,2:0}:"left"===this.btn?{0:2,2:11,11:12,12:0}:{0:12,12:11,11:2,2:0},d=c[d]||0,"diraux"===this.inputMode&&2===d&&(d=c[d]||0),b.setQsub(d),b.draw()}}},inputTateyoko:function(){if(this.mouseend&&this.notInputted()&&this.clickTateyoko)return void this.clickTateyoko();var a=this.getcell();if(!a.isnull){if("amibo"!==this.pid&&1===a.ques);else if("amibo"===this.pid&&a.isNum());else if(this.mouseCell!==a)this.firstPoint.set(this.inputPoint);else if(null!==this.firstPoint.bx){var b=null,c=this.inputPoint.bx-this.firstPoint.bx,d=this.inputPoint.by-this.firstPoint.by;if(d<=-.5||.5<=d?b=1:(c<=-.5||.5<=c)&&(b=2),null!==b){var e="amibo"===this.pid||"tatamibari"===this.pid,f=0;f=this.puzzle.playmode?{0:0,11:3,12:1,13:2}[a.qans]:{"-1":0,1:3,2:1,3:2}[a.qnum],(null===this.inputData?f&b:this.inputData<=0)&&(b=e?-b:0),e?b>0?f|=b:f&=~-b:f=b,this.puzzle.playmode?a.setQans([0,12,13,11][f]):a.setQnum([-1,2,3,1][f]),a.draw(),this.inputData=+(b>0),this.firstPoint.reset(),"tatamibari"===this.pid&&this.mousereset()}}this.mouseCell=a}},dispInfoBlk:function(){var a=this.getcell();this.mousereset(),!a.isnull&&a.isShade()&&(this.RBShadeCell?this.dispInfoBlk8(a):a.sblk.clist.setinfo(1),this.board.hasinfo=!0,this.puzzle.redraw())},dispInfoUblk:function(){var a=this.getcell();this.mousereset(),!a.isnull&&a.isUnshade()&&(a.ublk.clist.setinfo(1),this.board.hasinfo=!0,this.puzzle.redraw())},dispInfoBlk8:function(a){for(var b=[a];b.length>0;){var c=b.pop();if(0===c.qinfo){c.setinfo(1);for(var d=c.bx,e=c.by,f=this.board.cellinside(d-2,e-2,d+2,e+2),g=0;g<f.length;g++){var h=f[g];0===h.qinfo&&h.isShade()&&b.push(h)}}}},dispInfoLine:function(){var a=this.board,b=this.getborder(.15);if(this.mousereset(),!b.isnull){if(!b.isLine()){var c=a.borderAsLine?this.getcross():this.getcell();if(c.isnull||a.linegraph.isLineCross&&(3===c.lcnt||4===c.lcnt))return;var d=c.adjborder;if(d.left.isLine())b=d.left;else if(d.right.isLine())b=d.right;else if(d.top.isLine())b=d.top;else{if(!d.bottom.isLine())return;b=d.bottom}}b.isnull||(a.border.setinfo(-1),b.path.setedgeinfo(1),a.hasinfo=!0,this.puzzle.redraw())}}}}),a.classmgr.makeCommon({AnsCheck:{checkAllCell:function(a,b){for(var c=0;c<this.board.cell.length;c++){var d=this.board.cell[c];if(7!==d.ques&&a(d)){if(this.failcode.add(b),this.checkOnly)break;d.seterr(1)}}},checkNoNumCell:function(){this.checkAllCell(function(a){return 0===a.ques&&a.noNum()},"ceNoNum")},checkIceLines:function(){this.checkAllCell(function(a){return a.ice()&&a.isLineCurve()},"lnCurveOnIce")},checkNotCrossOnMark:function(){this.checkAllCell(function(a){return 4!==a.lcnt&&11===a.ques},"lnNotCrossMk")},checkLineOnShadeCell:function(){this.checkAllCell(function(a){return(1===a.ques||1===a.qans)&&a.lcnt>0},"lnOnShade")},checkNoLineObject:function(){this.checkAllCell(function(a){return 0===a.lcnt&&a.isNum()},"nmNoLine")},checkLineOverLetter:function(){this.checkAllCell(function(a){return a.lcnt>=2&&a.isNum()},this.board.linegraph.moveline?"laOnNum":"lcOnNum")},checkNumberHasArrow:function(){this.checkAllCell(function(a){return a.qnum>=0&&a.qdir===a.NDIR},"anNoArrow")},checkDir4Cell:function(a,b,c){for(var d=0;d<this.board.cell.length;d++){var e=this.board.cell[d];if(e.isValidNum()){var f=e.getNum(),g=e.countDir4Cell(a);if(!(0===b&&f===g||1===b&&f<=g||2===b&&f>=g)){if(this.failcode.add(c),this.checkOnly)break;e.seterr(1)}}}},checkSideCell:function(a,b){for(var c=!0,d=this.board,e=0;e<d.cell.length;e++){var f=d.cell[e],g=f.adjacent.right;if(f.bx<d.maxbx-1&&a(f,g)){if(c=!1,this.checkOnly)break;f.seterr(1),g.seterr(1)}if(g=f.adjacent.bottom,f.by<d.maxby-1&&a(f,g)){if(c=!1,this.checkOnly)break;f.seterr(1),g.seterr(1)}}c||this.failcode.add(b)},checkAdjacentShadeCell:function(){this.checkSideCell(function(a,b){return a.isShade()&&b.isShade()},"csAdjacent")},checkAdjacentDiffNumber:function(){this.checkSideCell(function(a,b){return a.sameNumber(b)},"nmAdjacent")},check2x2Block:function(a,b){for(var c=this.board,d=0;d<c.cell.length;d++){var e=c.cell[d];if(!(e.bx>=c.maxbx-1||e.by>=c.maxby-1)){var f=e.bx,g=e.by,h=c.cellinside(f,g,f+2,g+2).filter(a);if(!(h.length<4)){if(this.failcode.add(b),this.checkOnly)break;h.seterr(1)}}}},check2x2ShadeCell:function(){this.check2x2Block(function(a){return a.isShade()},"cs2x2")},checkSameColorTile:function(){this.checkSameObjectInRoom(this.board.roommgr,function(a){return a.isShade()?1:2},"bkMixed")},checkConnectShade:function(){this.checkOneArea(this.board.sblkmgr,"csDivide")},checkConnectUnshade:function(){this.checkOneArea(this.board.ublkmgr,"cuDivide")},checkConnectNumber:function(){this.checkOneArea(this.board.nblkmgr,"nmDivide")},checkOneArea:function(a,b){a.components.length>1&&(this.failcode.add(b),a.components[0].getnodeobjs().seterr(1))},checkConnectUnshadeRB:function(){if(this.board.ublkmgr.components.length>1){this.failcode.add("cuDivideRB");for(var a=new this.klass.CellList,b=this.board.cell.filter(function(a){return a.isShade()}),c=0;c<b.length;c++)for(var d=b[c],e=d.getdir4clist(),f=null,g=0;g<e.length;g++){var h=e[g][0];if(null===f)f=h.ublk;else if(f!==h.ublk){a.add(d);break}}a.seterr(1)}},checkShadeCellExist:function(){var a=this.board;if(a.sblkmgr.enabled){if(a.sblkmgr.components.length>0)return}else if(a.ublkmgr.enabled){if(0===a.ublkmgr.components.length||a.ublkmgr.components[0].nodes.length!==a.cell.length)return}else if(a.cell.some(function(a){return a.isShade()}))return;this.failcode.add("brNoShade")},doneShadingDecided:function(){this.board.cell.some(function(a){return!a.isShadeDecided()})&&this.failcode.setUndecided()},checkOneLoop:function(){this.checkOneLineBase("lnPlLoop")},checkOneLine:function(){this.checkOneLineBase("lnPlLine")},checkOneLineBase:function(a){var b=this.board,c=b.linegraph.components;c.length>1&&(this.failcode.add(a),b.border.setnoerr(),c[0].setedgeerr(1))},checkNumberExist:function(){this.board.cell.some(function(a){return a.isValidNum()})||this.failcode.add("brNoValidNum")},checkConnectAllNumber:function(){var a=this.board,b=a.linegraph.components;b.length>1&&(this.failcode.add("lcDivided"),a.border.setnoerr(),b[0].setedgeerr(1),b[0].clist.seterr(4))},checkLineExist:function(){var a=this.board;a.linegraph.ltotal[0]===(a.borderAsLine?a.cross:a.cell).length&&this.failcode.add("brNoLine")},checkCrossLine:function(){this.checkLineCount(4,"lnCross")},checkBranchLine:function(){this.checkLineCount(3,"lnBranch")},checkDeadendLine:function(){this.checkLineCount(1,"lnDeadEnd")},checkNoLine:function(){this.checkLineCount(0,"ceNoLine")},checkLineCount:function(a,b){var c=!0,d=this.board;if(d.linegraph.ltotal[a])if(d.borderAsLine){for(var e=d.cross,f=0;f<e.length;f++){var g=e[f];if(g.lcnt===a){if(c=!1,this.checkOnly)break;g.seterr(1),d.borderinside(g.bx-1,g.by-1,g.bx+1,g.by+1).seterr(1)}}c||(this.failcode.add(b),d.border.setnoerr())}else this.checkAllCell(function(b){return b.lcnt===a},b)},checkCrossConnectLine:function(){this.checkConnectLineCount(4,"lnCross")},checkBranchConnectLine:function(){this.checkConnectLineCount(3,"lnBranch")},checkDeadendConnectLine:function(){this.checkConnectLineCount(1,"lnDeadEnd")},checkConnectLineCount:function(a,b){this.board.linegraph.ltotal[a]&&this.checkAllCell(function(b){return b.noNum()&&b.lcnt===a},b)},checkenableLineParts:function(){for(var a=this.board,b=0;b<a.cell.length;b++){var c=a.cell[b],d=c.adjborder;if(d.top.isLine()&&c.noLP(c.UP)||d.bottom.isLine()&&c.noLP(c.DN)||d.left.isLine()&&c.noLP(c.LT)||d.right.isLine()&&c.noLP(c.RT)){if(this.failcode.add("ceAddLine"),this.checkOnly)break;c.seterr(1)}}},checkAllArea:function(a,b,c){this.checkAllBlock(a,null,b,c)},checkAllBlock:function(a,b,c,d){for(var e=a.components,f=0;f<e.length;f++){var g=e[f],h=g.clist,i=g.top?g.top:h.getQnumCell(),j=h.getRectSize(),k=(b?h.filter(b):h).length,l=i&&!i.isnull?i.qnum:-1;if(!c(j.cols,j.rows,k,l)){if(this.failcode.add(d),this.checkOnly)break;e!==this.board.linegraph?h.seterr("tateyoko"!==this.pid?1:4):(this.board.border.setnoerr(),g.objs.seterr(1))}}},checkNumberAndSize:function(){this.checkAllArea(this.board.roommgr,function(a,b,c,d){return d<=0||d===c},"bkSizeNe")},checkRoomRect:function(){this.checkAllArea(this.board.roommgr,function(a,b,c,d){return a*b===c},"bkNotRect")},checkNoNumber:function(){this.checkAllBlock(this.board.roommgr,function(a){return a.isNum()},function(a,b,c,d){return 0!==c},"bkNoNum")},checkDoubleNumber:function(){this.checkAllBlock(this.board.roommgr,function(a){return a.isNum()},function(a,b,c,d){return c<2},"bkNumGe2")},checkShadeCellCount:function(){this.checkAllBlock(this.board.roommgr,function(a){return a.isShade()},function(a,b,c,d){return d<0||d===c},"bkShadeNe")},checkNoShadeCellInArea:function(){this.checkAllBlock(this.board.roommgr,function(a){return a.isShade()},function(a,b,c,d){return c>0},"bkNoShade")},checkLinesInArea:function(a,b,c){this.checkAllBlock(a,function(a){return a.lcnt>0},b,c)},checkNoMovedObjectInRoom:function(a){this.checkAllBlock(a,function(a){return-1!==a.base.qnum},function(a,b,c,d){return 0!==c},"bkNoNum")},checkDisconnectLine:function(){this.checkConnectObjectCount(function(a){return a>0},this.board.linegraph.moveline?"laIsolate":"lcIsolate")},checkConnectObject:function(){this.checkConnectObjectCount(function(a){return a<2},"nmConnected")},checkTripleObject:function(){this.checkConnectObjectCount(function(a){return a<3},"lcTripleNum")},checkConnectObjectCount:function(a,b){for(var c=!0,d=this.board.linegraph.components,e=0;e<d.length;e++){if(!a(d[e].clist.filter(function(a){return a.isNum()}).length)){if(c=!1,this.checkOnly)break;this.board.border.setnoerr(),d[e].setedgeerr(1),d[e].clist.seterr(4)}}c||(this.failcode.add(b),this.board.border.setnoerr())},checkSideAreaSize:function(a,b,c){for(var d=a.getSideAreaInfo(),e=0;e<d.length;e++){var f=b(d[e][0]),g=b(d[e][1]);if(!(f<=0||g<=0||f!==g)){if(this.failcode.add(c),this.checkOnly)break;d[e][0].clist.seterr(1),d[e][1].clist.seterr(1)}}},checkSideAreaCell:function(a,b,c){for(var d=0;d<this.board.border.length;d++){var e=this.board.border[d];if(e.isBorder()){var f=e.sidecell[0],g=e.sidecell[1];if(!f.isnull&&!g.isnull&&a(f,g)){if(this.failcode.add(c),this.checkOnly)break;b?(f.room.clist.seterr(1),g.room.clist.seterr(1)):(f.seterr(1),g.seterr(1))}}}},checkSameObjectInRoom:function(a,b,c){var d=a.components;a:for(var e=0;e<d.length;e++)for(var f=d[e].clist,g=-1,h=0;h<f.length;h++){var i=f[h],j=b(i);if(-1!==j&&g!==j)if(-1===g)g=j;else{if(this.failcode.add(c),this.checkOnly)break a;d!==this.board.linegraph.components?f.seterr(1):(this.board.border.setnoerr(),d[e].setedgeerr(1))}}},checkDifferentNumberInRoom:function(){this.checkDifferentNumberInRoom_main(this.board.roommgr,this.isDifferentNumberInClist)},checkDifferentNumberInRoom_main:function(a,b){for(var c=a.components,d=0;d<c.length;d++){var e=c[d].clist;if(!b.call(this,e)){if(this.failcode.add("bkDupNum"),this.checkOnly)break;e.seterr(1)}}},isDifferentNumberInClist:function(a){return this.isIndividualObject(a,function(a){return a.getNum()})},isDifferentAnsNumberInClist:function(a){return this.isIndividualObject(a,function(a){return a.anum})},isIndividualObject:function(a,b){if(a.length<=0)return!0;for(var c=!0,d=[],e=[],f=-1,g=a[0].getminnum(),h=0;h<a.length;h++)f<b(a[h])&&(f=b(a[h]));for(var i=g;i<=f;i++)d[i]=0;for(var h=0;h<a.length;h++)e[a[h].id]=b(a[h]);for(var h=0;h<a.length;h++)e[a[h].id]>=g&&d[e[a[h].id]]++;var j=a.filter(function(a){return e[a.id]>=g&&d[e[a.id]]>=2});return j.length>0&&(j.seterr(1),c=!1),c},checkRowsCols:function(a,b){var c=!0,d=this.board;a:do{for(var e=1;e<=d.maxby;e+=2){var f=d.cellinside(d.minbx+1,e,d.maxbx-1,e);if(!a.call(this,f)&&(c=!1,this.checkOnly))break a}for(var g=1;g<=d.maxbx;g+=2){var f=d.cellinside(g,d.minby+1,g,d.maxby-1);if(!a.call(this,f)&&(c=!1,this.checkOnly))break a}}while(0);c||this.failcode.add(b)},checkDifferentNumberInLine:function(){this.checkRowsCols(this.isDifferentNumberInClist,"nmDupRow")},checkRowsColsPartly:function(a,b,c){var d,e=!0,f=this.board;a:do{d={keycell:null,key51num:-1,isvert:!1};for(var g=1;g<=f.maxby;g+=2)for(var h=1;h<=f.maxbx;h+=2){for(var i=h;i<=f.maxbx&&!b(f.getc(i,g));i+=2);if(d.keycell=f.getobj(h-2,g),d.key51num=d.keycell.qnum,i>h&&!a.call(this,f.cellinside(h,g,i-2,g),d)&&(e=!1,this.checkOnly))break a;h=i}d={keycell:null,key51num:-1,isvert:!0};for(var h=1;h<=f.maxbx;h+=2)for(var g=1;g<=f.maxby;g+=2){for(var j=g;j<=f.maxby&&!b(f.getc(h,j));j+=2);if(d.keycell=f.getobj(h,g-2),d.key51num=d.keycell.qnum2,j>g&&!a.call(this,f.cellinside(h,g,h,j-2),d)&&(e=!1,this.checkOnly))break a;g=j}}while(0);e||this.failcode.add(c)},checkRowsColsFor51cell:function(a,b){this.checkRowsColsPartly(a,function(a){return a.is51cell()},b)},checkBorderCross:function(){this.checkBorderCount(4,0,"bdCross")},checkBorderDeadend:function(){this.checkBorderCount(1,0,"bdDeadEnd")},checkBorderCount:function(a,b,c){for(var d=!0,e=this.board,f=2===e.hascross?e.cross:e.crossinside(e.minbx+2,e.minby+2,e.maxbx-2,e.maxby-2),g=0;g<f.length;g++){var h=f[g];if(!(h.lcnt!==a||1===b&&1!==h.qnum||2===b&&1===h.qnum)){if(d=!1,this.checkOnly)break;h.setCrossBorderError()}}d||(this.failcode.add(c),e.border.setnoerr())},checkLineShape:function(a,b){for(var c=!0,d=this.getLineShapeInfo(),e=0;e<d.length;e++){var f=d[e];if(f&&a(f)){if(c=!1,this.checkOnly)break;var g=f.cells;g[0]&&!g[0].isnull&&g[0].seterr(1),g[1]&&!g[1].isnull&&g[1].seterr(1),f.objs.seterr(1)}}c||(this.failcode.add(b),this.board.border.setnoerr())},checkLineShapeDeadend:function(){this.checkLineShape(function(a){return a.cells[1].isnull},"lcDeadEnd")},getLineShapeInfo:function(){if(this._info.num)return this._info.num;for(var a=this.board,b=[],c=[],d=0;d<a.border.length;d++)c[d]=!1;for(var e=a.cell.filter(function(a){return a.isNum()}),f=0;f<e.length;f++)for(var g=e[f],h=g.adjborder,i=[h.top,h.bottom,h.left,h.right],j=0;j<4;j++){var k=i[j];if(!k.isnull){var l=this.serachLineShapeInfo(g,j+1,c);l&&b.push(l)}}return this._info.num=b},serachLineShapeInfo:function(a,b,c){for(var d={objs:new this.klass.BorderList,cells:[a,null],ccnt:0,length:[],dir1:b,dir2:0},e=a.getaddr();;)if(e.movedir(b,1),e.oncell()){var f=e.getc(),g=f.adjborder;if(f.isnull||a===f||f.isNum())break;this.board.linegraph.iscrossing(f)&&f.lcnt>=3||(1!==b&&g.bottom.isLine()?(2!==b&&d.ccnt++,b=2):2!==b&&g.top.isLine()?(1!==b&&d.ccnt++,b=1):3!==b&&g.right.isLine()?(4!==b&&d.ccnt++,b=4):4!==b&&g.left.isLine()&&(3!==b&&d.ccnt++,b=3))}else{var h=e.getb();if(h.isnull||!h.isLine()||c[h.id])break;d.objs.add(h),c[h.id]=!0,isNaN(d.length[d.ccnt])?d.length[d.ccnt]=1:d.length[d.ccnt]++}return d.objs.length>0?(d.cells[1]=e.getc(),d.dir2=[0,2,1,4,3][b],d):null}},FailCode:{cs2x2:["2x2の黒マスのカタマリがあります。","There is a 2x2 block of shaded cells."],csNotSquare:["正方形でない黒マスのカタマリがあります。","A group of shaded cells is not a square."],csAdjacent:["黒マスがタテヨコに連続しています。","Some shaded cells are adjacent."],csDivide:["黒マスが分断されています。","The shaded cells are divided."],cuDivide:["白マスが分断されています。","The unshaded cells are divided."],cuDivideRB:["白マスが分断されています。","The unshaded cells are divided."],brNoShade:["盤面に黒マスがありません。","There are no shaded cells on the board."],bkNoNum:["数字のないブロックがあります。","A block has no number."],bkNumGe2:["1つのブロックに2つ以上の数字が入っています。","A block has multiple numbers."],bkDupNum:["同じブロックに同じ数字が入っています。","There are equal numbers in a block."],bkPlNum:["複数種類の数字が入っているブロックがあります。","A block has two or more kinds of number."],bkSepNum:["同じ数字が異なるブロックに入っています。","One kind of number is included in different blocks."],bkSizeNe:["数字とブロックの大きさが違います。","The size of the block is not equal to the number."],bkShadeNe:["部屋の数字と黒マスの数が一致していません。","The number of shaded cells in the room and the number written in the room is different."],bkShadeDivide:["1つの部屋に入る黒マスが2つ以上に分裂しています。","Shaded cells are divided in a room."],bkNoShade:["黒マスがない部屋があります。","A room has no shaded cell."],bkMixed:["白マスと黒マスの混在したタイルがあります。","A tile includes both shaded and unshaded cells."],bkWidthGt1:["幅が１マスではないタタミがあります。","The width of the tatami is not one."],brNoValidNum:["盤面に数字がありません。","There are no numbers on the board."],brNoLine:["線が引かれていません。","There is no line on the board."],bkNotRect:["四角形ではない部屋があります。","There is a room whose shape is not a rectangle."],bdDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],bdCross:["十字の交差点があります。","There is a crossing border line."],lnDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],lnBranch:["分岐している線があります。","There is a branch line."],lnCross:["線が交差しています。","There is a crossing line."],lnNotCrossMk:["十字の場所で線が交差していません。","A cross-joint cell doesn't have four-way lines."],lnCrossExIce:["氷の部分以外で線が交差しています。","A line is crossed outside of ice."],lnCurveOnIce:["氷の部分で線が曲がっています。","A line turns on ice."],lnPlLine:["線がひとつながりではありません。","There are multiple lines."],lnPlLoop:["輪っかが一つではありません。","There are multiple loops."],lnOnShade:["黒マスの上に線が引かれています。","There is a line on a shaded cell."],lcDeadEnd:["線が途中で途切れています。","There is a dead-end line."],lcDivided:["線が全体でひとつながりになっていません。","All lines and numbers are not connected to each other."],lcTripleNum:["3つ以上の数字がつながっています。","Three or more numbers are connected."],lcIsolate:["数字につながっていない線があります。","A line doesn't connect to any number."],lcOnNum:["数字の上を線が通過しています。","A line goes through a number."],nmNoLine:["どこにもつながっていない数字があります。","A number is not connected to another number."],nmConnected:["アルファベットが繋がっています。","There are connected letters."],laIsolate:["アルファベットにつながっていない線があります。","A line doesn't connect to any letter."],laOnNum:["アルファベットの上を線が通過しています。","A line goes through a letter."],laCurve:["曲がっている線があります。","A line has curve."],laLenNe:["数字と線の長さが違います。","The length of a line is wrong."],ceNoNum:["数字の入っていないマスがあります。","There is an empty cell."],ceNoLine:["線が引かれていないマスがあります。","There is an empty cell."],ceAddLine:["最初から引かれている線があるマスに線が足されています。","A cell with given lines has extra lines."],anNoArrow:["矢印がない数字のマスがあります。","A number has no arrow."],anShadeNe:["矢印の方向にある黒マスの数が正しくありません。","The number of shaded cells is not correct."],nmAdjacent:["同じ数字がタテヨコに連続しています。","Equal numbers are adjacent."],nmDupRow:["同じ列に同じ数字が入っています。","There are equal numbers in a row or column."],nmDivide:["タテヨコにつながっていない数字があります。","Numbers are divided."],nmSumViewNe:["数字と黒マスにぶつかるまでの4方向のマスの合計が違います。","A cell containing a clue number sees a different number of cells in the four orthogonal directions."]}}),a.classmgr.makeCommon({BoardExec:{adjustNumberArrow:function(a,b){a&this.TURNFLIP&&this.adjustCellQdirArrow(a,b)},adjustCellArrow:function(a,b){a&this.TURNFLIP&&(this.klass.Cell.prototype.numberAsObject?this.adjustCellQnumArrow(a,b):this.adjustCellQdirArrow(a,b))},adjustCellQdirArrow:function(a,b){for(var c=this.getTranslateDir(a),d=this.board.cellinside(b.x1,b.y1,b.x2,b.y2),e=0;e<d.length;e++){var f=d[e],g=c[f.qdir];g&&f.setQdir(g)}},adjustCellQnumArrow:function(a,b){for(var c=this.getTranslateDir(a),d=this.board.cellinside(b.x1,b.y1,b.x2,b.y2),e=0;e<d.length;e++){var f=d[e],g=c[f.qnum];g&&f.setQnum(g);var g=c[f.anum];g&&f.setAnum(g)}},adjustBorderArrow:function(a,b){if(a&this.TURNFLIP)for(var c=this.getTranslateDir(a),d=this.board.borderinside(b.x1,b.y1,b.x2,b.y2),e=0;e<d.length;e++){var f,g=d[e];f=c[g.qdir],f&&g.setQdir(f)}},getTranslateDir:function(a){var b={};switch(a){case this.FLIPY:b={1:2,2:1};break;case this.FLIPX:b={3:4,4:3};break;case this.TURNR:b={1:4,2:3,3:1,4:2};break;case this.TURNL:b={1:3,2:4,3:2,4:1}}return b},adjustQues51_1:function(a,b){var c=1|b.x1,d=1|b.y1;this.qnumw=[],this.qnumh=[];for(var e=this.board,f=d;f<=b.y2;f+=2){this.qnumw[f]=[e.getex(-1,f).qnum];for(var g=c;g<=b.x2;g+=2){var h=e.getc(g,f);h.is51cell()&&this.qnumw[f].push(h.qnum)}}for(var g=c;g<=b.x2;g+=2){this.qnumh[g]=[e.getex(g,-1).qnum2];for(var f=d;f<=b.y2;f+=2){var h=e.getc(g,f);h.is51cell()&&this.qnumh[g].push(h.qnum2)}}},adjustQues51_2:function(a,b){var c,d=b.x1+b.x2,e=b.y1+b.y2,f=1|b.x1,g=1|b.y1,h=this.board;switch(h.disableInfo(),a){case this.FLIPY:for(var i=f;i<=b.x2;i+=2){c=1,this.qnumh[i]=this.qnumh[i].reverse(),h.getex(i,-1).setQnum2(this.qnumh[i][0]);for(var j=g;j<=b.y2;j+=2){var k=h.getc(i,j);k.is51cell()&&(k.setQnum2(this.qnumh[i][c]),c++)}}break;case this.FLIPX:for(var j=g;j<=b.y2;j+=2){c=1,this.qnumw[j]=this.qnumw[j].reverse(),h.getex(-1,j).setQnum(this.qnumw[j][0]);for(var i=f;i<=b.x2;i+=2){var k=h.getc(i,j);k.is51cell()&&(k.setQnum(this.qnumw[j][c]),c++)}}break;case this.TURNR:for(var j=g;j<=b.y2;j+=2){c=1,this.qnumh[j]=this.qnumh[j].reverse(),h.getex(-1,j).setQnum(this.qnumh[j][0]);for(var i=f;i<=b.x2;i+=2){var k=h.getc(i,j);k.is51cell()&&(k.setQnum(this.qnumh[j][c]),c++)}}for(var i=f;i<=b.x2;i+=2){c=1,h.getex(i,-1).setQnum2(this.qnumw[d-i][0]);for(var j=g;j<=b.y2;j+=2){var k=h.getc(i,j);k.is51cell()&&(k.setQnum2(this.qnumw[d-i][c]),c++)}}break;case this.TURNL:for(var j=g;j<=b.y2;j+=2){c=1,h.getex(-1,j).setQnum(this.qnumh[e-j][0]);for(var i=f;i<=b.x2;i+=2){var k=h.getc(i,j);k.is51cell()&&(k.setQnum(this.qnumh[e-j][c]),c++)}}for(var i=f;i<=b.x2;i+=2){c=1,this.qnumw[i]=this.qnumw[i].reverse(),h.getex(i,-1).setQnum2(this.qnumw[i][0]);for(var j=g;j<=b.y2;j+=2){var k=h.getc(i,j);k.is51cell()&&(k.setQnum2(this.qnumw[i][c]),c++)}}}h.enableInfo()},adjustExCellTopLeft_1:function(a,b){var c=1|b.x1,d=1|b.y1;this.qnumw=[],this.qnumh=[];for(var e=this.board,f=-2*e.excellRows(e.cols,e.rows)+1,g=-2*e.excellCols(e.cols,e.rows)+1,h=d;h<=b.y2;h+=2){this.qnumw[h]=[];for(var i=g;i<=-1;i+=2)this.qnumw[h].push(e.getex(i,h).qnum)}for(var i=c;i<=b.x2;i+=2){this.qnumh[i]=[];for(var h=f;h<=-1;h+=2)this.qnumh[i].push(e.getex(i,h).qnum)}},adjustExCellTopLeft_2:function(a,b,c){var d=b.x1+b.x2,e=b.y1+b.y2,f=1|b.x1,g=1|b.y1;if(!c){if(a===this.FLIPX||a===this.TURNL)for(var h in this.qnumw)this.qnumw[h].reverse();if(a===this.FLIPY||a===this.TURNR)for(var h in this.qnumh)this.qnumh[h].reverse()}var i=this.board,j=-2*i.excellRows(i.cols,i.rows)+1,k=-2*i.excellCols(i.cols,i.rows)+1;switch(a){case this.FLIPY:for(var l=f;l<=b.x2;l+=2)for(var m=-1;m>=j;m-=2)i.getex(l,m).setQnum(this.qnumh[l].pop());break;case this.FLIPX:for(var m=g;m<=b.y2;m+=2)for(var l=-1;l>=k;l-=2)i.getex(l,m).setQnum(this.qnumw[m].pop());break;case this.TURNR:for(var m=g;m<=b.y2;m+=2)for(var l=-1;l>=k;l-=2)i.getex(l,m).setQnum(this.qnumh[m].pop());for(var l=f;l<=b.x2;l+=2)for(var m=-1;m>=j;m-=2)i.getex(l,m).setQnum(this.qnumw[d-l].pop());break;case this.TURNL:for(var m=g;m<=b.y2;m+=2)for(var l=-1;l>=k;l-=2)i.getex(l,m).setQnum(this.qnumh[e-m].pop());for(var l=f;l<=b.x2;l+=2)for(var m=-1;m>=j;m-=2)i.getex(l,m).setQnum(this.qnumw[l].pop())}},getAfterPos:function(a,b,c){var d,e,f=this.puzzle,g=f.board,h=b.x1+b.x2,i=b.y1+b.y2,j=c.bx,k=c.by;switch(a){case this.FLIPY:d=j,e=i-k;break;case this.FLIPX:d=h-j,e=k;break;case this.TURNR:d=i-k,e=j;break;case this.TURNL:d=k,e=h-j;break;case this.EXPANDUP:d=j,e=k+(k===g.minby?0:2);break;case this.EXPANDDN:d=j,e=k+(k===g.maxby?2:0);break;case this.EXPANDLT:d=j+(j===g.minbx?0:2),e=k;break;case this.EXPANDRT:d=j+(j===g.maxbx?2:0),e=k;break;case this.REDUCEUP:d=j,e=k-(k<=g.minby+2?0:2);break;case this.REDUCEDN:d=j,e=k-(k>=g.maxby-2?2:0);break;case this.REDUCELT:d=j-(j<=g.minbx+2?0:2),e=k;break;case this.REDUCERT:d=j-(j>=g.maxbx-2?2:0),e=k;break;default:d=j,e=k}return{pos:new f.klass.Address(d,e),isdel:this.isdel(a,c)}}}}),a.classmgr.makeCommon({Encode:{include:function(a,b,c){return b<=a&&a<=c},decode4Cell:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","4")?e.qnum=parseInt(f,16):this.include(f,"5","9")?(e.qnum=parseInt(f,16)-5,a++):this.include(f,"a","e")?(e.qnum=parseInt(f,16)-10,a+=2):this.include(f,"g","z")?a+=parseInt(f,36)-16:"."===f&&(e.qnum=-2),a++,!d.cell[a])break}this.outbstr=c.substr(b+1)},encode4Cell:function(){for(var a=0,b="",c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qnum;f>=0?c.cell[d+1]&&-1!==c.cell[d+1].qnum?e=""+f.toString(16):c.cell[d+2]&&-1!==c.cell[d+2].qnum?(e=""+(5+f).toString(16),d++):(e=""+(10+f).toString(16),d+=2):-2===f?e=".":a++,0===a?b+=e:(e||20===a)&&(b+=(a+15).toString(36)+e,a=0)}a>0&&(b+=(a+15).toString(36)),this.outbstr+=b},decode1Cell:function(a){var b=0,c=0,d=this.outbstr,e=this.board;for(c=0;c<d.length;c++){var f=e.cell[b],g=d.charAt(c);if(this.include(g,"0","h")?(f.qnum=a,b+=parseInt(g,36)):b+=parseInt(g,36)-18,b++,!e.cell[b])break}this.outbstr=d.substr(c+1)},encode1Cell:function(a){for(var b=-1,c=!1,d="",e=this.board,f=0;f<e.cell.length;f++)e.cell[f].qnum!==a?17===++b&&(d+=c?b.toString(36):(b+18).toString(36),c=!1,b=-1):(b>=0&&(d+=c?b.toString(36):(b+18).toString(36)),c=!0,b=0);b>=0&&(d+=c?b.toString(36):(b+18).toString(36)),this.outbstr+=d},decode4Cross:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cross[a],f=c.charAt(b);if(this.include(f,"0","4")?e.qnum=parseInt(f,16):this.include(f,"5","9")?(e.qnum=parseInt(f,16)-5,a++):this.include(f,"a","e")?(e.qnum=parseInt(f,16)-10,a+=2):this.include(f,"g","z")?a+=parseInt(f,36)-16:"."===f&&(e.qnum=-2),a++,!d.cross[a])break}this.outbstr=c.substr(b+1)},encode4Cross:function(){for(var a=0,b="",c=this.board,d=0;d<c.cross.length;d++){var e="",f=c.cross[d].qnum;f>=0?c.cross[d+1]&&-1!==c.cross[d+1].qnum?e=""+f.toString(16):c.cross[d+2]&&-1!==c.cross[d+2].qnum?(e=""+(5+f).toString(16),d++):(e=""+(10+f).toString(16),d+=2):-2===f?e=".":a++,0===a?b+=e:(e||20===a)&&(b+=(a+15).toString(36)+e,a=0)}a>0&&(b+=(a+15).toString(36)),this.outbstr+=b},decodeNumber10:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){
var e=d.cell[a],f=c.charAt(b);if("."===f?e.qnum=-2:this.include(f,"0","9")?e.qnum=parseInt(f,10):this.include(f,"a","z")&&(a+=parseInt(f,36)-10),a++,!d.cell[a])break}this.outbstr=c.substr(b+1)},maybeEncodeNumber10:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qnum;if(-2===f)e=".";else if(f>=0&&f<10)e=f.toString(10);else{if(f>=10)return"";b++}0===b?a+=e:(e||26===b)&&(a+=(9+b).toString(36)+e,b=0)}return b>0&&(a+=(9+b).toString(36)),a},encodeNumber10:function(){this.outbstr+=this.maybeEncodeNumber10()},readNumber16:function(a,b){var c=a.charAt(b);return this.include(c,"0","9")||this.include(c,"a","f")?[parseInt(c,16),1]:"-"===c?[parseInt(a.substr(b+1,2),16),3]:"+"===c?[parseInt(a.substr(b+1,3),16),4]:"="===c?[parseInt(a.substr(b+1,3),16)+4096,4]:"%"===c?[parseInt(a.substr(b+1,3),16)+8192,4]:"."===c?[-2,1]:[-1,0]},decodeOneNumber16:function(){var a=this.readNumber16(this.outbstr,0);return this.outbstr=this.outbstr.substr(a[1]),a[0]},decodeNumber16:function(){for(var a=0,b=0,c=this.outbstr,d=this.board;b<c.length&&d.cell[a];){var e=d.cell[a],f=c.charAt(b),g=this.readNumber16(c,b);-1!==g[0]?(e.qnum=g[0],b+=g[1],a++):f>="g"&&f<="z"?(a+=parseInt(f,36)-15,b++):b++}this.outbstr=c.substr(b)},writeNumber16:function(a){return-2===a?".":a>=0&&a<16?a.toString(16):a>=16&&a<256?"-"+a.toString(16):a>=256&&a<4096?"+"+a.toString(16):a>=4096&&a<8192?"="+(a-4096).toString(16):a>=8192?"%"+(a-8192).toString(16):""},encodeNumber16:function(){var a=this.board;this.genericEncodeNumber16(a.cell.length,function(b){return a.cell[b].qnum})},genericEncodeNumber16:function(a,b){for(var c=0,d="",e=0;e<a;e++){var f=b(e),g=this.writeNumber16(f);""===g&&c++,0===c?d+=g:(g||20===c)&&(d+=(15+c).toString(36)+g,c=0)}c>0&&(d+=(15+c).toString(36)),this.outbstr+=d},decodeNumber10or16:function(){var a=this.outbstr;if(0!==a.length){"-"===a.charAt(0)?(this.outbstr=a.substr(1),this.decodeNumber16()):this.decodeNumber10()}},encodeNumber10or16:function(){var a=this.maybeEncodeNumber10();if(a.length>0)return void(this.outbstr+=a);this.outbstr+="-",this.encodeNumber16()},decodeNumber16ExCell:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.excell[a];if(this.include(e,"0","9")||this.include(e,"a","f")?f.qnum=parseInt(c.substr(b,1),16):"-"===e?(f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"."===e?f.qnum=-2:e>="g"&&e<="z"&&(a+=parseInt(e,36)-16),++a>=d.excell.length)break}this.outbstr=c.substr(b+1)},encodeNumber16ExCell:function(){var a=this.board;this.genericEncodeNumber16(a.excell.length,function(b){return a.excell[b].qnum})},encodeNumber16ExCellFlushed:function(){var a=this.board,b=a.cols,c=a.rows,d=a.excell.map(function(a){return a.qnum});a.genericFlush(a.excellCols(b,c),a.excellRows(b,c),b,c,function(a){return d[a]},function(a,b){d[a]=b}),this.genericEncodeNumber16(d.length,function(a){return d[a]})},decodeRoomNumber16:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(d.roommgr.rebuild(),b=0;b<c.length;b++){var e=c.charAt(b),f=d.roommgr.components[a].top;if(this.include(e,"0","9")||this.include(e,"a","f")?f.qnum=parseInt(e,16):"-"===e?(f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"+"===e?(f.qnum=parseInt(c.substr(b+1,3),16),b+=3):"="===e?(f.qnum=parseInt(c.substr(b+1,3),16)+4096,b+=3):"%"===e?(f.qnum=parseInt(c.substr(b+1,3),16)+8192,b+=3):"*"===e?(f.qnum=parseInt(c.substr(b+1,4),16)+12240,b+=4):"$"===e?(f.qnum=parseInt(c.substr(b+1,5),16)+77776,b+=5):e>="g"&&e<="z"&&(a+=parseInt(e,36)-16),++a>=d.roommgr.components.length)break}this.outbstr=c.substr(b+1)},encodeRoomNumber16:function(){var a=0,b="",c=this.board;c.roommgr.rebuild();for(var d=0;d<c.roommgr.components.length;d++){var e="",f=c.roommgr.components[d].top.qnum;f>=0&&f<16?e=f.toString(16):f>=16&&f<256?e="-"+f.toString(16):f>=256&&f<4096?e="+"+f.toString(16):f>=4096&&f<8192?e="="+(f-4096).toString(16):f>=8192&&f<12240?e="%"+(f-8192).toString(16):f>=12240&&f<77776?e="*"+(f-12240).toString(16):f>=77776?e="$"+(f-77776).toString(16):a++,0===a?b+=e:(e||20===a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b},decodeArrowNumber16:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if("+"===e)f.qdir=0,f.qnum=-3;else if(this.include(e,"0","4")){var g=c.charAt(b+1);f.qdir=parseInt(e,16),f.qnum="."!==g?parseInt(g,16):-2,b++}else this.include(e,"5","9")?(f.qdir=parseInt(e,16)-5,f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"-"===e?(f.qdir=parseInt(c.substr(b+1,1),16),f.qnum=parseInt(c.substr(b+2,3),16),b+=4):e>="a"&&e<="z"&&(a+=parseInt(e,36)-10);if(a++,!d.cell[a])break}this.outbstr=c.substr(b+1)},encodeArrowNumber16:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qdir,g=c.cell[d].qnum;-2===g?e=f+".":-3===g?e="+":g>=0&&g<16?e=f+g.toString(16):g>=16&&g<256?e=f+5+g.toString(16):g>=256&&g<4096?e="-"+f+g.toString(16):b++,0===b?a+=e:(e||26===b)&&(a+=(b+9).toString(36)+e,b=0)}b>0&&(a+=(b+9).toString(36)),this.outbstr+=a},decodeBorder:function(){var a,b,c,d=this.outbstr,e=[16,8,4,2,1],f=this.board;d?(a=Math.min(((f.cols-1)*f.rows+4)/5|0,d.length),b=Math.min(((f.cols*(f.rows-1)+4)/5|0)+a,d.length)):(a=0,b=0),c=0;for(var g=0;g<a;g++)for(var h=parseInt(d.charAt(g),32),i=0;i<5;i++)c<(f.cols-1)*f.rows&&(f.border[c].ques=h&e[i]?1:0,c++);c=(f.cols-1)*f.rows;for(var g=a;g<b;g++)for(var h=parseInt(d.charAt(g),32),i=0;i<5;i++){var j=f.border[c];j&&j.inside&&(j.ques=h&e[i]?1:0,c++)}f.roommgr.rebuild(),this.outbstr=d.substr(b)},encodeBorder:function(){for(var a="",b=[16,8,4,2,1],c=0,d=0,e=this.board,f=0;f<(e.cols-1)*e.rows;f++)d+=e.border[f].ques*b[c],5===++c&&(a+=d.toString(32),c=0,d=0);c>0&&(a+=d.toString(32)),c=0,d=0;for(var f=(e.cols-1)*e.rows;f<2*e.cols*e.rows-e.cols-e.rows;f++)d+=e.border[f].ques*b[c],5===++c&&(a+=d.toString(32),c=0,d=0);c>0&&(a+=d.toString(32)),this.outbstr+=a},decodeCrossMark:function(){var a=0,b=0,c=this.outbstr,d=this.board,e=2===d.hascross?1:0,f=e<<1,g=d.rows-1+f,h=d.cols-1+f;for(b=0;b<c.length;b++){var i=c.charAt(b);if(this.include(i,"0","9")||this.include(i,"a","z")){a+=parseInt(i,36);var j=a%h+(1-e)<<1,k=1-e+(a/h|0)<<1;if(k>d.maxby-2*(1-e)){b++;break}d.getx(j,k).qnum=1}else"."===i&&(a+=35);if(++a>=h*g){b++;break}}this.outbstr=c.substr(b)},encodeCrossMark:function(){for(var a="",b=0,c=this.board,d=2===c.hascross?1:0,e=d<<1,f=c.rows-1+e,g=c.cols-1+e,h=0,i=g*f;h<i;h++){var j="",k=h%g+(1-d)<<1,l=1-d+(h/g|0)<<1;1===c.getx(k,l).qnum?j=".":b++,j?(a+=b.toString(36),b=0):36===b&&(a+=".",b=0)}b>0&&(a+=b.toString(36)),this.outbstr+=a},decodeCircle:function(){for(var a=this.board,b=this.outbstr,c=0,d=[9,3,1],e=b?Math.min((a.cols*a.rows+2)/3|0,b.length):0,f=0;f<e;f++)for(var g=parseInt(b.charAt(f),27),h=0;h<3;h++)if(a.cell[c]){var i=(g/d[h]|0)%3;i>0&&(a.cell[c].qnum=i),c++}this.outbstr=b.substr(e)},encodeCircle:function(){for(var a=this.board,b="",c=0,d=0,e=[9,3,1],f=0;f<a.cell.length;f++)a.cell[f].qnum>0&&(d+=a.cell[f].qnum*e[c]),3===++c&&(b+=d.toString(27),c=0,d=0);c>0&&(b+=d.toString(27)),this.outbstr+=b},decodeQues:function(a){for(var b=this.outbstr,c=this.board,d=0,e=[16,8,4,2,1],f=0;f<b.length;f++){for(var g=parseInt(b.charAt(f),32),h=0;h<5;h++)c.cell[d]&&(c.cell[d].ques=g&e[h]?a:0,d++);if(!c.cell[d])break}this.outbstr=b.substr(f+1)},encodeQues:function(a,b){for(var c="",d=0,e=0,f=[16,8,4,2,1],g=this.board,h=!1,i=0;i<g.cell.length;i++)g.cell[i].ques===a&&(e+=f[d],h=!0),5===++d&&(c+=e.toString(32),d=0,e=0);d>0&&(c+=e.toString(32)),!h&&b||(this.outbstr+=c)},decodeIce:function(){this.decodeQues(6)},encodeIce:function(){this.encodeQues(6)},decodeEmpty:function(){this.decodeQues(7)},encodeEmpty:function(){this.encodeQues(7,!0)},decodecross_old:function(){for(var a=this.outbstr,b=0,c=this.board,d=0;d<a.length;d++){var e=a.charAt(d);if(this.include(e,"0","4")&&(c.cross[b].qnum=parseInt(e,10)),b++,!c.cross[b]){d++;break}}this.outbstr=a.substr(d)},decodeDot:function(a){var b=this.board;b.disableInfo();for(var c=0,a=this.outbstr,d=0;d<a.length;d++){var e=b.dots[c],f=a.charAt(d);if(this.include(f,"0","f")){var g=parseInt(f,16);e.setDot(g%2+1),c+=1+(g>>1)}else this.include(f,"g","z")&&(c+=parseInt(f,36)-15);if(c>=b.dotsmax)break}b.enableInfo(),this.outbstr=a.substr(d+1)},encodeDot:function(){for(var a=0,b="",c=this.board,d=0;d<c.dotsmax;d++){var e="",f=c.dots[d];if(f.getDot()>0){for(var g=1;g<=7;g++){var h=c.dots[d+g];if(h&&h.getDot()>0){e=""+(2*(g-1)+(f.getDot()-1)).toString(16),d+=g-1;break}}""===e&&(e=(13+f.getDot()).toString(16),d+=7)}else a++;0===a?b+=e:(e||20===a)&&(b+=(a+15).toString(36)+e,a=0)}a>0&&(b+=(a+15).toString(36)),this.outbstr+=b}}}),a.classmgr.makeCommon({FileIO:{decodeCellQnum:function(){this.decodeCell(function(a,b){"-"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)})},encodeCellQnum:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum+" ":-2===a.qnum?"- ":". "})},decodeCellQnumb:function(){this.decodeCell(function(a,b){"5"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)})},encodeCellQnumb:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum+" ":-2===a.qnum?"5 ":". "})},decodeCellQnumAns:function(){this.decodeCell(function(a,b){"#"===b?a.qans=1:"+"===b?a.qsub=1:"-"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)})},encodeCellQnumAns:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum+" ":-2===a.qnum?"- ":1===a.qans?"# ":1===a.qsub?"+ ":". "})},decodeCellDirecQnum:function(){this.decodeCell(function(a,b){if("#"===b)a.qdir=0,a.qnum=-3;else if("."!==b){var c=b.split(",");a.qdir="0"!==c[0]?+c[0]:0,a.qnum="-"!==c[1]?+c[1]:-2}})},encodeCellDirecQnum:function(){this.encodeCell(function(a){if(-3===a.qnum)return"# ";if(-1!==a.qnum){return[0!==a.qdir?""+a.qdir:"0",",",-2!==a.qnum?""+a.qnum:"-"," "].join("")}return". "})},decodeCellAns:function(){this.decodeCell(function(a,b){"#"===b?a.qans=1:"+"===b&&(a.qsub=1)})},encodeCellAns:function(){this.encodeCell(function(a){return 1===a.qans?"# ":1===a.qsub?"+ ":". "})},decodeCellQanssub:function(){this.decodeCell(function(a,b){"+"===b?a.qsub=1:"-"===b?a.qsub=2:"="===b?a.qsub=3:"%"===b?a.qsub=4:"."!==b&&(a.qans=+b)})},encodeCellQanssub:function(){this.encodeCell(function(a){return 0!==a.qans?a.qans+" ":1===a.qsub?"+ ":2===a.qsub?"- ":3===a.qsub?"= ":4===a.qsub?"% ":". "})},decodeCellAnumsub:function(){this.decodeCell(function(a,b){a.enableSubNumberArray&&b.indexOf("[")>=0&&(b=this.setCellSnum(a,b)),"+"===b?a.qsub=1:"-"===b?a.qsub=2:"="===b?a.qsub=3:"%"===b?a.qsub=4:"."!==b&&(a.anum=+b)})},encodeCellAnumsub:function(){this.encodeCell(function(a){var b=".";return b=-1!==a.anum?""+a.anum:1===a.qsub?"+":2===a.qsub?"-":3===a.qsub?"=":4===a.qsub?"%":".",a.enableSubNumberArray&&-1===a.anum&&(b+=this.getCellSnum(a)),b+" "})},setCellSnum:function(a,b){for(var c=b.substring(b.indexOf("[")+1,b.indexOf("]")),d=c.split(/,/),e=0;e<d.length;++e)a.snum[e]=d[e]?+d[e]:-1;return b.substr(0,b.indexOf("["))},getCellSnum:function(a){for(var b=[],c=0;c<a.snum.length;++c)b[c]=-1!==a.snum[c]?""+a.snum[c]:"";var d=b.join(",");return",,,"!==d?"["+d+"]":""},decodeCellQsub:function(){this.decodeCell(function(a,b){"0"!==b&&(a.qsub=+b)})},encodeCellQsub:function(){this.encodeCell(function(a){return a.qsub>0?a.qsub+" ":"0 "})},decodeCrossNum:function(){this.decodeCross(function(a,b){"-"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)})},encodeCrossNum:function(){this.encodeCross(function(a){return a.qnum>=0?a.qnum+" ":-2===a.qnum?"- ":". "})},decodeBorderQues:function(){this.decodeBorder(function(a,b){"1"===b&&(a.ques=1)})},encodeBorderQues:function(){this.encodeBorder(function(a){return(1===a.ques?"1":"0")+" "})},decodeBorderAns:function(){this.decodeBorder(function(a,b){"2"===b?(a.qans=1,a.qsub=1):"1"===b?a.qans=1:"-1"===b&&(a.qsub=1)})},encodeBorderAns:function(){this.encodeBorder(function(a){return 1===a.qans&&1===a.qsub?"2 ":1===a.qans?"1 ":1===a.qsub?"-1 ":"0 "})},decodeBorderLine:function(){this.decodeBorder(function(a,b){"-1"===b?a.qsub=2:"0"!==b&&(a.line=+b)})},encodeBorderLine:function(){this.encodeBorder(function(a){return a.line>0?a.line+" ":2===a.qsub?"-1 ":"0 "})},decodeAreaRoom:function(){this.decodeAreaRoom_com(!0)},encodeAreaRoom:function(){this.encodeAreaRoom_com(!0)},decodeAreaRoom_com:function(a){this.readLine(),this.rdata2Border(a,this.getItemList(this.board.rows)),this.board.roommgr.rebuild()},encodeAreaRoom_com:function(a){var b=this.board;b.roommgr.rebuild();var c=b.roommgr.components;this.writeLine(c.length);for(var d="",e=0;e<b.cell.length;e++){var f=c.indexOf(b.cell[e].room);d+=(f>=0?f:".")+" ",(e+1)%b.cols==0&&(this.writeLine(d),d="")}},rdata2Border:function(a,b){for(var c=this.board,d=0;d<c.border.length;d++){var e=c.border[d],f=e.sidecell[0],g=e.sidecell[1],h=!f.isnull&&!g.isnull&&b[f.id]!==b[g.id];e[a?"ques":"qans"]=h?1:0}},decodeCellQnum51:function(){var a=this.board;a.disableInfo(),this.decodeCellExCell(function(a,b){if("."!==b)if("excell"===a.group)-1!==a.bx&&-1===a.by?a.qnum2=+b:-1===a.bx&&-1!==a.by&&(a.qnum=+b);else if("cell"===a.group){var c=b.split(",");a.set51cell(),a.qnum=+c[0],a.qnum2=+c[1]}}),a.enableInfo()},encodeCellQnum51:function(){this.encodeCellExCell(function(a){return"excell"===a.group?-1===a.bx&&-1===a.by?"0 ":(-1===a.by?a.qnum2:a.qnum)+" ":"cell"===a.group&&51===a.ques?a.qnum+","+a.qnum2+" ":". "})},decodeDotFile:function(){for(var a=this.board,b=0,c="",d=0,e=2*a.rows-1;d<e;d++){var f=this.readLine();f&&(c+=f.match(/[12X\.]+/)[0])}a.disableInfo();for(var b=0;b<c.length;++b){var g=a.dots[b],h=c.charAt(b);"1"===h?g.setDot(1):"2"===h?g.setDot(2):"X"===h&&(g.piece.ques=7)}a.enableInfo()},encodeDotFile:function(){for(var a=this.board,b=0,c=1;c<=2*a.rows-1;c++){for(var d="",e=1;e<=2*a.cols-1;e++){var f=a.dots[b];1===f.getDot()?d+="1":2===f.getDot()?d+="2":7===f.piece.ques?d+="X":d+=".",b++}this.writeLine(d)}},decodeCellQnum_kanpen:function(){this.decodeCell(function(a,b){"."!==b&&(a.qnum=+b)})},encodeCellQnum_kanpen:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum+" ":". "})},decodeCellAnum_kanpen:function(){this.decodeCell(function(a,b){"."!==b&&"0"!==b&&(a.anum=+b)})},encodeCellAnum_kanpen:function(){this.encodeCell(function(a){return-1!==a.qnum?". ":-1===a.anum?"0 ":a.anum+" "})},decodeCellQnumAns_kanpen:function(){this.decodeCell(function(a,b){"#"===b?a.qans=1:"+"===b?a.qsub=1:"?"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)})},encodeCellQnumAns_kanpen:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum+" ":-2===a.qnum?"? ":1===a.qans?"# ":1===a.qsub?"+ ":". "})},UNDECIDED_NUM_XML:-1,decodeCellQnum_XMLBoard:function(){var a=this.board.cell[0].getminnum()>0?1:0,b=this.UNDECIDED_NUM_XML;this.decodeCellXMLBoard(function(c,d){d===b?c.qnum=-2:d>=a&&(c.qnum=d)})},encodeCellQnum_XMLBoard:function(){var a=this.board.cell[0].getminnum()>0?1:0,b=this.UNDECIDED_NUM_XML;this.encodeCellXMLBoard(function(c){var d=null;return-2===c.qnum?d=b:c.qnum>=a&&(d=c.qnum),d})},decodeCellQnum_XMLBoard_Brow:function(){var a=this.UNDECIDED_NUM_XML;this.decodeCellXMLBrow(function(b,c){c==="n"+a?b.qnum=-2:"s"!==c&&(b.qnum=+c.substr(1))})},encodeCellQnum_XMLBoard_Brow:function(){var a=this.UNDECIDED_NUM_XML;this.encodeCellXMLBrow(function(b){return-2===b.qnum?"n"+a:b.qnum>=0?"n"+b.qnum:"s"})},decodeCellAnum_XMLAnswer:function(){this.decodeCellXMLArow(function(a,b){"n0"===b?a.anum=-1:"s"!==b&&(a.anum=+b.substr(1))})},encodeCellAnum_XMLAnswer:function(){this.encodeCellXMLArow(function(a){return a.anum>0?"n"+a.anum:-1===a.anum?"n0":"s"})},decodeAreaRoom_XMLBoard:function(){var a=[];this.decodeCellXMLBrow(function(b,c){a.push(+c.substr(1))}),this.rdata2Border(!0,a),this.board.roommgr.rebuild()},encodeAreaRoom_XMLBoard:function(){var a=this.board;a.roommgr.rebuild();var b=a.roommgr.components;this.xmldoc.querySelector("board").appendChild(this.createXMLNode("areas",{N:b.length})),this.encodeCellXMLBrow(function(a){var c=b.indexOf(a.room);return"n"+(c>0?c:-1)})},decodeCellAns_XMLAnswer:function(){this.decodeCellXMLArow(function(a,b){"w"===b?a.qans=1:"s"===b&&(a.qsub=1)})},encodeCellAns_XMLAnswer:function(){this.encodeCellXMLArow(function(a){return 1===a.qans?"w":1===a.qsub?"s":"u"})},decodeBorderLine_XMLAnswer:function(){this.decodeCellXMLArow(function(a,b){var c=0,d=a.adjborder.bottom,e=a.adjborder.right;"n"===b.charAt(0)?c=+b.substr(1):(b.match(/h/)&&(c+=1),b.match(/v/)&&(c+=2)),1&c&&(d.line=1),2&c&&(e.line=1),4&c&&(d.qsub=2),8&c&&(e.qsub=2)})},encodeBorderLine_XMLAnswer:function(){this.encodeCellXMLArow(function(a){var b=0,c=a.adjborder.bottom,d=a.adjborder.right;return 1===c.line&&(b+=1),1===d.line&&(b+=2),2===c.qsub&&(b+=4),2===d.qsub&&(b+=8),0===b?"s":1===b?"h":2===b?"v":3===b?"hv":"n"+b})}}}),a.classmgr.makeCommon({"StartGoalOperation:Operation":{setData:function(a,b,c,d,e){this.property=a,this.bx1=b,this.by1=c,this.bx2=d,this.by2=e},decode:function(a){return("PS"===a[0]||"PG"===a[0])&&(this.property="PS"===a[0]?"start":"goal",this.bx1=+a[1],this.by1=+a[2],this.bx2=+a[3],this.by2=+a[4],!0)},toString:function(){return["start"===this.property?"PS":"PG",this.bx1,this.by1,this.bx2,this.by2].join(",")},isModify:function(a){return!(!this.manager.changeflag||a.bx2!==this.bx1||a.by2!==this.by1||a.property!==this.property)&&(a.bx2=this.bx2,a.by2=this.by2,!0)},undo:function(){this.exec(this.bx1,this.by1)},redo:function(){this.exec(this.bx2,this.by2)},exec:function(a,b){var c=this.board,d=c.getc(a,b);"start"===this.property?c.startpos.set(d):"goal"===this.property&&c.goalpos.set(d)}}}),a.classmgr.makeCommon({"StartGoalAddress:Address":{type:"",partner:null,init:function(a,b){return this.bx=a,this.by=b,this},input:function(a){this.partner.equals(a)?this.board.exchangestartgoal():this.equals(a)?this.draw():this.set(a)},set:function(a){var b=this.getaddr();this.addOpe(a.bx,a.by),this.bx=a.bx,this.by=a.by,b.draw(),this.draw()},addOpe:function(a,b){this.bx===a&&this.by===b||this.puzzle.opemgr.add(new this.klass.StartGoalOperation(this.type,this.bx,this.by,a,b))}},"StartAddress:StartGoalAddress":{type:"start"},"GoalAddress:StartGoalAddress":{type:"goal"}})}();
//# sourceMappingURL=pzpr.js.map